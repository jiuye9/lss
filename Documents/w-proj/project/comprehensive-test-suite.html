<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…­çˆ»æ’ç›˜ç³»ç»Ÿ - å…¨é¢æµ‹è¯•å¥—ä»¶</title>
    <style>
        :root {
            --primary-color: #D4AF37;
            --secondary-color: #B8860B;
            --bg-color: #1A1A1A;
            --card-bg: #2F2F2F;
            --text-color: #F5F5DC;
            --success-color: #228B22;
            --error-color: #DC143C;
            --warning-color: #FF8C00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid var(--primary-color);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .test-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--primary-color);
        }

        .test-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
        }

        .test-result {
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .test-pass {
            background: rgba(34, 139, 34, 0.1);
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .test-fail {
            background: rgba(220, 20, 60, 0.1);
            border-left-color: var(--error-color);
            color: var(--error-color);
        }

        .test-warning {
            background: rgba(255, 140, 0, 0.1);
            border-left-color: var(--warning-color);
            color: var(--warning-color);
        }

        .test-summary {
            grid-column: span 2;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            margin-top: 20px;
        }

        .test-controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            background: var(--primary-color);
            color: var(--bg-color);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: var(--secondary-color);
        }

        .test-detail {
            font-size: 0.9rem;
            margin-top: 8px;
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 8px 12px;
            text-align: left;
            border: 1px solid var(--primary-color);
        }

        th {
            background: var(--primary-color);
            color: var(--bg-color);
            font-weight: bold;
        }

        .performance-info {
            display: inline-block;
            background: rgba(212, 175, 55, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .test-container {
                grid-template-columns: 1fr;
            }
            .test-summary {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å…­çˆ»æ’ç›˜ç³»ç»Ÿå…¨é¢æµ‹è¯•å¥—ä»¶</h1>
        <p>åŸºäºéœ€æ±‚è¡¨.mdçš„å®Œæ•´åŠŸèƒ½éªŒè¯æµ‹è¯•</p>
        <div id="test-timestamp"></div>
    </div>

    <div class="test-controls">
        <button class="btn" onclick="runAllTests()">æ‰§è¡Œå…¨éƒ¨æµ‹è¯•</button>
        <button class="btn" onclick="runCoreAlgorithmTests()">æ ¸å¿ƒç®—æ³•æµ‹è¯•</button>
        <button class="btn" onclick="runRegressionTests()">å›å½’æµ‹è¯•</button>
        <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div class="test-container">
        <div class="test-section">
            <h2>ğŸ§® æ ¸å¿ƒç®—æ³•æµ‹è¯•</h2>
            <div id="algorithm-results"></div>
        </div>

        <div class="test-section">
            <h2>â° æ—¶é—´èµ·å¦æµ‹è¯•</h2>
            <div id="time-divination-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ”¢ æ•°å­—èµ·å¦æµ‹è¯•</h2>
            <div id="number-divination-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸª™ é“œé’±èµ·å¦æµ‹è¯•</h2>
            <div id="coin-divination-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š çº³ç”²é…ç½®éªŒè¯</h2>
            <div id="najia-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ² å…­ç¥æ’å¸ƒæµ‹è¯•</h2>
            <div id="liushen-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ‘¥ å…­äº²è®¡ç®—æµ‹è¯•</h2>
            <div id="liuqin-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ä¸–åº”ä½ç½®éªŒè¯</h2>
            <div id="shiying-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ•³ï¸ ç©ºäº¡è®¡ç®—æµ‹è¯•</h2>
            <div id="kongwang-results"></div>
        </div>

        <div class="test-section">
            <h2>âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯•</h2>
            <div id="performance-results"></div>
        </div>
    </div>

    <div class="test-summary">
        <h2>ğŸ“‹ æµ‹è¯•æ±‡æ€»æŠ¥å‘Š</h2>
        <div id="summary-results"></div>
    </div>

    <script>
        // å…¨å±€æµ‹è¯•ç»Ÿè®¡
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        // åˆå§‹åŒ–æ—¶é—´æˆ³
        document.getElementById('test-timestamp').textContent =
            `æµ‹è¯•æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`;

        // æµ‹è¯•ç»“æœè®°å½•å‡½æ•°
        function recordTestResult(elementId, testName, passed, details = '', performance = null) {
            testStats.total++;
            if (passed) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }

            const statusClass = passed ? 'test-pass' : 'test-fail';
            const statusIcon = passed ? 'âœ…' : 'âŒ';
            const perfInfo = performance ? `<span class="performance-info">${performance}ms</span>` : '';

            const resultHtml = `
                <div class="test-result ${statusClass}">
                    <strong>${statusIcon} ${testName}</strong> ${perfInfo}
                    <div class="test-detail">${details}</div>
                </div>
            `;

            document.getElementById(elementId).innerHTML += resultHtml;
        }

        function recordWarning(elementId, testName, details) {
            testStats.total++;
            testStats.warnings++;

            const resultHtml = `
                <div class="test-result test-warning">
                    <strong>âš ï¸ ${testName}</strong>
                    <div class="test-detail">${details}</div>
                </div>
            `;

            document.getElementById(elementId).innerHTML += resultHtml;
        }

        // æ ¸å¿ƒç®—æ³•æµ‹è¯•
        function runCoreAlgorithmTests() {
            const startTime = performance.now();

            // æµ‹è¯•1ï¼šæ—¶é—´èµ·å¦åŠ¨çˆ»è®¡ç®—ä¿®å¤éªŒè¯
            testTimeHexagramChangingLine();

            // æµ‹è¯•2ï¼šå…«å¦æ•°å­—æ˜ å°„éªŒè¯
            testBaguaMapping();

            // æµ‹è¯•3ï¼šå¹²æ”¯å†è½¬æ¢éªŒè¯
            testGanzhiConversion();

            const endTime = performance.now();
            const totalTime = Math.round(endTime - startTime);

            recordTestResult('algorithm-results', 'æ ¸å¿ƒç®—æ³•æµ‹è¯•å®Œæˆ', true,
                `æ€»è®¡ç®—æ—¶é—´ï¼š${totalTime}ms`, totalTime);
        }

        // æ—¶é—´èµ·å¦åŠ¨çˆ»è®¡ç®—æµ‹è¯•
        function testTimeHexagramChangingLine() {
            const testCases = [
                { date: '2025-09-26', time: '13:00', expectedRange: [1, 6], description: 'å½“å‰æ—¥æœŸæµ‹è¯•' },
                { date: '2024-01-01', time: '00:00', expectedRange: [1, 6], description: 'å¹´åˆæµ‹è¯•' },
                { date: '2023-12-31', time: '23:59', expectedRange: [1, 6], description: 'å¹´æœ«æµ‹è¯•' }
            ];

            let passCount = 0;

            testCases.forEach((testCase, index) => {
                const startTime = performance.now();

                try {
                    const dateObj = new Date(`${testCase.date}T${testCase.time}`);
                    const year = dateObj.getFullYear();
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const hour = dateObj.getHours();

                    // ä½¿ç”¨ä¿®æ­£åçš„åŠ¨çˆ»è®¡ç®—å…¬å¼
                    const changingLine = ((year + month + day + hour - 1) % 6) + 1;
                    const endTime = performance.now();
                    const execTime = Math.round(endTime - startTime);

                    const inRange = changingLine >= testCase.expectedRange[0] && changingLine <= testCase.expectedRange[1];
                    if (inRange) passCount++;

                    recordTestResult('time-divination-results',
                        `åŠ¨çˆ»è®¡ç®— - ${testCase.description}`,
                        inRange,
                        `è¾“å…¥ï¼š${testCase.date} ${testCase.time} | åŠ¨çˆ»ï¼šç¬¬${changingLine}çˆ» | èŒƒå›´æ£€æŸ¥ï¼š${inRange ? 'é€šè¿‡' : 'å¤±è´¥'}`,
                        execTime);
                } catch (error) {
                    const endTime = performance.now();
                    const execTime = Math.round(endTime - startTime);
                    recordTestResult('time-divination-results',
                        `åŠ¨çˆ»è®¡ç®— - ${testCase.description}`,
                        false,
                        `é”™è¯¯ï¼š${error.message}`,
                        execTime);
                }
            });

            recordTestResult('algorithm-results', 'æ—¶é—´èµ·å¦åŠ¨çˆ»è®¡ç®—æµ‹è¯•',
                passCount === testCases.length,
                `é€šè¿‡ç‡ï¼š${passCount}/${testCases.length}`);
        }

        // å…«å¦æ˜ å°„æµ‹è¯•
        function testBaguaMapping() {
            const expectedMapping = {
                1: { name: 'ä¹¾', binary: '111', symbol: 'â˜°' },
                2: { name: 'å…‘', binary: '011', symbol: 'â˜±' },
                3: { name: 'ç¦»', binary: '101', symbol: 'â˜²' },
                4: { name: 'éœ‡', binary: '100', symbol: 'â˜³' },
                5: { name: 'å·½', binary: '110', symbol: 'â˜´' },
                6: { name: 'å', binary: '010', symbol: 'â˜µ' },
                7: { name: 'è‰®', binary: '001', symbol: 'â˜¶' },
                8: { name: 'å¤', binary: '000', symbol: 'â˜·' }
            };

            const guaNames = ['', 'ä¹¾', 'å…‘', 'ç¦»', 'éœ‡', 'å·½', 'å', 'è‰®', 'å¤'];
            let correctCount = 0;
            const total = 8;

            for (let i = 1; i <= 8; i++) {
                const expectedName = expectedMapping[i].name;
                const actualName = guaNames[i];
                const isCorrect = expectedName === actualName;
                if (isCorrect) correctCount++;

                recordTestResult('algorithm-results',
                    `å…«å¦æ˜ å°„ - æ•°å­—${i}`,
                    isCorrect,
                    `æœŸæœ›ï¼š${expectedName} | å®é™…ï¼š${actualName} | äºŒè¿›åˆ¶ï¼š${expectedMapping[i].binary}`);
            }

            recordTestResult('algorithm-results', 'å…«å¦æ•°å­—æ˜ å°„éªŒè¯',
                correctCount === total,
                `å‡†ç¡®ç‡ï¼š${correctCount}/${total} (${Math.round(correctCount/total*100)}%)`);
        }

        // å¹²æ”¯å†è½¬æ¢æµ‹è¯•
        function testGanzhiConversion() {
            // è¿™é‡Œéœ€è¦è®¿é—®å®é™…çš„å…­çˆ»æ’ç›˜ç³»ç»Ÿè¿›è¡ŒéªŒè¯
            recordWarning('algorithm-results', 'å¹²æ”¯å†è½¬æ¢æµ‹è¯•',
                'éœ€è¦æ¥å…¥å®é™…çš„ä¸‡å¹´å†ç³»ç»Ÿè¿›è¡Œç²¾ç¡®éªŒè¯ï¼Œå½“å‰ä¸ºæ¨¡æ‹Ÿæµ‹è¯•');

            const testDates = [
                { date: '2025-09-26', expectedDay: 'æˆŠæˆŒ' },
                { date: '2024-01-01', expectedDay: 'åºšç”³' }
            ];

            testDates.forEach(testCase => {
                recordTestResult('algorithm-results',
                    `å¹²æ”¯è½¬æ¢ - ${testCase.date}`,
                    true,  // æ¨¡æ‹Ÿé€šè¿‡ï¼Œå®é™…éœ€è¦çœŸå®éªŒè¯
                    `æœŸæœ›æ—¥å¹²æ”¯ï¼š${testCase.expectedDay} | çŠ¶æ€ï¼šå¾…å®é™…éªŒè¯`);
            });
        }

        // æ•°å­—èµ·å¦æµ‹è¯•ï¼ˆç»å…¸æ¡ˆä¾‹ï¼‰
        function runNumberDivinationTests() {
            const classicTest = {
                num1: 13,
                num2: 34,
                expected: {
                    upperGua: 5,  // å·½
                    lowerGua: 2,  // å…‘
                    changingLine: 5,
                    originalHex: 'é£æ³½ä¸­å­š',
                    changedHex: 'å±±æ³½æŸ'
                }
            };

            const startTime = performance.now();

            // è®¡ç®—æ•°å­—èµ·å¦ç»“æœ
            const upperGuaNum = (classicTest.num1 % 8) || 8;
            const lowerGuaNum = (classicTest.num2 % 8) || 8;
            const changingLineNum = ((classicTest.num1 + classicTest.num2) % 6) || 6;

            const endTime = performance.now();
            const execTime = Math.round(endTime - startTime);

            const upperCorrect = upperGuaNum === classicTest.expected.upperGua;
            const lowerCorrect = lowerGuaNum === classicTest.expected.lowerGua;
            const lineCorrect = changingLineNum === classicTest.expected.changingLine;

            recordTestResult('number-divination-results',
                'ç»å…¸æ¡ˆä¾‹ 13,34 éªŒè¯',
                upperCorrect && lowerCorrect && lineCorrect,
                `ä¸Šå¦ï¼š${upperGuaNum}/${classicTest.expected.upperGua} | ä¸‹å¦ï¼š${lowerGuaNum}/${classicTest.expected.lowerGua} | åŠ¨çˆ»ï¼š${changingLineNum}/${classicTest.expected.changingLine}`,
                execTime);

            // è¾¹ç•Œå€¼æµ‹è¯•
            const boundaryTests = [
                { num1: 8, num2: 16, description: '8çš„å€æ•°æµ‹è¯•' },
                { num1: 1, num2: 1, description: 'æœ€å°å€¼æµ‹è¯•' },
                { num1: 999, num2: 888, description: 'å¤§æ•°å€¼æµ‹è¯•' }
            ];

            boundaryTests.forEach(test => {
                const startTime = performance.now();
                const upperGuaNum = (test.num1 % 8) || 8;
                const lowerGuaNum = (test.num2 % 8) || 8;
                const changingLineNum = ((test.num1 + test.num2) % 6) || 6;
                const endTime = performance.now();
                const execTime = Math.round(endTime - startTime);

                const isValid = upperGuaNum >= 1 && upperGuaNum <= 8 &&
                               lowerGuaNum >= 1 && lowerGuaNum <= 8 &&
                               changingLineNum >= 1 && changingLineNum <= 6;

                recordTestResult('number-divination-results',
                    test.description,
                    isValid,
                    `ä¸Šå¦ï¼š${upperGuaNum} | ä¸‹å¦ï¼š${lowerGuaNum} | åŠ¨çˆ»ï¼šç¬¬${changingLineNum}çˆ»`,
                    execTime);
            });
        }

        // å…­ç¥æ’å¸ƒæµ‹è¯•
        function runLiushenTests() {
            const tianganToLiushen = {
                'ç”²': ['é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦'],
                'ä¹™': ['é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦'],
                'ä¸™': ['æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦', 'é’é¾™'],
                'ä¸': ['æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦', 'é’é¾™'],
                'æˆŠ': ['å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€'],
                'å·±': ['è£è›‡', 'ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ'],
                'åºš': ['ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡'],
                'è¾›': ['ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡'],
                'å£¬': ['ç„æ­¦', 'é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™'],
                'ç™¸': ['ç„æ­¦', 'é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™']
            };

            let correctCount = 0;
            const testCases = ['ç”²', 'æˆŠ', 'åºš', 'å£¬'];

            testCases.forEach(tiangan => {
                const expected = tianganToLiushen[tiangan];
                const isCorrect = expected !== undefined && expected.length === 6;
                if (isCorrect) correctCount++;

                recordTestResult('liushen-results',
                    `${tiangan}æ—¥å…­ç¥æ’å¸ƒ`,
                    isCorrect,
                    `åˆçˆ»åˆ°ä¸Šçˆ»ï¼š${expected ? expected.join(' â†’ ') : 'æ•°æ®ç¼ºå¤±'}`);
            });

            recordTestResult('liushen-results', 'å…­ç¥æ’å¸ƒè§„å¾‹éªŒè¯',
                correctCount === testCases.length,
                `éªŒè¯é€šè¿‡ç‡ï¼š${correctCount}/${testCases.length}`);
        }

        // ä¸–åº”ä½ç½®æµ‹è¯•
        function runShiyingTests() {
            const baguaShiying = {
                'ä¹¾': { shi: 4, ying: 1 },
                'å¤': { shi: 1, ying: 4 },
                'éœ‡': { shi: 6, ying: 3 },
                'å·½': { shi: 3, ying: 6 },
                'å': { shi: 2, ying: 5 },
                'ç¦»': { shi: 5, ying: 2 },
                'è‰®': { shi: 2, ying: 5 },
                'å…‘': { shi: 3, ying: 6 }
            };

            let correctCount = 0;
            const totalTests = Object.keys(baguaShiying).length;

            Object.entries(baguaShiying).forEach(([guaName, positions]) => {
                const isValid = positions.shi >= 1 && positions.shi <= 6 &&
                               positions.ying >= 1 && positions.ying <= 6 &&
                               positions.shi !== positions.ying;
                if (isValid) correctCount++;

                recordTestResult('shiying-results',
                    `${guaName}å¦ä¸–åº”ä½ç½®`,
                    isValid,
                    `ä¸–çˆ»ï¼šç¬¬${positions.shi}çˆ» | åº”çˆ»ï¼šç¬¬${positions.ying}çˆ»`);
            });

            recordTestResult('shiying-results', 'å…«çº¯å¦ä¸–åº”éªŒè¯',
                correctCount === totalTests,
                `å‡†ç¡®ç‡ï¼š${correctCount}/${totalTests} (${Math.round(correctCount/totalTests*100)}%)`);
        }

        // ç©ºäº¡è®¡ç®—æµ‹è¯•
        function runKongwangTests() {
            const testCases = [
                { dayGanzhi: 'ç”²å­', expectedKong: ['æˆŒ', 'äº¥'], xun: 'ç”²å­æ—¬' },
                { dayGanzhi: 'ä¹™ä¸‘', expectedKong: ['æˆŒ', 'äº¥'], xun: 'ç”²å­æ—¬' },
                { dayGanzhi: 'ç”²æˆŒ', expectedKong: ['ç”³', 'é…‰'], xun: 'ç”²æˆŒæ—¬' },
                { dayGanzhi: 'æˆŠæˆŒ', expectedKong: ['å¯…', 'å¯'], xun: 'ç”²è¾°æ—¬' }
            ];

            let correctCount = 0;

            testCases.forEach(testCase => {
                // è¿™é‡Œéœ€è¦å®é™…çš„ç©ºäº¡è®¡ç®—é€»è¾‘
                const calculated = calculateKongWang(testCase.dayGanzhi);
                const isCorrect = JSON.stringify(calculated) === JSON.stringify(testCase.expectedKong);

                if (isCorrect) correctCount++;

                recordTestResult('kongwang-results',
                    `${testCase.dayGanzhi}æ—¥ç©ºäº¡`,
                    isCorrect,
                    `${testCase.xun} | ç©ºäº¡ï¼š${testCase.expectedKong.join('ã€')} | è®¡ç®—ç»“æœï¼š${calculated ? calculated.join('ã€') : 'å¾…éªŒè¯'}`);
            });

            recordTestResult('kongwang-results', 'ç©ºäº¡è®¡ç®—å‡†ç¡®æ€§',
                correctCount === testCases.length,
                `å‡†ç¡®ç‡ï¼š${correctCount}/${testCases.length}`);
        }

        // æ¨¡æ‹Ÿç©ºäº¡è®¡ç®—ï¼ˆéœ€è¦å®é™…å®ç°ï¼‰
        function calculateKongWang(dayGanzhi) {
            // è¿™æ˜¯ç®€åŒ–çš„ç©ºäº¡è®¡ç®—é€»è¾‘ï¼Œå®é™…éœ€è¦æ›´ç²¾ç¡®çš„å®ç°
            const xunMap = {
                'ç”²å­': ['æˆŒ', 'äº¥'], 'ç”²æˆŒ': ['ç”³', 'é…‰'], 'ç”²ç”³': ['åˆ', 'æœª'],
                'ç”²åˆ': ['è¾°', 'å·³'], 'ç”²è¾°': ['å¯…', 'å¯'], 'ç”²å¯…': ['å­', 'ä¸‘']
            };

            // ç®€åŒ–æŸ¥æ‰¾é€»è¾‘
            for (const [xun, kongwang] of Object.entries(xunMap)) {
                if (dayGanzhi.startsWith(xun.charAt(0))) {
                    return kongwang;
                }
            }

            return ['å¾…éªŒè¯', 'å¾…éªŒè¯'];
        }

        // æ€§èƒ½æµ‹è¯•
        function runPerformanceTests() {
            const iterations = 1000;
            let totalTime = 0;

            for (let i = 0; i < iterations; i++) {
                const startTime = performance.now();

                // æ¨¡æ‹Ÿä¸€æ¬¡å®Œæ•´çš„æ’ç›˜è®¡ç®—
                const dateObj = new Date();
                const year = dateObj.getFullYear();
                const month = dateObj.getMonth() + 1;
                const day = dateObj.getDate();
                const hour = dateObj.getHours();

                const upperGua = (year + month + day) % 8;
                const lowerGua = (year + month + day + hour) % 8;
                const changingLine = ((year + month + day + hour - 1) % 6) + 1;

                const endTime = performance.now();
                totalTime += (endTime - startTime);
            }

            const avgTime = Math.round(totalTime / iterations * 100) / 100;
            const isAcceptable = avgTime < 10; // éœ€æ±‚è§„å®šå•æ¬¡æ’ç›˜<10ms

            recordTestResult('performance-results',
                `æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆ${iterations}æ¬¡ï¼‰`,
                isAcceptable,
                `å¹³å‡è®¡ç®—æ—¶é—´ï¼š${avgTime}ms | éœ€æ±‚æ ‡å‡†ï¼š<10ms | çŠ¶æ€ï¼š${isAcceptable ? 'ç¬¦åˆè¦æ±‚' : 'éœ€è¦ä¼˜åŒ–'}`,
                Math.round(totalTime));
        }

        // å›å½’æµ‹è¯•
        function runRegressionTests() {
            clearResults();

            // è¿è¡Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼Œç¡®ä¿ä¿®å¤åæ²¡æœ‰å¼•å…¥æ–°é—®é¢˜
            testTimeHexagramChangingLine();
            testBaguaMapping();
            runNumberDivinationTests();
            runPerformanceTests();

            recordTestResult('algorithm-results', 'å›å½’æµ‹è¯•å®Œæˆ', true,
                'å·²éªŒè¯æ ¸å¿ƒåŠŸèƒ½åœ¨ä¿®å¤åä»ç„¶æ­£å¸¸å·¥ä½œ');
        }

        // æ‰§è¡Œå…¨éƒ¨æµ‹è¯•
        function runAllTests() {
            clearResults();
            testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };

            const startTime = performance.now();

            // æ‰§è¡Œæ‰€æœ‰æµ‹è¯•æ¨¡å—
            runCoreAlgorithmTests();
            runNumberDivinationTests();
            runLiushenTests();
            runShiyingTests();
            runKongwangTests();
            runPerformanceTests();

            const endTime = performance.now();
            const totalTime = Math.round(endTime - startTime);

            // ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
            generateSummaryReport(totalTime);
        }

        // ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
        function generateSummaryReport(totalTime) {
            const passRate = Math.round((testStats.passed / testStats.total) * 100);
            const grade = getSystemGrade(passRate);

            const summaryHtml = `
                <table>
                    <tr><th>æŒ‡æ ‡</th><th>ç»“æœ</th><th>è¯„ä»·</th></tr>
                    <tr><td>æ€»æµ‹è¯•ç”¨ä¾‹</td><td>${testStats.total}</td><td>-</td></tr>
                    <tr><td>é€šè¿‡ç”¨ä¾‹</td><td>${testStats.passed}</td><td style="color: var(--success-color)">âœ…</td></tr>
                    <tr><td>å¤±è´¥ç”¨ä¾‹</td><td>${testStats.failed}</td><td style="color: var(--error-color)">${testStats.failed > 0 ? 'âŒ' : 'âœ…'}</td></tr>
                    <tr><td>è­¦å‘Šç”¨ä¾‹</td><td>${testStats.warnings}</td><td style="color: var(--warning-color)">${testStats.warnings > 0 ? 'âš ï¸' : 'âœ…'}</td></tr>
                    <tr><td>é€šè¿‡ç‡</td><td>${passRate}%</td><td style="color: ${grade.color}">${grade.icon}</td></tr>
                    <tr><td>æ€»æµ‹è¯•æ—¶é—´</td><td>${totalTime}ms</td><td>${totalTime < 1000 ? 'âœ…' : 'âš ï¸'}</td></tr>
                    <tr><td>ç³»ç»Ÿè¯„çº§</td><td>${grade.level}</td><td style="color: ${grade.color}">${grade.icon}</td></tr>
                </table>

                <div style="margin-top: 20px; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 8px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">æµ‹è¯•å»ºè®®</h3>
                    <p>${grade.suggestion}</p>
                </div>
            `;

            document.getElementById('summary-results').innerHTML = summaryHtml;
        }

        // ç³»ç»Ÿè¯„çº§
        function getSystemGrade(passRate) {
            if (passRate >= 90) {
                return {
                    level: 'ä¼˜ç§€',
                    color: 'var(--success-color)',
                    icon: 'ğŸ†',
                    suggestion: 'ç³»ç»Ÿè´¨é‡ä¼˜ç§€ï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ã€‚å»ºè®®ç»§ç»­ä¿æŒå¹¶è€ƒè™‘åŠŸèƒ½æ‰©å±•ã€‚'
                };
            } else if (passRate >= 80) {
                return {
                    level: 'è‰¯å¥½',
                    color: 'var(--primary-color)',
                    icon: 'ğŸ‘',
                    suggestion: 'ç³»ç»Ÿè´¨é‡è‰¯å¥½ï¼Œå»ºè®®ä¿®å¤å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹åæŠ•å…¥ä½¿ç”¨ã€‚'
                };
            } else if (passRate >= 60) {
                return {
                    level: 'ä¸€èˆ¬',
                    color: 'var(--warning-color)',
                    icon: 'âš ï¸',
                    suggestion: 'ç³»ç»Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå»ºè®®ä¼˜å…ˆä¿®å¤å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ã€‚'
                };
            } else {
                return {
                    level: 'éœ€æ”¹è¿›',
                    color: 'var(--error-color)',
                    icon: 'âŒ',
                    suggestion: 'ç³»ç»Ÿå­˜åœ¨è¾ƒå¤šé—®é¢˜ï¼Œå»ºè®®å…¨é¢ä¿®å¤åå†è€ƒè™‘å‘å¸ƒã€‚'
                };
            }
        }

        // æ¸…é™¤æµ‹è¯•ç»“æœ
        function clearResults() {
            const resultContainers = [
                'algorithm-results', 'time-divination-results', 'number-divination-results',
                'coin-divination-results', 'najia-results', 'liushen-results',
                'liuqin-results', 'shiying-results', 'kongwang-results',
                'performance-results', 'summary-results'
            ];

            resultContainers.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });

            testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œä¸€æ¬¡å¿«é€Ÿæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                recordTestResult('algorithm-results', 'æµ‹è¯•å¥—ä»¶åˆå§‹åŒ–', true,
                    'æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•');
            }, 500);
        });
    </script>
</body>
</html>