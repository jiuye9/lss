<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…­çˆ»æ’ç›˜ç³»ç»Ÿ - ä¼˜åŒ–ç‰ˆ</title>
    <style>
        :root {
            /* ä¸­å¼ä¼ ç»Ÿé…è‰²æ–¹æ¡ˆ - å¢¨éŸµé‡‘è¾‰ä¸»é¢˜ */
            --primary-color: #D4AF37;        /* é‡‘é»„ - ä¼ ç»Ÿçš‡å®¶é‡‘è‰² */
            --secondary-color: #B8860B;      /* æš—é‡‘ */
            --accent-color: #8B4513;         /* èµ¤è¤ - ä¼ ç»Ÿæœ±ç ‚è‰²è°ƒ */
            --text-color: #F5F5DC;           /* ç±³ç™½ - å®£çº¸è‰² */
            --text-secondary: #C0C0C0;       /* é“¶ç° */
            --bg-color: #1A1A1A;             /* å¢¨é»‘ */
            --bg-secondary: #2C2C2C;         /* æ·±ç° */
            --card-bg: #2F2F2F;              /* å¡ç‰‡èƒŒæ™¯ - æ·¡å¢¨è‰² */
            --card-hover: #3A3A3A;           /* å¡ç‰‡æ‚¬åœ */
            --border-color: #4A4A4A;         /* è¾¹æ¡†è‰² */
            --border-accent: #D4AF37;        /* å¼ºè°ƒè¾¹æ¡† - é‡‘è‰² */
            --success-color: #228B22;        /* ç¿ ç»¿ */
            --warning-color: #FF8C00;        /* æ©™çº¢ */
            --error-color: #DC143C;          /* æ·±çº¢ */

            /* é˜´é˜³é…è‰² - ä¼ ç»Ÿæ˜“ç»é…è‰² */
            --yang-color: #FF6B6B;           /* é˜³çˆ» - æœ±çº¢ */
            --yin-color: #4ECDC4;            /* é˜´çˆ» - é’è‰² */
            --changing-color: #D4AF37;       /* åŠ¨çˆ» - é‡‘è‰² */

            /* äº”è¡Œé…è‰² */
            --wood-color: #32CD32;           /* æœ¨ - ç»¿è‰² */
            --fire-color: #FF4500;           /* ç« - çº¢è‰² */
            --earth-color: #DAA520;          /* åœŸ - é»„è‰² */
            --metal-color: #C0C0C0;          /* é‡‘ - é“¶ç™½ */
            --water-color: #1E90FF;          /* æ°´ - è“è‰² */

            /* ä¼ ç»Ÿæ¸å˜ */
            --gradient-primary: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
            --gradient-secondary: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            --gradient-bg: radial-gradient(ellipse at top, #2C2C2C 0%, #1A1A1A 100%);
            --gradient-card: linear-gradient(145deg, #2F2F2F 0%, #252525 100%);

            /* ä¼ ç»Ÿçº¹ç†æ•ˆæœ */
            --paper-texture: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%23000' fill-opacity='0.02' d='m0,0h2v2h-2zm2,2h2v2h-2z'/%3E%3C/svg%3E");
            --ink-texture: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Cg fill='%23D4AF37' fill-opacity='0.03'%3E%3Cpolygon points='10,0 20,0 20,10'/%3E%3Cpolygon points='0,10 0,20 10,20'/%3E%3C/g%3E%3C/svg%3E");
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', 'Source Han Sans CN', sans-serif;
            line-height: 1.7;
            color: var(--text-color);
            background: var(--gradient-bg);
            min-height: 100vh;
            position: relative;
            letter-spacing: 0.5px;
        }

        /* ä¼ ç»Ÿçº¹ç†èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                var(--paper-texture),
                radial-gradient(circle at 20% 20%, rgba(212, 175, 55, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(139, 69, 19, 0.02) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(212, 175, 55, 0.01) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }

        /* æ·»åŠ ä¼ ç»Ÿè¾¹æ¡†è£…é¥° */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid transparent;
            background: linear-gradient(45deg,
                var(--primary-color) 0%,
                transparent 10%,
                transparent 90%,
                var(--primary-color) 100%) border-box;
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask-composite: xor;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ä¼ ç»Ÿä¸­å¼æ ‡é¢˜åŒºåŸŸ */
        .header {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 40px;
            background: var(--gradient-card);
            border: 2px solid var(--border-accent);
            border-radius: 16px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(212, 175, 55, 0.2);
        }

        /* ä¼ ç»Ÿè£…é¥°è¾¹æ¡† */
        .header::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 1px solid var(--primary-color);
            border-radius: 12px;
            opacity: 0.3;
            pointer-events: none;
        }

        /* å››è§’è£…é¥° */
        .header::after {
            content: 'â—† â—‡ â—†';
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--primary-color);
            font-size: 0.8rem;
            opacity: 0.6;
            letter-spacing: 8px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 600;
            position: relative;
            text-shadow:
                2px 2px 4px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(212, 175, 55, 0.4);
            letter-spacing: 3px;
        }

        /* æ ‡é¢˜ä¸‹æ–¹è£…é¥°çº¿ */
        .header h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 2px;
            background: linear-gradient(90deg,
                transparent,
                var(--primary-color),
                var(--secondary-color),
                var(--primary-color),
                transparent);
            border-radius: 1px;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
            margin-top: 20px;
            opacity: 0.9;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
        }

        /* å¹³æ¿ç«¯å¸ƒå±€ä¼˜åŒ– */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }

            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header {
                padding: 25px 20px;
            }

            .header h1 {
                font-size: 2.2rem;
            }
        }

        /* æ‰‹æœºç«¯å¸ƒå±€ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                max-width: 100%;
            }

            .main-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .header {
                padding: 20px 15px;
                margin-bottom: 20px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 1rem;
            }

            .main-card {
                border-radius: 15px;
                margin-bottom: 15px;
            }

            .card-header {
                padding: 20px 15px;
            }

            .card-header h2 {
                font-size: 1.2rem;
            }

            .card-body {
                padding: 20px 15px;
            }
        }

        /* å°å±æ‰‹æœºç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }

            .header {
                padding: 15px 12px;
                margin-bottom: 15px;
            }

            .header h1 {
                font-size: 1.6rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .main-card {
                border-radius: 12px;
                margin-bottom: 12px;
            }

            .card-header {
                padding: 15px 12px;
            }

            .card-body {
                padding: 15px 12px;
            }

            .datetime-group {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .manual-inputs {
                grid-template-columns: 1fr;
            }

            input, select, textarea {
                padding: 10px 12px;
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
            }

            .btn {
                padding: 12px 25px;
                font-size: 1rem;
                width: 100%;
                border-radius: 12px;
            }

            .method-tabs {
                flex-direction: column;
                gap: 8px;
                border-radius: 12px;
            }

            .method-tab {
                padding: 12px 15px;
                font-size: 0.9rem;
                border-radius: 8px;
            }

            .tab-content {
                border-radius: 0 0 12px 12px;
                padding: 15px;
            }

            .manual-method-tabs {
                flex-direction: column;
                gap: 6px;
            }

            .manual-method-btn {
                min-width: auto;
                padding: 10px 12px;
                font-size: 0.85rem;
            }

            .ai-reasoning-content {
                min-height: 300px;
            }

            /* æ‰‹æœºç«¯å¦è±¡æ˜¾ç¤ºä¼˜åŒ– */
            .hexagram-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .pure-line {
                width: 130px;
                height: 28px;
                font-size: 0.9rem;
            }

            .hexagram-lines {
                justify-self: center;
            }

            /* é“œé’±æ‘‡å¦æ‰‹æœºç«¯ä¼˜åŒ– */
            .coin-throw {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                padding: 12px;
            }

            .coin-throw h4 {
                text-align: center;
                min-width: auto;
                margin-bottom: 5px;
            }

            .coin-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-left: 0;
            }

            .coin-btn {
                padding: 8px 10px;
                font-size: 0.8rem;
                min-width: auto;
                text-align: center;
            }

            .coin-result {
                margin-left: 0;
                text-align: center;
                min-width: auto;
                margin-top: 8px;
            }

            /* è£…å¦è¡¨æ ¼æ‰‹æœºç«¯ä¼˜åŒ– */
            .zhuanggua-table {
                font-size: 0.8rem;
            }

            .zhuanggua-table th,
            .zhuanggua-table td {
                padding: 8px 6px;
                font-size: 0.75rem;
            }

            /* è®¡ç®—ç»“æœæ˜¾ç¤ºä¼˜åŒ– */
            .number-calculation-result {
                flex-direction: column;
                gap: 10px;
            }

            .calc-item {
                padding: 8px;
                font-size: 0.9rem;
            }

            /* å…«å¦å¯¹ç…§è¡¨ä¼˜åŒ– */
            .gua-reference div[style*="grid"] {
                grid-template-columns: 1fr 1fr !important;
                font-size: 0.8rem !important;
            }
        }

        /* ä¼ ç»Ÿå¡ç‰‡è®¾è®¡ */
        .main-card {
            background: var(--gradient-card);
            border-radius: 16px;
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(212, 175, 55, 0.15);
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        /* ä¼ ç»Ÿè£…é¥°è¾¹æ¡† */
        .main-card::before {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 1px solid var(--primary-color);
            border-radius: 12px;
            opacity: 0.2;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .main-card:hover {
            border-color: var(--border-accent);
            transform: translateY(-4px) scale(1.02);
            box-shadow:
                0 20px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(212, 175, 55, 0.25),
                0 0 30px rgba(212, 175, 55, 0.15);
        }

        .main-card:hover::before {
            opacity: 0.4;
        }

        .card-header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.8s;
        }

        .card-header:hover::before {
            left: 100%;
        }

        .card-header h2 {
            font-weight: 600;
            font-size: 1.3rem;
            position: relative;
            z-index: 1;
        }

        .card-body {
            padding: 25px;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(51, 65, 85, 0.5);
            color: var(--text-color);
            backdrop-filter: blur(10px);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow:
                0 0 0 3px rgba(6, 182, 212, 0.2),
                0 4px 12px rgba(0, 0, 0, 0.3);
            background: rgba(51, 65, 85, 0.8);
        }

        input::placeholder, textarea::placeholder {
            color: var(--text-secondary);
        }

        select option {
            background: var(--card-bg);
            color: var(--text-color);
        }

        .datetime-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 480px) {
            .datetime-group {
                grid-template-columns: 1fr;
            }
        }

        .method-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 12px 12px 0 0;
            overflow: hidden;
        }

        .method-tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            position: relative;
        }

        .method-tab:hover {
            background: rgba(51, 65, 85, 0.5);
            color: var(--text-color);
        }

        .method-tab.active {
            background: rgba(51, 65, 85, 0.8);
            color: var(--primary-color);
        }

        .method-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
        }

        .tab-content {
            display: none;
            padding: 20px;
            background: rgba(51, 65, 85, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .coin-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .coin-throw {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .coin-throw:hover {
            border-color: var(--accent-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            background: rgba(15, 23, 42, 0.6);
        }

        .coin-throw.completed {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .coin-throw h4 {
            margin: 0;
            color: var(--primary-color);
            font-weight: bold;
            min-width: 60px;
            font-size: 1.1rem;
        }

        .coin-buttons {
            display: flex;
            gap: 10px;
            margin-left: 20px;
            flex: 1;
        }

        .coin-btn {
            padding: 10px 16px;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 70px;
        }

        .coin-btn.yang {
            background: var(--yang-color);
            color: white;
        }

        .coin-btn.yang:hover {
            background: #FF5252;
            border-color: #FF1744;
        }

        .coin-btn.yin {
            background: var(--yin-color);
            color: white;
        }

        .coin-btn.yin:hover {
            background: #26C6DA;
            border-color: #00BCD4;
        }

        .coin-btn.active {
            border-color: var(--gold-color);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.3);
            transform: scale(1.05);
        }

        .coin-result {
            margin-left: auto;
            min-width: 80px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
            background: var(--card-bg);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .manual-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 480px) {
            .manual-inputs {
                grid-template-columns: 1fr;
            }
        }

        .manual-method-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 10px;
            background: var(--bg-color);
            border-radius: 8px;
        }

        .manual-method-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .manual-method-btn:hover {
            border-color: var(--accent-color);
            background: rgba(218, 165, 32, 0.1);
        }

        .manual-method-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .manual-method {
            display: none;
        }

        .manual-method.active {
            display: block;
        }

        .lines-input-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .line-input {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .line-input label {
            min-width: 50px;
            margin: 0;
            margin-right: 15px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .line-select {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--card-bg);
        }

        input[type="number"] small,
        input[type="text"] + small {
            display: block;
            margin-top: 5px;
            font-size: 0.8rem;
            color: var(--secondary-color);
            font-style: italic;
        }

        .gua-reference {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-color);
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
            font-size: 0.9rem;
        }

        .gua-reference h4 {
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .number-calculation-result {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 2px solid var(--border-color);
            margin-top: 10px;
        }

        .calc-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 6px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .calc-item span {
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .btn {
            display: inline-block;
            padding: 16px 40px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow:
                0 8px 25px rgba(0, 0, 0, 0.3),
                0 4px 10px rgba(139, 124, 246, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow:
                0 12px 35px rgba(0, 0, 0, 0.4),
                0 6px 15px rgba(139, 124, 246, 0.3);
        }

        .btn:hover::before {
            left: 100%;
        }

        .start-btn-container {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }

        .result-container {
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .hexagram-display {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .hexagram-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid var(--border-color);
        }

        .hexagram-card.main-gua {
            border-color: var(--primary-color);
        }

        .hexagram-card.changed-gua {
            border-color: var(--accent-color);
        }

        /* ä¼ ç»Ÿå¦åè®¾è®¡ */
        .hexagram-name {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--primary-color);
            text-align: center;
            padding: 20px 0;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 2px;
        }

        /* å¦åè£…é¥°è¾¹æ¡† */
        .hexagram-name::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 3px;
            background: linear-gradient(90deg,
                transparent,
                var(--primary-color),
                var(--secondary-color),
                var(--primary-color),
                transparent);
            border-radius: 1.5px;
        }

        /* å¦åä¸¤ä¾§è£…é¥° */
        .hexagram-name::after {
            content: 'â—‡ â—† â—‡';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--primary-color);
            font-size: 0.7rem;
            opacity: 0.7;
            letter-spacing: 6px;
        }

        .hexagram-content {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            align-items: start;
        }

        @media (max-width: 768px) {
            .hexagram-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .hexagram-lines {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        /* ä¼ ç»Ÿé˜´é˜³çˆ»è®¾è®¡ */
        .pure-line {
            width: 200px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.3rem;
            position: relative;
            margin: 6px 0;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .pure-line.yang {
            background: linear-gradient(135deg, var(--yang-color) 0%, #FF4757 100%);
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .pure-line.yang:before {
            content: 'â–¬â–¬â–¬â–¬â–¬';
            font-family: 'SimHei', 'Microsoft YaHei', monospace;
            font-size: 1.4rem;
            font-weight: 900;
        }

        .pure-line.yin {
            background: linear-gradient(135deg, var(--yin-color) 0%, #3DC1D3 100%);
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .pure-line.yin:before {
            content: 'â–¬â–¬  â–¬â–¬';
            font-family: 'SimHei', 'Microsoft YaHei', monospace;
            font-size: 1.4rem;
            font-weight: 900;
        }

        /* åŠ¨çˆ»ç‰¹æ•ˆ */
        .pure-line.changing {
            border-color: var(--changing-color);
            animation: changingGlow 2.5s infinite;
            position: relative;
            overflow: hidden;
        }

        .pure-line.changing::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(212, 175, 55, 0.4),
                transparent);
            animation: shimmer 2s infinite;
        }

        /* ä¼˜åŒ–çš„åŠ¨ç”»æ•ˆæœ */
        @keyframes changingGlow {
            0%, 100% {
                border-color: var(--changing-color);
                box-shadow:
                    0 4px 12px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(212, 175, 55, 0.3);
            }
            50% {
                border-color: var(--secondary-color);
                box-shadow:
                    0 4px 12px rgba(0, 0, 0, 0.3),
                    0 0 30px rgba(212, 175, 55, 0.6);
            }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7), 0 2px 8px rgba(0,0,0,0.2); }
            70% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0), 0 2px 8px rgba(0,0,0,0.2); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0), 0 2px 8px rgba(0,0,0,0.2); }
        }

        .world-mark, .response-mark {
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .world-mark {
            background: var(--red-color);
        }

        .response-mark {
            background: var(--blue-color);
        }

        .dong-yao {
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gold-color);
            color: #333;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* ä¼ ç»Ÿè£…å¦è¡¨æ ¼è®¾è®¡ */
        .zhuanggua-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            background: var(--gradient-card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(212, 175, 55, 0.1);
            border: 2px solid var(--border-accent);
            font-size: 0.95rem;
        }

        .zhuanggua-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 18px 12px;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            white-space: nowrap;
            position: relative;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }

        .zhuanggua-table th:first-child {
            border-top-left-radius: 10px;
        }

        .zhuanggua-table th:last-child {
            border-top-right-radius: 10px;
        }

        .zhuanggua-table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 10%;
            right: 10%;
            height: 1px;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent);
        }

        .zhuanggua-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
            font-weight: 500;
            font-size: 0.85rem;
            vertical-align: middle;
            transition: all 0.3s ease;
            position: relative;
        }

        .zhuanggua-table tr:last-child td {
            border-bottom: none;
        }

        .zhuanggua-table tr:last-child td:first-child {
            border-bottom-left-radius: 10px;
        }

        .zhuanggua-table tr:last-child td:last-child {
            border-bottom-right-radius: 10px;
        }

        .zhuanggua-table tbody tr:nth-child(even) {
            background: rgba(212, 175, 55, 0.05);
        }

        .zhuanggua-table tbody tr:hover {
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.01);
        }

        /* ä¼ ç»Ÿå•å…ƒæ ¼æ ·å¼ - å‡å°‘è‰²å½©å±‚å  */
        .liushen-cell {
            color: var(--primary-color);
            font-weight: 600;
            background: linear-gradient(135deg,
                rgba(212, 175, 55, 0.1) 0%,
                rgba(212, 175, 55, 0.05) 100%);
            border-left: 3px solid var(--primary-color);
            position: relative;
        }

        .liuqin-cell {
            color: var(--wood-color);
            font-weight: 600;
            background: linear-gradient(135deg,
                rgba(50, 205, 50, 0.08) 0%,
                rgba(50, 205, 50, 0.03) 100%);
            border-left: 3px solid var(--wood-color);
        }

        .nazhi-cell {
            color: var(--text-color);
            font-weight: 600;
            font-family: 'KaiTi', 'SimKai', serif;
            background: linear-gradient(135deg,
                rgba(245, 245, 220, 0.05) 0%,
                rgba(245, 245, 220, 0.02) 100%);
            letter-spacing: 1px;
        }

        .nazhi-cell.kong {
            color: var(--error-color);
            text-decoration: line-through;
            background: linear-gradient(135deg,
                rgba(220, 20, 60, 0.1) 0%,
                rgba(220, 20, 60, 0.05) 100%);
            position: relative;
        }

        .nazhi-cell.kong::before {
            content: 'ç©º';
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error-color);
            color: white;
            font-size: 0.6rem;
            padding: 1px 3px;
            border-radius: 2px;
            font-weight: bold;
        }

        .yaopai-cell {
            color: var(--text-color);
            font-weight: 700;
            background: linear-gradient(135deg,
                rgba(47, 47, 47, 0.8) 0%,
                rgba(37, 37, 37, 0.6) 100%);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .shying-cell {
            color: var(--accent-color);
            font-weight: 700;
            font-size: 1.1rem;
            position: relative;
        }

        .shying-cell:not(:empty) {
            background: radial-gradient(circle,
                rgba(139, 69, 19, 0.2) 0%,
                transparent 70%);
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            line-height: 28px;
            margin: 0 auto;
            animation: shiying-glow 3s infinite;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        @keyframes shiying-glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(139, 69, 19, 0.3);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 15px rgba(139, 69, 19, 0.6);
                transform: scale(1.05);
            }
        }

        .dongjing-cell.dong {
            color: var(--yang-color);
            font-weight: 700;
            background: linear-gradient(135deg,
                rgba(255, 107, 107, 0.15) 0%,
                rgba(255, 107, 107, 0.05) 100%);
            text-shadow: 1px 1px 2px rgba(255, 107, 107, 0.3);
        }

        .dongjing-cell.jing {
            color: var(--text-secondary);
            font-weight: 400;
            opacity: 0.8;
            background: rgba(192, 192, 192, 0.05);
        }

        /* å“åº”å¼è¡¨æ ¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .zhuanggua-table {
                font-size: 0.75rem;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .zhuanggua-table th,
            .zhuanggua-table td {
                padding: 8px 4px;
                font-size: 0.7rem;
                min-width: 50px;
            }

            .shying-cell:not(:empty) {
                width: 24px;
                height: 24px;
                line-height: 20px;
                font-size: 0.8rem;
            }
        }

        /* è¡¨æ ¼å®¹å™¨å¢å¼º */
        .table-container {
            position: relative;
            overflow-x: auto;
            margin-top: 15px;
        }

        .table-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            border-radius: 12px 12px 0 0;
            z-index: 1;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .detail-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
        }

        .detail-content {
            line-height: 1.8;
        }

        .detail-content p {
            margin-bottom: 10px;
        }

        .detail-content ul {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .detail-content li {
            margin-bottom: 5px;
        }

        /* AIæ¨ç†åŒºåŸŸæ ·å¼ */
        .ai-reasoning-card {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--accent-color);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(6, 182, 212, 0.2),
                0 0 20px rgba(6, 182, 212, 0.1);
        }

        .ai-reasoning-content {
            min-height: 400px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .ai-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: var(--secondary-color);
            font-style: italic;
        }

        .ai-result {
            padding: 20px;
            background: var(--bg-color);
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
            margin-top: 15px;
        }

        .ai-prompt-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .ai-prompt-section h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .pure-line {
                width: 150px;
                height: 30px;
                font-size: 1rem;
            }

            .coin-buttons {
                flex-wrap: wrap;
            }

            .coin-btn {
                min-width: 60px;
                font-size: 0.8rem;
                padding: 8px 12px;
            }

            .details-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å…­çˆ»æ’ç›˜ç³»ç»Ÿ</h1>
            <p>åŸºäºã€Šå¢åˆ è¡¥æ˜“ã€‹ä¼ ç»Ÿæ–¹æ³•çš„ä¸“ä¸šæ’ç›˜å·¥å…·</p>
        </div>

        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šèµ·å¦è®¾ç½®åŒºåŸŸ -->
            <div class="main-card">
                <div class="card-header">
                    <h2>èµ·å¦è®¾ç½®</h2>
                </div>
                <div class="card-body">
                    <div class="form-section">
                        <h3 class="section-title">åŸºæœ¬ä¿¡æ¯</h3>
                        <div class="form-group">
                            <label for="question">æ‰€é—®ä¹‹äº‹ï¼š</label>
                            <textarea id="question" rows="3" placeholder="è¯·è¾“å…¥æ‚¨è¦å åœçš„é—®é¢˜..."></textarea>
                        </div>
                        <div class="datetime-group">
                            <div class="form-group">
                                <label for="date">èµ·å¦æ—¥æœŸï¼š</label>
                                <input type="date" id="date">
                            </div>
                            <div class="form-group">
                                <label for="time">èµ·å¦æ—¶é—´ï¼š</label>
                                <input type="time" id="time">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">èµ·å¦æ–¹å¼</h3>
                        <div class="method-tabs">
                            <button class="method-tab active" data-method="time">æ—¶é—´èµ·å¦</button>
                            <button class="method-tab" data-method="coins">é“œé’±èµ·å¦</button>
                            <button class="method-tab" data-method="manual">æ‰‹åŠ¨æŒ‡å®š</button>
                        </div>

                        <div id="time-tab" class="tab-content active">
                            <p class="tab-description">
                                ğŸ“… æ ¹æ®æ‚¨è¾“å…¥çš„èµ·å¦æ—¶é—´ï¼ŒæŒ‰ç…§ä¼ ç»Ÿæ—¶é—´èµ·å¦æ³•è‡ªåŠ¨ç”Ÿæˆå¦è±¡ã€‚æ­¤æ–¹æ³•ç®€å•å¿«æ·ï¼Œé€‚åˆæ—¥å¸¸å åœä½¿ç”¨ã€‚
                            </p>
                        </div>

                        <div id="coins-tab" class="tab-content">
                            <p class="tab-description">
                                ğŸª™ ä¼ ç»Ÿä¸‰æšé“œé’±æ‘‡å¦æ³•ï¼Œæœ€ä¸ºæ­£å®—ã€‚è¯·æŒ‰ç…§ä»ä¸‹åˆ°ä¸Šï¼ˆåˆçˆ»â†’ä¸Šçˆ»ï¼‰çš„é¡ºåºï¼Œä¾æ¬¡é€‰æ‹©æ¯ä¸€çˆ»çš„æ‘‡å¦ç»“æœï¼š
                            </p>
                            <div class="coin-container">
                                <div class="coin-throw" data-line="1">
                                    <h4>åˆçˆ»</h4>
                                    <div class="coin-buttons">
                                        <button class="coin-btn yang" onclick="setCoinResult(1, 'è€é˜³')">è€é˜³</button>
                                        <button class="coin-btn yang" onclick="setCoinResult(1, 'å°‘é˜³')">å°‘é˜³</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(1, 'å°‘é˜´')">å°‘é˜´</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(1, 'è€é˜´')">è€é˜´</button>
                                    </div>
                                    <div class="coin-result" id="coin-result-1"></div>
                                </div>
                                <div class="coin-throw" data-line="2">
                                    <h4>äºŒçˆ»</h4>
                                    <div class="coin-buttons">
                                        <button class="coin-btn yang" onclick="setCoinResult(2, 'è€é˜³')">è€é˜³</button>
                                        <button class="coin-btn yang" onclick="setCoinResult(2, 'å°‘é˜³')">å°‘é˜³</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(2, 'å°‘é˜´')">å°‘é˜´</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(2, 'è€é˜´')">è€é˜´</button>
                                    </div>
                                    <div class="coin-result" id="coin-result-2"></div>
                                </div>
                                <div class="coin-throw" data-line="3">
                                    <h4>ä¸‰çˆ»</h4>
                                    <div class="coin-buttons">
                                        <button class="coin-btn yang" onclick="setCoinResult(3, 'è€é˜³')">è€é˜³</button>
                                        <button class="coin-btn yang" onclick="setCoinResult(3, 'å°‘é˜³')">å°‘é˜³</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(3, 'å°‘é˜´')">å°‘é˜´</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(3, 'è€é˜´')">è€é˜´</button>
                                    </div>
                                    <div class="coin-result" id="coin-result-3"></div>
                                </div>
                                <div class="coin-throw" data-line="4">
                                    <h4>å››çˆ»</h4>
                                    <div class="coin-buttons">
                                        <button class="coin-btn yang" onclick="setCoinResult(4, 'è€é˜³')">è€é˜³</button>
                                        <button class="coin-btn yang" onclick="setCoinResult(4, 'å°‘é˜³')">å°‘é˜³</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(4, 'å°‘é˜´')">å°‘é˜´</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(4, 'è€é˜´')">è€é˜´</button>
                                    </div>
                                    <div class="coin-result" id="coin-result-4"></div>
                                </div>
                                <div class="coin-throw" data-line="5">
                                    <h4>äº”çˆ»</h4>
                                    <div class="coin-buttons">
                                        <button class="coin-btn yang" onclick="setCoinResult(5, 'è€é˜³')">è€é˜³</button>
                                        <button class="coin-btn yang" onclick="setCoinResult(5, 'å°‘é˜³')">å°‘é˜³</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(5, 'å°‘é˜´')">å°‘é˜´</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(5, 'è€é˜´')">è€é˜´</button>
                                    </div>
                                    <div class="coin-result" id="coin-result-5"></div>
                                </div>
                                <div class="coin-throw" data-line="6">
                                    <h4>ä¸Šçˆ»</h4>
                                    <div class="coin-buttons">
                                        <button class="coin-btn yang" onclick="setCoinResult(6, 'è€é˜³')">è€é˜³</button>
                                        <button class="coin-btn yang" onclick="setCoinResult(6, 'å°‘é˜³')">å°‘é˜³</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(6, 'å°‘é˜´')">å°‘é˜´</button>
                                        <button class="coin-btn yin" onclick="setCoinResult(6, 'è€é˜´')">è€é˜´</button>
                                    </div>
                                    <div class="coin-result" id="coin-result-6"></div>
                                </div>
                            </div>
                        </div>

                        <div id="manual-tab" class="tab-content">
                            <p class="tab-description">
                                âœ‹ å¤šç§æ–¹å¼ç›´æ¥æŒ‡å®šå¦è±¡ï¼Œé€‚åˆå·²çŸ¥å¦è±¡æˆ–ç‰¹å®šéœ€æ±‚çš„æƒ…å†µã€‚
                            </p>

                            <div class="manual-method-tabs">
                                <button class="manual-method-btn active" data-manual="hexname">å¦åé€‰æ‹©</button>
                                <button class="manual-method-btn" data-manual="numbers">æ•°å­—èµ·å¦</button>
                                <button class="manual-method-btn" data-manual="binary">äºŒè¿›åˆ¶</button>
                                <button class="manual-method-btn" data-manual="lines">é€çˆ»æŒ‡å®š</button>
                            </div>

                            <div id="hexname-method" class="manual-method active">
                                <div class="manual-inputs">
                                    <div class="form-group">
                                        <label for="original-hex">æœ¬å¦ï¼š</label>
                                        <select id="original-hex">
                                            <option value="">è¯·é€‰æ‹©æœ¬å¦</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="changed-hex">å˜å¦ï¼š</label>
                                        <select id="changed-hex">
                                            <option value="">è¯·é€‰æ‹©å˜å¦ï¼ˆå¯é€‰ï¼‰</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="numbers-method" class="manual-method">
                                <div class="manual-inputs">
                                    <div class="form-group">
                                        <label for="upper-number">ä¸Šå¦æ•°ï¼š</label>
                                        <input type="number" id="upper-number" min="1" placeholder="ä»»æ„æ­£æ•´æ•°" oninput="updateNumberCalculation()">
                                        <small>è¾“å…¥ä»»æ„æ­£æ•´æ•°ï¼Œç³»ç»Ÿè‡ªåŠ¨å–ä½™æ•°è®¡ç®—ä¸Šå¦</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="lower-number">ä¸‹å¦æ•°ï¼š</label>
                                        <input type="number" id="lower-number" min="1" placeholder="ä»»æ„æ­£æ•´æ•°" oninput="updateNumberCalculation()">
                                        <small>è¾“å…¥ä»»æ„æ­£æ•´æ•°ï¼Œç³»ç»Ÿè‡ªåŠ¨å–ä½™æ•°è®¡ç®—ä¸‹å¦</small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>è‡ªåŠ¨è®¡ç®—ç»“æœï¼š</label>
                                    <div id="number-result" class="number-calculation-result">
                                        <div class="calc-item">ä¸Šå¦ï¼š<span id="calc-upper">-</span></div>
                                        <div class="calc-item">ä¸‹å¦ï¼š<span id="calc-lower">-</span></div>
                                        <div class="calc-item">åŠ¨çˆ»ï¼š<span id="calc-line">-</span></div>
                                    </div>
                                </div>
                                <div class="gua-reference">
                                    <h4>å…«å¦æ•°å­—å¯¹ç…§è¡¨ï¼š</h4>
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; font-size: 0.9rem;">
                                        <div>1 ä¹¾ â˜° (å¤©)</div>
                                        <div>2 å…‘ â˜± (æ³½)</div>
                                        <div>3 ç¦» â˜² (ç«)</div>
                                        <div>4 éœ‡ â˜³ (é›·)</div>
                                        <div>5 å·½ â˜´ (é£)</div>
                                        <div>6 å â˜µ (æ°´)</div>
                                        <div>7 è‰® â˜¶ (å±±)</div>
                                        <div>8 å¤ â˜· (åœ°)</div>
                                    </div>
                                </div>
                            </div>

                            <div id="binary-method" class="manual-method">
                                <div class="form-group">
                                    <label for="binary-input">äºŒè¿›åˆ¶å¦è±¡ï¼š</label>
                                    <input type="text" id="binary-input" maxlength="6" placeholder="ä¾‹å¦‚ï¼š111111ï¼ˆ6ä½äºŒè¿›åˆ¶ï¼Œ1=é˜³çˆ»ï¼Œ0=é˜´çˆ»ï¼‰">
                                    <small>ä»ä¸Šåˆ°ä¸‹ï¼šä¸Šçˆ»â†’äº”çˆ»â†’å››çˆ»â†’ä¸‰çˆ»â†’äºŒçˆ»â†’åˆçˆ»</small>
                                </div>
                                <div class="form-group">
                                    <label for="changing-lines-input">åŠ¨çˆ»ä½ç½®ï¼š</label>
                                    <input type="text" id="changing-lines-input" placeholder="ä¾‹å¦‚ï¼š1,3,6ï¼ˆå¤šä¸ªåŠ¨çˆ»ç”¨é€—å·åˆ†éš”ï¼Œç•™ç©ºè¡¨ç¤ºé™å¦ï¼‰">
                                    <small>1=åˆçˆ», 2=äºŒçˆ», 3=ä¸‰çˆ», 4=å››çˆ», 5=äº”çˆ», 6=ä¸Šçˆ»</small>
                                </div>
                            </div>

                            <div id="lines-method" class="manual-method">
                                <div class="lines-input-container">
                                    <div class="line-input" data-line="6">
                                        <label>ä¸Šçˆ»ï¼š</label>
                                        <select class="line-select">
                                            <option value="">è¯·é€‰æ‹©</option>
                                            <option value="è€é˜³">è€é˜³ âšŠ â—‹</option>
                                            <option value="å°‘é˜³">å°‘é˜³ âšŠ</option>
                                            <option value="å°‘é˜´">å°‘é˜´ âš‹</option>
                                            <option value="è€é˜´">è€é˜´ âš‹ Ã—</option>
                                        </select>
                                    </div>
                                    <div class="line-input" data-line="5">
                                        <label>äº”çˆ»ï¼š</label>
                                        <select class="line-select">
                                            <option value="">è¯·é€‰æ‹©</option>
                                            <option value="è€é˜³">è€é˜³ âšŠ â—‹</option>
                                            <option value="å°‘é˜³">å°‘é˜³ âšŠ</option>
                                            <option value="å°‘é˜´">å°‘é˜´ âš‹</option>
                                            <option value="è€é˜´">è€é˜´ âš‹ Ã—</option>
                                        </select>
                                    </div>
                                    <div class="line-input" data-line="4">
                                        <label>å››çˆ»ï¼š</label>
                                        <select class="line-select">
                                            <option value="">è¯·é€‰æ‹©</option>
                                            <option value="è€é˜³">è€é˜³ âšŠ â—‹</option>
                                            <option value="å°‘é˜³">å°‘é˜³ âšŠ</option>
                                            <option value="å°‘é˜´">å°‘é˜´ âš‹</option>
                                            <option value="è€é˜´">è€é˜´ âš‹ Ã—</option>
                                        </select>
                                    </div>
                                    <div class="line-input" data-line="3">
                                        <label>ä¸‰çˆ»ï¼š</label>
                                        <select class="line-select">
                                            <option value="">è¯·é€‰æ‹©</option>
                                            <option value="è€é˜³">è€é˜³ âšŠ â—‹</option>
                                            <option value="å°‘é˜³">å°‘é˜³ âšŠ</option>
                                            <option value="å°‘é˜´">å°‘é˜´ âš‹</option>
                                            <option value="è€é˜´">è€é˜´ âš‹ Ã—</option>
                                        </select>
                                    </div>
                                    <div class="line-input" data-line="2">
                                        <label>äºŒçˆ»ï¼š</label>
                                        <select class="line-select">
                                            <option value="">è¯·é€‰æ‹©</option>
                                            <option value="è€é˜³">è€é˜³ âšŠ â—‹</option>
                                            <option value="å°‘é˜³">å°‘é˜³ âšŠ</option>
                                            <option value="å°‘é˜´">å°‘é˜´ âš‹</option>
                                            <option value="è€é˜´">è€é˜´ âš‹ Ã—</option>
                                        </select>
                                    </div>
                                    <div class="line-input" data-line="1">
                                        <label>åˆçˆ»ï¼š</label>
                                        <select class="line-select">
                                            <option value="">è¯·é€‰æ‹©</option>
                                            <option value="è€é˜³">è€é˜³ âšŠ â—‹</option>
                                            <option value="å°‘é˜³">å°‘é˜³ âšŠ</option>
                                            <option value="å°‘é˜´">å°‘é˜´ âš‹</option>
                                            <option value="è€é˜´">è€é˜´ âš‹ Ã—</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="start-btn-container">
                        <button class="btn" onclick="calculateHexagram()">å¼€å§‹æ’ç›˜</button>
                    </div>
                </div>
            </div>

            <!-- ä¸­é—´ï¼šå¦è±¡æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="main-card result-container" id="result-container">
                <div class="card-header">
                    <h2>æ’ç›˜ç»“æœ</h2>
                </div>
                <div class="card-body">
                    <div id="hexagram-info"></div>
                    <div id="hexagram-display" class="hexagram-display"></div>
                    <div id="details-grid" class="details-grid"></div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šAIæ¨ç†åŒºåŸŸ -->
            <div class="main-card ai-reasoning-card" id="ai-reasoning-container">
                <div class="card-header">
                    <h2>AIå¦è±¡æ¨ç†</h2>
                </div>
                <div class="card-body">
                    <div class="ai-reasoning-content" id="ai-reasoning-content">
                        <div class="ai-loading" id="ai-default-content">
                            <p>ğŸ¤– è¯·å…ˆå®Œæˆèµ·å¦ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è°ƒç”¨AIè¿›è¡Œå¦è±¡åˆ†ææ¨ç†...</p>
                        </div>
                        <div id="ai-result-content" style="display: none;">
                            <div class="ai-prompt-section">
                                <h4>åˆ†æç»´åº¦</h4>
                                <p>â€¢ å¦è±¡åŸºæœ¬å«ä¹‰è§£è¯»<br>â€¢ ä¸–åº”å…³ç³»åˆ†æ<br>â€¢ ç”¨ç¥å–è±¡åˆ¤æ–­<br>â€¢ åŠ¨çˆ»å˜åŒ–å½±å“<br>â€¢ æ—¶ç©ºç¯å¢ƒè€ƒé‡</p>
                            </div>
                            <div class="ai-result" id="ai-analysis-result">
                                <!-- AIåˆ†æç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®Œæ•´çš„å…«å®«å…­åå››å¦å¯¹ç…§è¡¨æ•°æ®
        const HEXAGRAMS_FULL_DATA = [
            {"palace":"ä¹¾å®«","index":1,"symbol":"ä·€","name":"ä¹¾ä¸ºå¤©","element":"é‡‘","six_relations":["å­å­™å­æ°´","å¦»è´¢å¯…æœ¨","çˆ¶æ¯è¾°åœŸ","å®˜é¬¼åˆç«","å…„å¼Ÿç”³é‡‘","çˆ¶æ¯æˆŒåœŸ"],"world_line":6,"peer_line":3,"hidden_god_rule":"æ— ä¼ï¼ˆæœ¬å®«çº¯å¦ï¼‰","binary":"111111"},
            {"palace":"ä¹¾å®«","index":2,"symbol":"ä·«","name":"å¤©é£å§¤","element":"é‡‘","six_relations":["çˆ¶æ¯ä¸‘åœŸ","å­å­™äº¥æ°´","å…„å¼Ÿé…‰é‡‘","å®˜é¬¼åˆç«","çˆ¶æ¯è¾°åœŸ","å…„å¼Ÿç”³é‡‘"],"world_line":1,"peer_line":4,"hidden_god_rule":"ä¼å­å­™å­æ°´","binary":"111110"},
            {"palace":"ä¹¾å®«","index":3,"symbol":"ä· ","name":"å¤©å±±é","element":"é‡‘","six_relations":["çˆ¶æ¯è¾°åœŸ","çˆ¶æ¯è¾°åœŸ","å…„å¼Ÿç”³é‡‘","å®˜é¬¼åˆç«","å…„å¼Ÿç”³é‡‘","çˆ¶æ¯æˆŒåœŸ"],"world_line":2,"peer_line":5,"hidden_god_rule":"ä¼å­å­™å­æ°´ã€å¦»è´¢å¯…æœ¨","binary":"111001"},
            {"palace":"ä¹¾å®«","index":4,"symbol":"ä·‹","name":"å¤©åœ°å¦","element":"é‡‘","six_relations":["å¦»è´¢å¯æœ¨","å¦»è´¢å¯æœ¨","çˆ¶æ¯è¾°åœŸ","å®˜é¬¼å·³ç«","å…„å¼Ÿç”³é‡‘","çˆ¶æ¯æˆŒåœŸ"],"world_line":3,"peer_line":6,"hidden_god_rule":"ä¼å­å­™å­æ°´","binary":"111000"},
            {"palace":"ä¹¾å®«","index":5,"symbol":"ä·“","name":"é£åœ°è§‚","element":"é‡‘","six_relations":["çˆ¶æ¯æœªåœŸ","å®˜é¬¼å·³ç«","å¦»è´¢å¯æœ¨","å®˜é¬¼å·³ç«","çˆ¶æ¯è¾°åœŸ","å…„å¼Ÿç”³é‡‘"],"world_line":4,"peer_line":1,"hidden_god_rule":"ä¼å­å­™å­æ°´ã€å…„å¼Ÿç”³é‡‘","binary":"000111"},
            {"palace":"ä¹¾å®«","index":6,"symbol":"ä·–","name":"å±±åœ°å‰¥","element":"é‡‘","six_relations":["çˆ¶æ¯æœªåœŸ","å®˜é¬¼å·³ç«","å¦»è´¢å¯æœ¨","å…„å¼Ÿé…‰é‡‘","å­å­™äº¥æ°´","å¦»è´¢å¯…æœ¨"],"world_line":5,"peer_line":2,"hidden_god_rule":"ä¼çˆ¶æ¯è¾°åœŸã€å…„å¼Ÿç”³é‡‘","binary":"100000"},
            {"palace":"ä¹¾å®«","index":7,"symbol":"ä·","name":"ç«åœ°æ™‹","element":"é‡‘","six_relations":["çˆ¶æ¯è¾°åœŸ","å®˜é¬¼å·³ç«","å…„å¼Ÿé…‰é‡‘","å®˜é¬¼å·³ç«","å­å­™æœªåœŸ","å®˜é¬¼åˆç«"],"world_line":4,"peer_line":1,"hidden_god_rule":"ä¼å¦»è´¢å¯…æœ¨ã€å­å­™å­æ°´","binary":"101000"},
            {"palace":"ä¹¾å®«","index":8,"symbol":"ä·","name":"ç«å¤©å¤§æœ‰","element":"é‡‘","six_relations":["å­å­™å­æ°´","å¦»è´¢å¯…æœ¨","çˆ¶æ¯è¾°åœŸ","å®˜é¬¼åˆç«","å…„å¼Ÿç”³é‡‘","çˆ¶æ¯æˆŒåœŸ"],"world_line":5,"peer_line":2,"hidden_god_rule":"æ— ä¼ï¼ˆå½’æœ¬å®«ï¼‰","binary":"101111"},

            {"palace":"å…‘å®«","index":1,"symbol":"ä·¹","name":"å…‘ä¸ºæ³½","element":"é‡‘","six_relations":["çˆ¶æ¯ä¸‘åœŸ","å®˜é¬¼å·³ç«","å¦»è´¢å¯æœ¨","å­å­™äº¥æ°´","å…„å¼Ÿé…‰é‡‘","çˆ¶æ¯æœªåœŸ"],"world_line":6,"peer_line":3,"hidden_god_rule":"æ— ä¼ï¼ˆæœ¬å®«çº¯å¦ï¼‰","binary":"110110"},
            {"palace":"å…‘å®«","index":2,"symbol":"ä·®","name":"æ³½æ°´å›°","element":"é‡‘","six_relations":["å­å­™å­æ°´","å¦»è´¢å¯æœ¨","çˆ¶æ¯æœªåœŸ","å®˜é¬¼åˆç«","å…„å¼Ÿé…‰é‡‘","çˆ¶æ¯æœªåœŸ"],"world_line":1,"peer_line":4,"hidden_god_rule":"ä¼å¦»è´¢å¯…æœ¨","binary":"110010"},
            {"palace":"å…‘å®«","index":3,"symbol":"ä·¬","name":"æ³½åœ°èƒ","element":"é‡‘","six_relations":["çˆ¶æ¯ä¸‘åœŸ","å®˜é¬¼å·³ç«","å¦»è´¢å¯æœ¨","å…„å¼Ÿç”³é‡‘","å…„å¼Ÿé…‰é‡‘","çˆ¶æ¯æœªåœŸ"],"world_line":2,"peer_line":5,"hidden_god_rule":"ä¼å¦»è´¢å¯…æœ¨ã€å­å­™å­æ°´","binary":"110000"},
            {"palace":"å…‘å®«","index":4,"symbol":"ä·º","name":"æ³½å±±å’¸","element":"é‡‘","six_relations":["å­å­™å­æ°´","å¦»è´¢å¯…æœ¨","å…„å¼Ÿç”³é‡‘","å­å­™äº¥æ°´","å…„å¼Ÿé…‰é‡‘","çˆ¶æ¯æœªåœŸ"],"world_line":3,"peer_line":6,"hidden_god_rule":"ä¼çˆ¶æ¯è¾°åœŸ","binary":"110001"},
            {"palace":"å…‘å®«","index":5,"symbol":"ä·¦","name":"æ°´å±±è¹‡","element":"é‡‘","six_relations":["å®˜é¬¼å­æ°´","çˆ¶æ¯ä¸‘åœŸ","å…„å¼Ÿç”³é‡‘","å­å­™äº¥æ°´","å¦»è´¢å¯æœ¨","å®˜é¬¼å·³ç«"],"world_line":4,"peer_line":1,"hidden_god_rule":"ä¼çˆ¶æ¯æˆŒåœŸã€å¦»è´¢å¯…æœ¨","binary":"010001"},
            {"palace":"å…‘å®«","index":6,"symbol":"ä·§","name":"åœ°å±±è°¦","element":"é‡‘","six_relations":["çˆ¶æ¯ä¸‘åœŸ","å¦»è´¢å¯æœ¨","å…„å¼Ÿé…‰é‡‘","å…„å¼Ÿç”³é‡‘","å¦»è´¢å¯æœ¨","å®˜é¬¼å·³ç«"],"world_line":5,"peer_line":2,"hidden_god_rule":"ä¼çˆ¶æ¯æœªåœŸã€å­å­™å­æ°´","binary":"000001"},
            {"palace":"å…‘å®«","index":7,"symbol":"ä·Ÿ","name":"é›·å±±å°è¿‡","element":"é‡‘","six_relations":["å¦»è´¢å¯…æœ¨","å­å­™äº¥æ°´","çˆ¶æ¯æˆŒåœŸ","å…„å¼Ÿç”³é‡‘","å­å­™æœªåœŸ","å®˜é¬¼å·³ç«"],"world_line":4,"peer_line":1,"hidden_god_rule":"ä¼çˆ¶æ¯è¾°åœŸã€å¦»è´¢å¯æœ¨","binary":"001100"},
            {"palace":"å…‘å®«","index":8,"symbol":"ä·µ","name":"é›·æ³½å½’å¦¹","element":"é‡‘","six_relations":["å¦»è´¢å¯…æœ¨","å­å­™äº¥æ°´","çˆ¶æ¯æˆŒåœŸ","çˆ¶æ¯ä¸‘åœŸ","å…„å¼Ÿé…‰é‡‘","çˆ¶æ¯æœªåœŸ"],"world_line":3,"peer_line":6,"hidden_god_rule":"å½’é­‚ï¼Œä¼å¦»è´¢å¯æœ¨","binary":"100110"}
        ];

        // ç¥ç…è¡¨æ•°æ®
        const SHENSHA_DATA = [
            {"name":"å¤©ä¹™è´µäºº","type":"è´µäºº","description":"æœ€å°Šè´µä¹‹å‰ç¥ï¼Œä¸»é€¢å‡¶åŒ–å‰ã€é‡éš¾æˆç¥¥ã€å¾—äººæ‰¶æŒã€‚","method":"ä»¥æ—¥å¹²æŸ¥åœ°æ”¯","rules":[{"day_gan":"ç”²","branches":["ä¸‘","æœª"]},{"day_gan":"ä¹™","branches":["å­","ç”³"]},{"day_gan":"ä¸™","branches":["äº¥","é…‰"]},{"day_gan":"ä¸","branches":["é…‰","æœª"]},{"day_gan":"æˆŠ","branches":["ä¸‘","æœª"]},{"day_gan":"å·±","branches":["å­","ç”³"]},{"day_gan":"åºš","branches":["äº¥","é…‰"]},{"day_gan":"è¾›","branches":["åˆ","å¯…"]},{"day_gan":"å£¬","branches":["å¯","å·³"]},{"day_gan":"ç™¸","branches":["å¯","å·³"]}],"note":"ç”²æˆŠåºšç‰›ç¾Šï¼Œä¹™å·±é¼ çŒ´ä¹¡ï¼Œä¸™ä¸çŒªé¸¡ä½ï¼Œå£¬ç™¸å…”è›‡è—ï¼Œè¾›é€¢è™é©¬è´µï¼Œç‰å¥³å¥½æˆåŒã€‚"},
            {"name":"é©¿é©¬","type":"åŠ¨ç¥","description":"ä¸»åŠ¨è¡ã€å¥”æ³¢ã€æ—…è¡Œã€è¿ç§»ã€èŒä¸šå˜åŠ¨ã€å‡ºå›½ã€äº¤é€šã€‚","method":"ä»¥å¹´æ”¯æˆ–æ—¥æ”¯æŸ¥åœ°æ”¯","rules":[{"trunk":"å¯…åˆæˆŒ","branches":["ç”³"]},{"trunk":"äº¥å¯æœª","branches":["å·³"]},{"trunk":"ç”³å­è¾°","branches":["å¯…"]},{"trunk":"å·³é…‰ä¸‘","branches":["äº¥"]}],"note":"å¯…åˆæˆŒè§ç”³ï¼Œäº¥å¯æœªè§å·³ï¼Œç”³å­è¾°è§å¯…ï¼Œå·³é…‰ä¸‘è§äº¥ã€‚"},
            {"name":"æ–‡æ˜Œè´µäºº","type":"è´µäºº","description":"ä¸»èªæ˜æ‰æ™ºã€æ–‡é‡‡å‡ºä¼—ã€åˆ©äºè€ƒè¯•ã€å­¦æœ¯ã€æ–‡è‰ºã€‚","method":"ä»¥æ—¥å¹²æŸ¥åœ°æ”¯","rules":[{"day_gan":"ç”²","branches":["äº¥"]},{"day_gan":"ä¹™","branches":["åˆ"]},{"day_gan":"ä¸™","branches":["ç”³"]},{"day_gan":"ä¸","branches":["é…‰"]},{"day_gan":"æˆŠ","branches":["ç”³"]},{"day_gan":"å·±","branches":["é…‰"]},{"day_gan":"åºš","branches":["å·³"]},{"day_gan":"è¾›","branches":["å·³"]},{"day_gan":"å£¬","branches":["å¯…"]},{"day_gan":"ç™¸","branches":["å¯"]}]},
            {"name":"åç›–","type":"è´µäºº/å­¤","description":"ä¸»èªæ˜ã€è‰ºæœ¯å¤©èµ‹ã€ç„å­¦å…´è¶£ï¼Œä½†äº¦ä¸»å­¤ç‹¬ã€æ¸…é«˜ã€å…­äº²ç¼˜è–„ã€‚","method":"ä»¥å¹´æ”¯æˆ–æ—¥æ”¯æŸ¥åœ°æ”¯","rules":[{"trunk":"å¯…åˆæˆŒ","branches":["æˆŒ"]},{"trunk":"äº¥å¯æœª","branches":["æœª"]},{"trunk":"ç”³å­è¾°","branches":["è¾°"]},{"trunk":"å·³é…‰ä¸‘","branches":["ä¸‘"]}],"note":"å¯…åˆæˆŒè§æˆŒï¼Œäº¥å¯æœªè§æœªï¼Œç”³å­è¾°è§è¾°ï¼Œå·³é…‰ä¸‘è§ä¸‘ã€‚"}
        ];

        // å…­åå››å¦åŸºç¡€æ•°æ®ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
        const HEXAGRAMS = {
            '100010': { name: 'æ°´é›·å±¯', number: 3, elements: ['å', 'éœ‡'], shiYing: [6, 3], najia: ['æˆŠ', 'åºš', 'å£¬', 'åºš', 'æˆŠ', 'å·±'], palace: 'éœ‡' },
            '010001': { name: 'å±±æ°´è’™', number: 4, elements: ['è‰®', 'å'], shiYing: [3, 6], najia: ['ä¸™', 'æˆŠ', 'åºš', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'å' },
            '111010': { name: 'æ°´å¤©éœ€', number: 5, elements: ['å', 'ä¹¾'], shiYing: [5, 2], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'ä¹¾' },
            '010111': { name: 'å¤©æ°´è®¼', number: 6, elements: ['ä¹¾', 'å'], shiYing: [2, 5], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'å£¬', 'æˆŠ', 'åºš'], palace: 'ä¹¾' },
            '010000': { name: 'åœ°æ°´å¸ˆ', number: 7, elements: ['å¤', 'å'], shiYing: [4, 1], najia: ['æˆŠ', 'åºš', 'å£¬', 'ç™¸', 'ä¹™', 'ä¹™'], palace: 'å' },
            '000010': { name: 'æ°´åœ°æ¯”', number: 8, elements: ['å', 'å¤'], shiYing: [1, 4], najia: ['ä¹™', 'ç™¸', 'è¾›', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'å¤' },
            '111011': { name: 'é£å¤©å°ç•œ', number: 9, elements: ['å·½', 'ä¹¾'], shiYing: [6, 3], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'ä¹¾' },
            '110111': { name: 'å¤©æ³½å±¥', number: 10, elements: ['ä¹¾', 'å…‘'], shiYing: [3, 6], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'ä¸', 'å·±', 'è¾›'], palace: 'ä¹¾' },
            '111000': { name: 'åœ°å¤©æ³°', number: 11, elements: ['å¤', 'ä¹¾'], shiYing: [5, 2], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'ä¹™', 'ç™¸', 'è¾›'], palace: 'ä¹¾' },
            '000111': { name: 'å¤©åœ°å¦', number: 12, elements: ['ä¹¾', 'å¤'], shiYing: [2, 5], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'ä¹¾' },
            '101111': { name: 'å¤©ç«åŒäºº', number: 13, elements: ['ä¹¾', 'ç¦»'], shiYing: [4, 1], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'å·±', 'è¾›', 'ç™¸'], palace: 'ä¹¾' },
            '111101': { name: 'ç«å¤©å¤§æœ‰', number: 14, elements: ['ç¦»', 'ä¹¾'], shiYing: [1, 4], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'å·±', 'è¾›', 'ç™¸'], palace: 'ä¹¾' },
            '001000': { name: 'åœ°å±±è°¦', number: 15, elements: ['å¤', 'è‰®'], shiYing: [6, 3], najia: ['ä¸™', 'æˆŠ', 'åºš', 'ç™¸', 'ä¹™', 'ä¹™'], palace: 'è‰®' },
            '000100': { name: 'é›·åœ°è±«', number: 16, elements: ['éœ‡', 'å¤'], shiYing: [3, 6], najia: ['ä¹™', 'ç™¸', 'è¾›', 'åºš', 'æˆŠ', 'å·±'], palace: 'å¤' },
            '100110': { name: 'æ³½é›·éš', number: 17, elements: ['å…‘', 'éœ‡'], shiYing: [5, 2], najia: ['åºš', 'æˆŠ', 'å·±', 'å·±', 'è¾›', 'ç™¸'], palace: 'éœ‡' },
            '011001': { name: 'å±±é£è›Š', number: 18, elements: ['è‰®', 'å·½'], shiYing: [2, 5], najia: ['è¾›', 'ç™¸', 'ä¹™', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'å·½' },
            '110000': { name: 'åœ°æ³½ä¸´', number: 19, elements: ['å¤', 'å…‘'], shiYing: [4, 1], najia: ['ä¸', 'å·±', 'è¾›', 'ç™¸', 'ä¹™', 'ä¹™'], palace: 'å…‘' },
            '000011': { name: 'é£åœ°è§‚', number: 20, elements: ['å·½', 'å¤'], shiYing: [1, 4], najia: ['ä¹™', 'ç™¸', 'è¾›', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'å¤' },
            '100101': { name: 'ç«é›·å™¬å—‘', number: 21, elements: ['ç¦»', 'éœ‡'], shiYing: [6, 3], najia: ['åºš', 'æˆŠ', 'å·±', 'å·±', 'è¾›', 'ç™¸'], palace: 'éœ‡' },
            '101001': { name: 'å±±ç«è´²', number: 22, elements: ['è‰®', 'ç¦»'], shiYing: [3, 6], najia: ['å·±', 'è¾›', 'ç™¸', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'ç¦»' },
            '000001': { name: 'å±±åœ°å‰¥', number: 23, elements: ['è‰®', 'å¤'], shiYing: [5, 2], najia: ['ä¹™', 'ç™¸', 'è¾›', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'å¤' },
            '100000': { name: 'åœ°é›·å¤', number: 24, elements: ['å¤', 'éœ‡'], shiYing: [2, 5], najia: ['åºš', 'æˆŠ', 'å·±', 'ç™¸', 'ä¹™', 'ä¹™'], palace: 'éœ‡' },
            '100111': { name: 'å¤©é›·æ— å¦„', number: 25, elements: ['ä¹¾', 'éœ‡'], shiYing: [4, 1], najia: ['åºš', 'æˆŠ', 'å·±', 'å£¬', 'æˆŠ', 'åºš'], palace: 'éœ‡' },
            '111001': { name: 'å±±å¤©å¤§ç•œ', number: 26, elements: ['è‰®', 'ä¹¾'], shiYing: [1, 4], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'ä¹¾' },
            '100001': { name: 'å±±é›·é¢', number: 27, elements: ['è‰®', 'éœ‡'], shiYing: [6, 3], najia: ['åºš', 'æˆŠ', 'å·±', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'éœ‡' },
            '011110': { name: 'æ³½é£å¤§è¿‡', number: 28, elements: ['å…‘', 'å·½'], shiYing: [3, 6], najia: ['è¾›', 'ç™¸', 'ä¹™', 'å·±', 'è¾›', 'ç™¸'], palace: 'å·½' },
            '010010': { name: 'åä¸ºæ°´', number: 29, elements: ['å', 'å'], shiYing: [5, 2], najia: ['æˆŠ', 'åºš', 'å£¬', 'æˆŠ', 'åºš', 'å£¬'], palace: 'å' },
            '101101': { name: 'ç¦»ä¸ºç«', number: 30, elements: ['ç¦»', 'ç¦»'], shiYing: [2, 5], najia: ['å·±', 'è¾›', 'ç™¸', 'å·±', 'è¾›', 'ç™¸'], palace: 'ç¦»' },
            '001110': { name: 'æ³½å±±å’¸', number: 31, elements: ['å…‘', 'è‰®'], shiYing: [4, 1], najia: ['ä¸™', 'æˆŠ', 'åºš', 'å·±', 'è¾›', 'ç™¸'], palace: 'è‰®' },
            '011100': { name: 'é›·é£æ’', number: 32, elements: ['éœ‡', 'å·½'], shiYing: [1, 4], najia: ['è¾›', 'ç™¸', 'ä¹™', 'åºš', 'æˆŠ', 'å·±'], palace: 'å·½' },
            '001111': { name: 'å¤©å±±é', number: 33, elements: ['ä¹¾', 'è‰®'], shiYing: [6, 3], najia: ['ä¸™', 'æˆŠ', 'åºš', 'å£¬', 'æˆŠ', 'åºš'], palace: 'è‰®' },
            '111100': { name: 'é›·å¤©å¤§å£®', number: 34, elements: ['éœ‡', 'ä¹¾'], shiYing: [3, 6], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'åºš', 'æˆŠ', 'å·±'], palace: 'ä¹¾' },
            '000101': { name: 'ç«åœ°æ™‹', number: 35, elements: ['ç¦»', 'å¤'], shiYing: [5, 2], najia: ['ä¹™', 'ç™¸', 'è¾›', 'å·±', 'è¾›', 'ç™¸'], palace: 'å¤' },
            '101000': { name: 'åœ°ç«æ˜å¤·', number: 36, elements: ['å¤', 'ç¦»'], shiYing: [2, 5], najia: ['å·±', 'è¾›', 'ç™¸', 'ç™¸', 'ä¹™', 'ä¹™'], palace: 'ç¦»' },
            '101011': { name: 'é£ç«å®¶äºº', number: 37, elements: ['å·½', 'ç¦»'], shiYing: [4, 1], najia: ['å·±', 'è¾›', 'ç™¸', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'ç¦»' },
            '110101': { name: 'ç«æ³½ç½', number: 38, elements: ['ç¦»', 'å…‘'], shiYing: [1, 4], najia: ['ä¸', 'å·±', 'è¾›', 'å·±', 'è¾›', 'ç™¸'], palace: 'å…‘' },
            '001010': { name: 'æ°´å±±è¹‡', number: 39, elements: ['å', 'è‰®'], shiYing: [6, 3], najia: ['ä¸™', 'æˆŠ', 'åºš', 'æˆŠ', 'åºš', 'å£¬'], palace: 'è‰®' },
            '010100': { name: 'é›·æ°´è§£', number: 40, elements: ['éœ‡', 'å'], shiYing: [3, 6], najia: ['æˆŠ', 'åºš', 'å£¬', 'åºš', 'æˆŠ', 'å·±'], palace: 'å' },
            '110001': { name: 'å±±æ³½æŸ', number: 41, elements: ['è‰®', 'å…‘'], shiYing: [5, 2], najia: ['ä¸', 'å·±', 'è¾›', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'å…‘' },
            '100011': { name: 'é£é›·ç›Š', number: 42, elements: ['å·½', 'éœ‡'], shiYing: [2, 5], najia: ['åºš', 'æˆŠ', 'å·±', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'éœ‡' },
            '111110': { name: 'æ³½å¤©å¤¬', number: 43, elements: ['å…‘', 'ä¹¾'], shiYing: [4, 1], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'å·±', 'è¾›', 'ç™¸'], palace: 'ä¹¾' },
            '011111': { name: 'å¤©é£å§¤', number: 44, elements: ['ä¹¾', 'å·½'], shiYing: [1, 4], najia: ['æˆŠ', 'æˆŠ', 'åºš', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'ä¹¾' },
            '000110': { name: 'æ³½åœ°èƒ', number: 45, elements: ['å…‘', 'å¤'], shiYing: [6, 3], najia: ['ä¹™', 'ç™¸', 'è¾›', 'å·±', 'è¾›', 'ç™¸'], palace: 'å¤' },
            '011000': { name: 'åœ°é£å‡', number: 46, elements: ['å¤', 'å·½'], shiYing: [3, 6], najia: ['è¾›', 'ç™¸', 'ä¹™', 'ç™¸', 'ä¹™', 'ä¹™'], palace: 'å·½' },
            '010110': { name: 'æ³½æ°´å›°', number: 47, elements: ['å…‘', 'å'], shiYing: [5, 2], najia: ['æˆŠ', 'åºš', 'å£¬', 'å·±', 'è¾›', 'ç™¸'], palace: 'å' },
            '011010': { name: 'æ°´é£äº•', number: 48, elements: ['å', 'å·½'], shiYing: [2, 5], najia: ['è¾›', 'ç™¸', 'ä¹™', 'æˆŠ', 'åºš', 'å£¬'], palace: 'å·½' },
            '101110': { name: 'æ³½ç«é©', number: 49, elements: ['å…‘', 'ç¦»'], shiYing: [4, 1], najia: ['å·±', 'è¾›', 'ç™¸', 'å·±', 'è¾›', 'ç™¸'], palace: 'ç¦»' },
            '011101': { name: 'ç«é£é¼', number: 50, elements: ['ç¦»', 'å·½'], shiYing: [1, 4], najia: ['è¾›', 'ç™¸', 'ä¹™', 'å·±', 'è¾›', 'ç™¸'], palace: 'å·½' },
            '100100': { name: 'éœ‡ä¸ºé›·', number: 51, elements: ['éœ‡', 'éœ‡'], shiYing: [6, 3], najia: ['åºš', 'æˆŠ', 'å·±', 'åºš', 'æˆŠ', 'å·±'], palace: 'éœ‡' },
            '001001': { name: 'è‰®ä¸ºå±±', number: 52, elements: ['è‰®', 'è‰®'], shiYing: [3, 6], najia: ['ä¸™', 'æˆŠ', 'åºš', 'ä¸™', 'æˆŠ', 'åºš'], palace: 'è‰®' },
            '001011': { name: 'é£å±±æ¸', number: 53, elements: ['å·½', 'è‰®'], shiYing: [5, 2], najia: ['ä¸™', 'æˆŠ', 'åºš', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'è‰®' },
            '110100': { name: 'é›·æ³½å½’å¦¹', number: 54, elements: ['éœ‡', 'å…‘'], shiYing: [2, 5], najia: ['ä¸', 'å·±', 'è¾›', 'åºš', 'æˆŠ', 'å·±'], palace: 'å…‘' },
            '101100': { name: 'é›·ç«ä¸°', number: 55, elements: ['éœ‡', 'ç¦»'], shiYing: [4, 1], najia: ['å·±', 'è¾›', 'ç™¸', 'åºš', 'æˆŠ', 'å·±'], palace: 'ç¦»' },
            '001101': { name: 'ç«å±±æ—…', number: 56, elements: ['ç¦»', 'è‰®'], shiYing: [1, 4], najia: ['ä¸™', 'æˆŠ', 'åºš', 'å·±', 'è¾›', 'ç™¸'], palace: 'è‰®' },
            '011011': { name: 'å·½ä¸ºé£', number: 57, elements: ['å·½', 'å·½'], shiYing: [6, 3], najia: ['è¾›', 'ç™¸', 'ä¹™', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'å·½' },
            '110110': { name: 'å…‘ä¸ºæ³½', number: 58, elements: ['å…‘', 'å…‘'], shiYing: [3, 6], najia: ['ä¸', 'å·±', 'è¾›', 'ä¸', 'å·±', 'è¾›'], palace: 'å…‘' },
            '010011': { name: 'é£æ°´æ¶£', number: 59, elements: ['å·½', 'å'], shiYing: [5, 2], najia: ['æˆŠ', 'åºš', 'å£¬', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'å' },
            '110010': { name: 'æ°´æ³½èŠ‚', number: 60, elements: ['å', 'å…‘'], shiYing: [2, 5], najia: ['ä¸', 'å·±', 'è¾›', 'æˆŠ', 'åºš', 'å£¬'], palace: 'å…‘' },
            '110011': { name: 'é£æ³½ä¸­å­š', number: 61, elements: ['å·½', 'å…‘'], shiYing: [4, 1], najia: ['ä¸', 'å·±', 'è¾›', 'è¾›', 'ç™¸', 'ä¹™'], palace: 'å…‘' },
            '001100': { name: 'é›·å±±å°è¿‡', number: 62, elements: ['éœ‡', 'è‰®'], shiYing: [1, 4], najia: ['ä¸™', 'æˆŠ', 'åºš', 'åºš', 'æˆŠ', 'å·±'], palace: 'è‰®' },
            '101010': { name: 'æ°´ç«æ—¢æµ', number: 63, elements: ['å', 'ç¦»'], shiYing: [6, 3], najia: ['å·±', 'è¾›', 'ç™¸', 'æˆŠ', 'åºš', 'å£¬'], palace: 'ç¦»' },
            '010101': { name: 'ç«æ°´æœªæµ', number: 64, elements: ['ç¦»', 'å'], shiYing: [3, 6], najia: ['æˆŠ', 'åºš', 'å£¬', 'å·±', 'è¾›', 'ç™¸'], palace: 'å' }
        };

        // å¤©å¹²åœ°æ”¯å’Œäº”è¡Œ
        const TIANGAN = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
        const DIZHI = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        const WUXING = {
            'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ',
            'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´',
            'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 'å·³': 'ç«',
            'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', 'äº¥': 'æ°´'
        };

        // å¹²æ”¯å†è½¬æ¢åŸºå‡†ï¼š1900å¹´åºšå­å¹´æ­£æœˆåˆä¸€ä¸ºåŸºå‡†
        const GANZHI_BASE_YEAR = 1900; // åºšå­å¹´
        const GANZHI_BASE_YEAR_TIANGAN = 6; // åºšä¸ºç¬¬7ä¸ªå¤©å¹²ï¼Œç´¢å¼•ä¸º6
        const GANZHI_BASE_YEAR_DIZHI = 0; // å­ä¸ºç¬¬1ä¸ªåœ°æ”¯ï¼Œç´¢å¼•ä¸º0

        // 1900å¹´1æœˆ31æ—¥ä¸ºåºšå­å¹´æ­£æœˆåˆä¸€çš„å„’ç•¥æ—¥æ•°
        const JULIAN_BASE_1900 = 2415021;

        // èŠ‚æ°”è¡¨ï¼ˆä»¥å¤ªé˜³é»„ç»åº¦æ•°è¡¨ç¤ºï¼‰
        const SOLAR_TERMS = [
            { name: 'å°å¯’', longitude: 285 },
            { name: 'å¤§å¯’', longitude: 300 },
            { name: 'ç«‹æ˜¥', longitude: 315 },
            { name: 'é›¨æ°´', longitude: 330 },
            { name: 'æƒŠè›°', longitude: 345 },
            { name: 'æ˜¥åˆ†', longitude: 0 },
            { name: 'æ¸…æ˜', longitude: 15 },
            { name: 'è°·é›¨', longitude: 30 },
            { name: 'ç«‹å¤', longitude: 45 },
            { name: 'å°æ»¡', longitude: 60 },
            { name: 'èŠ’ç§', longitude: 75 },
            { name: 'å¤è‡³', longitude: 90 },
            { name: 'å°æš‘', longitude: 105 },
            { name: 'å¤§ç½²', longitude: 120 },
            { name: 'ç«‹ç§‹', longitude: 135 },
            { name: 'å¤„æš‘', longitude: 150 },
            { name: 'ç™½éœ²', longitude: 165 },
            { name: 'ç§‹åˆ†', longitude: 180 },
            { name: 'å¯’éœ²', longitude: 195 },
            { name: 'éœœé™', longitude: 210 },
            { name: 'ç«‹å†¬', longitude: 225 },
            { name: 'å°é›ª', longitude: 240 },
            { name: 'å¤§é›ª', longitude: 255 },
            { name: 'å†¬è‡³', longitude: 270 }
        ];

        // å…­ç¥
        const LIUSHEN = ['é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦'];

        // å®Œæ•´çš„çº³ç”²é…ç½®è¡¨ï¼ˆäº¬æˆ¿æ˜“ä¼ ç»Ÿé…ç½®ï¼‰
        const NAJIA_CONFIG = {
            // ä¹¾å®«å…«å¦çº³ç”²é…ç½®
            '111111': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'å£¬åˆ', 'å£¬ç”³', 'å£¬æˆŒ'], // ä¹¾ä¸ºå¤©
            '111110': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘'], // å¤©é£å§¤
            '111101': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'ä¸™ç”³', 'ä¸™åˆ', 'ä¸™è¾°'], // å¤©å±±é
            '111011': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'ä¹™æœª', 'ä¹™é…‰', 'ä¹™äº¥'], // å¤©åœ°å¦
            '111010': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'æˆŠç”³', 'æˆŠåˆ', 'æˆŠè¾°'], // é£å¤©å°ç•œ
            '111001': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'ä¸™ç”³', 'ä¸™åˆ', 'ä¸™è¾°'], // å±±å¤©å¤§ç•œ
            '111000': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'ä¹™æœª', 'ä¹™é…‰', 'ä¹™äº¥'], // åœ°å¤©æ³°
            '110111': ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // ç«å¤©å¤§æœ‰

            // å¤å®«å…«å¦çº³ç”²é…ç½®
            '000000': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // å¤ä¸ºåœ°
            '000001': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'åºšç”³', 'åºšåˆ', 'åºšè¾°'], // åœ°é›·å¤
            '000010': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'æˆŠç”³', 'æˆŠåˆ', 'æˆŠè¾°'], // åœ°æ³½ä¸´
            '000100': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'åºšç”³', 'åºšåˆ', 'åºšè¾°'], // åœ°ç«æ˜å¤·
            '000101': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'å·±å·³', 'å·±å¯', 'å·±ä¸‘'], // åœ°æ°´å¸ˆ
            '000110': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘'], // åœ°å±±è°¦
            '000111': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'å£¬åˆ', 'å£¬ç”³', 'å£¬æˆŒ'], // åœ°å¤©å¦
            '001000': ['ä¹™æœª', 'ä¹™å·³', 'ä¹™å¯', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // å±±åœ°å‰¥

            // éœ‡å®«å…«å¦çº³ç”²é…ç½®
            '100100': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'åºšåˆ', 'åºšç”³', 'åºšæˆŒ'], // éœ‡ä¸ºé›·
            '100101': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'å·±å·³', 'å·±å¯', 'å·±ä¸‘'], // é›·åœ°è±«
            '100110': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // é›·æ°´è§£
            '100111': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'å£¬åˆ', 'å£¬ç”³', 'å£¬æˆŒ'], // é›·é£æ’
            '100011': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘'], // é›·å¤©å¤§å£®
            '100010': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'æˆŠç”³', 'æˆŠåˆ', 'æˆŠè¾°'], // é›·æ³½éš
            '100001': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'ä¸™ç”³', 'ä¸™åˆ', 'ä¸™è¾°'], // é›·å±±å°è¿‡
            '100000': ['åºšå­', 'åºšå¯…', 'åºšè¾°', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // é›·åœ°è±«

            // å·½å®«å…«å¦çº³ç”²é…ç½®
            '011011': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'è¾›æœª', 'è¾›å·³', 'è¾›å¯'], // å·½ä¸ºé£
            '011010': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'æˆŠç”³', 'æˆŠåˆ', 'æˆŠè¾°'], // é£æ°´æ¶£
            '011001': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'ä¸™ç”³', 'ä¸™åˆ', 'ä¸™è¾°'], // é£å±±æ¸
            '011000': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // é£åœ°å‡
            '011100': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'åºšå­', 'åºšå¯…', 'åºšè¾°'], // é£é›·ç›Š
            '011101': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'å·±å·³', 'å·±å¯', 'å·±ä¸‘'], // é£ç«å®¶äºº
            '011110': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // é£æ³½ä¸­å­š
            '011111': ['è¾›ä¸‘', 'è¾›äº¥', 'è¾›é…‰', 'æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°'], // é£å¤©å°ç•œ

            // åå®«å…«å¦çº³ç”²é…ç½®
            '010010': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'æˆŠç”³', 'æˆŠæˆŒ', 'æˆŠå­'], // åä¸ºæ°´
            '010011': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘'], // æ°´é£äº•
            '010001': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'åºšç”³', 'åºšåˆ', 'åºšè¾°'], // æ°´å±±è¹‡
            '010000': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // æ°´åœ°æ¯”
            '010100': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'åºšå­', 'åºšå¯…', 'åºšè¾°'], // æ°´é›·å±¯
            '010101': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'å·±å·³', 'å·±å¯', 'å·±ä¸‘'], // æ°´ç«æ—¢æµ
            '010110': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // æ°´æ³½èŠ‚
            '010111': ['æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ', 'æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°'], // æ°´å¤©éœ€

            // ç¦»å®«å…«å¦çº³ç”²é…ç½®
            '101101': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'å·±é…‰', 'å·±æœª', 'å·±å·³'], // ç¦»ä¸ºç«
            '101100': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'åºšå­', 'åºšå¯…', 'åºšè¾°'], // ç«é›·å™¬å—‘
            '101110': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // ç«æ³½ç½
            '101111': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°'], // ç«å¤©å¤§æœ‰
            '101011': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘'], // ç«é£é¼
            '101010': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ'], // ç«æ°´æœªæµ
            '101001': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'ä¸™ç”³', 'ä¸™åˆ', 'ä¸™è¾°'], // ç«å±±è´²
            '101000': ['å·±å¯', 'å·±ä¸‘', 'å·±äº¥', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // ç«åœ°æ™‹

            // è‰®å®«å…«å¦çº³ç”²é…ç½®
            '001001': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'ä¸™æˆŒ', 'ä¸™å­', 'ä¸™å¯…'], // è‰®ä¸ºå±±
            '001000': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // å±±åœ°å‰¥
            '001010': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ'], // å±±æ°´è’™
            '001011': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘'], // å±±é£è›Š
            '001101': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'å·±é…‰', 'å·±æœª', 'å·±å·³'], // å±±ç«æ—…
            '001110': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘'], // å±±æ³½æŸ
            '001111': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°'], // å±±å¤©å¤§ç•œ
            '001100': ['ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³', 'åºšå­', 'åºšå¯…', 'åºšè¾°'], // å±±é›·é¢

            // å…‘å®«å…«å¦çº³ç”²é…ç½®
            '110110': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'ä¸äº¥', 'ä¸é…‰', 'ä¸æœª'], // å…‘ä¸ºæ³½
            '110111': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°'], // æ³½å¤©å¤¬
            '110101': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'å·±é…‰', 'å·±æœª', 'å·±å·³'], // æ³½ç«é©
            '110100': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'åºšå­', 'åºšå¯…', 'åºšè¾°'], // æ³½é›·å½’å¦¹
            '110010': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'æˆŠå¯…', 'æˆŠè¾°', 'æˆŠåˆ'], // æ³½æ°´å›°
            '110001': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'ä¸™è¾°', 'ä¸™åˆ', 'ä¸™ç”³'], // æ³½å±±å’¸
            '110000': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'ç™¸ä¸‘', 'ç™¸äº¥', 'ç™¸é…‰'], // æ³½åœ°ä¸´
            '110011': ['ä¸å·³', 'ä¸å¯', 'ä¸ä¸‘', 'è¾›å·³', 'è¾›å¯', 'è¾›ä¸‘']  // æ³½é£å¤§è¿‡
        };

        // å…«å¦äº”è¡Œå¯¹ç…§ï¼ˆå¦å®«äº”è¡Œï¼‰
        const BAGUA_WUXING = {
            'ä¹¾': 'é‡‘', 'å…‘': 'é‡‘',     // ä¹¾å…‘å±é‡‘
            'ç¦»': 'ç«',                 // ç¦»å±ç«
            'éœ‡': 'æœ¨', 'å·½': 'æœ¨',     // éœ‡å·½å±æœ¨
            'å': 'æ°´',                 // åå±æ°´
            'è‰®': 'åœŸ', 'å¤': 'åœŸ'      // è‰®å¤å±åœŸ
        };

        // åœ°æ”¯äº”è¡Œå¯¹ç…§
        const DIZHI_WUXING = {
            'å­': 'æ°´', 'äº¥': 'æ°´',     // å­äº¥å±æ°´
            'å¯…': 'æœ¨', 'å¯': 'æœ¨',     // å¯…å¯å±æœ¨
            'å·³': 'ç«', 'åˆ': 'ç«',     // å·³åˆå±ç«
            'ç”³': 'é‡‘', 'é…‰': 'é‡‘',     // ç”³é…‰å±é‡‘
            'ä¸‘': 'åœŸ', 'è¾°': 'åœŸ', 'æœª': 'åœŸ', 'æˆŒ': 'åœŸ'  // å››å­£åœŸ
        };

        // å…­äº²å…³ç³»å¯¹ç…§è¡¨ï¼ˆåŸºäºäº”è¡Œç”Ÿå…‹å…³ç³»ï¼‰
        const LIUQIN_RELATIONS = {
            // æˆ‘ç”Ÿè€…ä¸ºå­å­™ï¼Œç”Ÿæˆ‘è€…ä¸ºçˆ¶æ¯ï¼Œå…‹æˆ‘è€…ä¸ºå®˜é¬¼ï¼Œæˆ‘å…‹è€…ä¸ºå¦»è´¢ï¼Œæ¯”å’Œè€…ä¸ºå…„å¼Ÿ
            'é‡‘': {
                'é‡‘': 'å…„å¼Ÿ',  // é‡‘è§é‡‘ï¼Œæ¯”å’Œä¸ºå…„å¼Ÿ
                'æœ¨': 'å¦»è´¢',  // é‡‘å…‹æœ¨ï¼Œæˆ‘å…‹è€…ä¸ºå¦»è´¢
                'æ°´': 'å­å­™',  // é‡‘ç”Ÿæ°´ï¼Œæˆ‘ç”Ÿè€…ä¸ºå­å­™
                'ç«': 'å®˜é¬¼',  // ç«å…‹é‡‘ï¼Œå…‹æˆ‘è€…ä¸ºå®˜é¬¼
                'åœŸ': 'çˆ¶æ¯'   // åœŸç”Ÿé‡‘ï¼Œç”Ÿæˆ‘è€…ä¸ºçˆ¶æ¯
            },
            'æœ¨': {
                'æœ¨': 'å…„å¼Ÿ',  // æœ¨è§æœ¨ï¼Œæ¯”å’Œä¸ºå…„å¼Ÿ
                'åœŸ': 'å¦»è´¢',  // æœ¨å…‹åœŸï¼Œæˆ‘å…‹è€…ä¸ºå¦»è´¢
                'ç«': 'å­å­™',  // æœ¨ç”Ÿç«ï¼Œæˆ‘ç”Ÿè€…ä¸ºå­å­™
                'é‡‘': 'å®˜é¬¼',  // é‡‘å…‹æœ¨ï¼Œå…‹æˆ‘è€…ä¸ºå®˜é¬¼
                'æ°´': 'çˆ¶æ¯'   // æ°´ç”Ÿæœ¨ï¼Œç”Ÿæˆ‘è€…ä¸ºçˆ¶æ¯
            },
            'æ°´': {
                'æ°´': 'å…„å¼Ÿ',  // æ°´è§æ°´ï¼Œæ¯”å’Œä¸ºå…„å¼Ÿ
                'ç«': 'å¦»è´¢',  // æ°´å…‹ç«ï¼Œæˆ‘å…‹è€…ä¸ºå¦»è´¢
                'æœ¨': 'å­å­™',  // æ°´ç”Ÿæœ¨ï¼Œæˆ‘ç”Ÿè€…ä¸ºå­å­™
                'åœŸ': 'å®˜é¬¼',  // åœŸå…‹æ°´ï¼Œå…‹æˆ‘è€…ä¸ºå®˜é¬¼
                'é‡‘': 'çˆ¶æ¯'   // é‡‘ç”Ÿæ°´ï¼Œç”Ÿæˆ‘è€…ä¸ºçˆ¶æ¯
            },
            'ç«': {
                'ç«': 'å…„å¼Ÿ',  // ç«è§ç«ï¼Œæ¯”å’Œä¸ºå…„å¼Ÿ
                'é‡‘': 'å¦»è´¢',  // ç«å…‹é‡‘ï¼Œæˆ‘å…‹è€…ä¸ºå¦»è´¢
                'åœŸ': 'å­å­™',  // ç«ç”ŸåœŸï¼Œæˆ‘ç”Ÿè€…ä¸ºå­å­™
                'æ°´': 'å®˜é¬¼',  // æ°´å…‹ç«ï¼Œå…‹æˆ‘è€…ä¸ºå®˜é¬¼
                'æœ¨': 'çˆ¶æ¯'   // æœ¨ç”Ÿç«ï¼Œç”Ÿæˆ‘è€…ä¸ºçˆ¶æ¯
            },
            'åœŸ': {
                'åœŸ': 'å…„å¼Ÿ',  // åœŸè§åœŸï¼Œæ¯”å’Œä¸ºå…„å¼Ÿ
                'æ°´': 'å¦»è´¢',  // åœŸå…‹æ°´ï¼Œæˆ‘å…‹è€…ä¸ºå¦»è´¢
                'é‡‘': 'å­å­™',  // åœŸç”Ÿé‡‘ï¼Œæˆ‘ç”Ÿè€…ä¸ºå­å­™
                'æœ¨': 'å®˜é¬¼',  // æœ¨å…‹åœŸï¼Œå…‹æˆ‘è€…ä¸ºå®˜é¬¼
                'ç«': 'çˆ¶æ¯'   // ç«ç”ŸåœŸï¼Œç”Ÿæˆ‘è€…ä¸ºçˆ¶æ¯
            }
        };

        let currentMethod = 'time';
        let currentManualMethod = 'hexname';
        let coinResults = {};
        let lineResults = {};

        // å¹²æ”¯å†è½¬æ¢æ ¸å¿ƒå‡½æ•°
        function gregorianToJulianDay(year, month, day) {
            if (month <= 2) {
                year--;
                month += 12;
            }
            const a = Math.floor(year / 100);
            const b = 2 - a + Math.floor(a / 4);
            return Math.floor(365.25 * (year + 4716)) + Math.floor(30.6001 * (month + 1)) + day + b - 1524.5;
        }

        function getGanzhiFromJulianDay(julianDay) {
            // ä½¿ç”¨é€†æ¨ä¿®æ­£çš„åŸºå‡†ç‚¹ï¼šç¡®ä¿2025å¹´9æœˆ26æ—¥ä¸ºæˆŠæˆŒæ—¥
            // ç»è¿‡æ‰‹å·¥è°ƒè¯•ç¡®å®šçš„æ­£ç¡®åŸºå‡†æ—¥æœŸ
            const targetJD = gregorianToJulianDay(2025, 9, 26); // ç›®æ ‡æ—¥æœŸ
            const targetGanIndex = 4; // æˆŠ
            const targetZhiIndex = 10; // æˆŒ

            // è®¡ç®—å½“å‰ä¼ å…¥æ—¥æœŸä¸ç›®æ ‡æ—¥æœŸçš„å·®å€¼
            const dayOffset = Math.floor(julianDay - targetJD);

            // åŸºäºç›®æ ‡æ—¥æœŸé€†æ¨è®¡ç®—
            let ganIndex = (targetGanIndex - dayOffset % 10 + 10) % 10;
            let zhiIndex = (targetZhiIndex - dayOffset % 12 + 12) % 12;

            return TIANGAN[ganIndex] + DIZHI[zhiIndex];
        }

        function getYearGanzhi(year) {
            // å¹´å¹²æ”¯è®¡ç®—ï¼šä»¥1984å¹´ç”²å­å¹´ä¸ºåŸºå‡†ï¼Œä½†éœ€è¦è€ƒè™‘ç«‹æ˜¥èŠ‚æ°”
            // ç®€åŒ–å¤„ç†ï¼šå‡è®¾ç«‹æ˜¥åœ¨2æœˆ4æ—¥å‰åï¼Œ2025å¹´åº”è¯¥æ˜¯ä¹™å·³å¹´
            const yearOffset = year - 1984;
            const ganIndex = (yearOffset % 10 + 10) % 10;
            const zhiIndex = (yearOffset % 12 + 12) % 12;
            return TIANGAN[ganIndex] + DIZHI[zhiIndex];
        }

        function getMonthGanzhi(year, month) {
            // æœˆå¹²èµ·ä¾‹ï¼šç”²å·±ä¹‹å¹´ä¸™ä½œé¦–ï¼Œä¹™åºšä¹‹å¹´æˆŠä¸ºå¤´ï¼Œä¸™è¾›ä¹‹å¹´åºšå¯…ä¸Šï¼Œä¸å£¬å£¬å¯…é¡ºæ°´æµï¼ŒæˆŠç™¸ä½•æ–¹å‘ï¼Ÿç”²å¯…å¥½è¿½æ±‚
            const yearGan = getYearGanzhi(year).charAt(0);
            const yearGanIndex = TIANGAN.indexOf(yearGan);

            // å¹´å¹²åˆ°æœˆå¹²èµ·å§‹çš„å¯¹ç…§è¡¨ï¼ˆæ­£æœˆå¯…æœˆèµ·å§‹å¤©å¹²ï¼‰
            const monthGanStartMap = {
                0: 2, // ç”²å¹´ä»ä¸™å¯…å¼€å§‹
                1: 4, // ä¹™å¹´ä»æˆŠå¯…å¼€å§‹
                2: 6, // ä¸™å¹´ä»åºšå¯…å¼€å§‹
                3: 8, // ä¸å¹´ä»å£¬å¯…å¼€å§‹
                4: 0, // æˆŠå¹´ä»ç”²å¯…å¼€å§‹
                5: 2, // å·±å¹´ä»ä¸™å¯…å¼€å§‹
                6: 4, // åºšå¹´ä»æˆŠå¯…å¼€å§‹
                7: 6, // è¾›å¹´ä»åºšå¯…å¼€å§‹
                8: 8, // å£¬å¹´ä»å£¬å¯…å¼€å§‹
                9: 0  // ç™¸å¹´ä»ç”²å¯…å¼€å§‹
            };

            const startGanIndex = monthGanStartMap[yearGanIndex];

            // å…¬å†9æœˆå¯¹åº”å†œå†å…«æœˆ(é…‰æœˆ)ï¼ŒæŒ‰ç…§èŠ‚æ°”è®¡ç®—
            // å¯…æœˆ=æ­£æœˆ=1, å¯æœˆ=äºŒæœˆ=2, ..., é…‰æœˆ=å…«æœˆ=8
            // å…¬å†9æœˆåœ¨ç™½éœ²(9æœˆ7-8æ—¥)åˆ°å¯’éœ²(10æœˆ8-9æ—¥)ä¹‹é—´ï¼Œå±äºé…‰æœˆ
            let lunarMonth;
            if (month === 1) lunarMonth = 11; // ä¸‘æœˆ
            else if (month === 2) lunarMonth = 0;  // å¯…æœˆï¼ˆæ­£æœˆï¼‰
            else if (month === 3) lunarMonth = 1;  // å¯æœˆ
            else if (month === 4) lunarMonth = 2;  // è¾°æœˆ
            else if (month === 5) lunarMonth = 3;  // å·³æœˆ
            else if (month === 6) lunarMonth = 4;  // åˆæœˆ
            else if (month === 7) lunarMonth = 5;  // æœªæœˆ
            else if (month === 8) lunarMonth = 6;  // ç”³æœˆ
            else if (month === 9) lunarMonth = 7;  // é…‰æœˆï¼ˆå…«æœˆï¼‰
            else if (month === 10) lunarMonth = 8; // æˆŒæœˆ
            else if (month === 11) lunarMonth = 9; // äº¥æœˆ
            else lunarMonth = 10; // å­æœˆ

            // åœ°æ”¯ç´¢å¼•ï¼šå­=0,ä¸‘=1,å¯…=2,å¯=3,è¾°=4,å·³=5,åˆ=6,æœª=7,ç”³=8,é…‰=9,æˆŒ=10,äº¥=11
            const monthZhiIndex = (lunarMonth + 2) % 12; // å¯…æœˆå¼€å§‹ï¼Œæ‰€ä»¥+2

            // è®¡ç®—æœˆå¹²ï¼šä»å¯…æœˆå¼€å§‹è®¡æ•°ï¼Œä¹™å¹´æˆŠå¯…èµ·
            const monthGanIndex = (startGanIndex + lunarMonth) % 10;

            return TIANGAN[monthGanIndex] + DIZHI[monthZhiIndex];
        }

        function getHourGanzhi(julianDay, hour) {
            // æ—¶å¹²èµ·ä¾‹ï¼šç”²å·±è¿˜ç”Ÿç”²ï¼Œä¹™åºšä¸™ä½œåˆï¼Œä¸™è¾›ä»æˆŠèµ·ï¼Œä¸å£¬åºšå­å±…ï¼ŒæˆŠç™¸ä½•æ–¹å‘ï¼Œå£¬å­æ˜¯çœŸé€”
            const dayGanzhi = getGanzhiFromJulianDay(julianDay);
            const dayGan = dayGanzhi.charAt(0);
            const dayGanIndex = TIANGAN.indexOf(dayGan);

            // åœ°æ”¯æ—¶è¾°å¯¹ç…§ï¼ˆ13æ—¶ä¸ºæœªæ—¶ï¼‰
            let hourZhiIndex;
            if (hour >= 23 || hour < 1) hourZhiIndex = 0; // å­æ—¶ 23-1ç‚¹
            else if (hour < 3) hourZhiIndex = 1; // ä¸‘æ—¶ 1-3ç‚¹
            else if (hour < 5) hourZhiIndex = 2; // å¯…æ—¶ 3-5ç‚¹
            else if (hour < 7) hourZhiIndex = 3; // å¯æ—¶ 5-7ç‚¹
            else if (hour < 9) hourZhiIndex = 4; // è¾°æ—¶ 7-9ç‚¹
            else if (hour < 11) hourZhiIndex = 5; // å·³æ—¶ 9-11ç‚¹
            else if (hour < 13) hourZhiIndex = 6; // åˆæ—¶ 11-13ç‚¹
            else if (hour < 15) hourZhiIndex = 7; // æœªæ—¶ 13-15ç‚¹ï¼ˆ13æ—¶å±äºæœªæ—¶ï¼‰
            else if (hour < 17) hourZhiIndex = 8; // ç”³æ—¶ 15-17ç‚¹
            else if (hour < 19) hourZhiIndex = 9; // é…‰æ—¶ 17-19ç‚¹
            else if (hour < 21) hourZhiIndex = 10; // æˆŒæ—¶ 19-21ç‚¹
            else hourZhiIndex = 11; // äº¥æ—¶ 21-23ç‚¹

            // æ—¥å¹²åˆ°æ—¶å¹²èµ·å§‹çš„å¯¹ç…§è¡¨ï¼ˆæˆŠæ—¥å·±æ—¶çš„ä¿®æ­£ï¼‰
            // æ—¶å¹²èµ·ä¾‹å£è¯€ï¼šç”²å·±è¿˜ç”Ÿç”²ï¼Œä¹™åºšä¸™ä½œåˆï¼Œä¸™è¾›ä»æˆŠèµ·ï¼Œä¸å£¬åºšå­å±…ï¼ŒæˆŠç™¸ä½•æ–¹å‘ï¼Œå£¬å­æ˜¯çœŸé€”
            const hourGanStartMap = {
                0: 0, // ç”²æ—¥ä»ç”²å­æ—¶å¼€å§‹
                1: 2, // ä¹™æ—¥ä»ä¸™å­æ—¶å¼€å§‹
                2: 4, // ä¸™æ—¥ä»æˆŠå­æ—¶å¼€å§‹
                3: 6, // ä¸æ—¥ä»åºšå­æ—¶å¼€å§‹
                4: 8, // æˆŠæ—¥ä»å£¬å­æ—¶å¼€å§‹
                5: 0, // å·±æ—¥ä»ç”²å­æ—¶å¼€å§‹ï¼ˆç”²å·±è¿˜ç”Ÿç”²ï¼‰
                6: 2, // åºšæ—¥ä»ä¸™å­æ—¶å¼€å§‹ï¼ˆä¹™åºšä¸™ä½œåˆï¼‰
                7: 4, // è¾›æ—¥ä»æˆŠå­æ—¶å¼€å§‹ï¼ˆä¸™è¾›ä»æˆŠèµ·ï¼‰
                8: 6, // å£¬æ—¥ä»åºšå­æ—¶å¼€å§‹ï¼ˆä¸å£¬åºšå­å±…ï¼‰
                9: 8  // ç™¸æ—¥ä»å£¬å­æ—¶å¼€å§‹ï¼ˆæˆŠç™¸...å£¬å­æ˜¯çœŸé€”ï¼‰
            };

            const startGanIndex = hourGanStartMap[dayGanIndex];
            // æˆŠæ—¥æœªæ—¶åº”è¯¥æ˜¯ï¼šå£¬(8) + æœª(7) = 15 % 10 = 5 (å·±)
            let hourGanIndex = (startGanIndex + hourZhiIndex) % 10;

            // éªŒè¯ï¼šæˆŠæ—¥13æ—¶ä¸ºæœªæ—¶ï¼Œåº”è¯¥æ˜¯å·±æœª
            // æˆŠæ—¥ä»å£¬å­æ—¶å¼€å§‹çš„å¹²æ”¯é¡ºåºï¼š
            // å­æ—¶-å£¬å­, ä¸‘æ—¶-ç™¸ä¸‘, å¯…æ—¶-ç”²å¯…, å¯æ—¶-ä¹™å¯, è¾°æ—¶-ä¸™è¾°, å·³æ—¶-ä¸å·³, åˆæ—¶-æˆŠåˆ, æœªæ—¶-å·±æœª
            // æ‰€ä»¥13æ—¶(æœªæ—¶)ç¡®å®æ˜¯å·±æœª

            return TIANGAN[hourGanIndex] + DIZHI[hourZhiIndex];
        }

        function getCurrentGanzhi(dateStr, timeStr) {
            const date = new Date(`${dateStr}T${timeStr}`);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hour = date.getHours();

            const julianDay = gregorianToJulianDay(year, month, day);

            return {
                year: getYearGanzhi(year),
                month: getMonthGanzhi(year, month),
                day: getGanzhiFromJulianDay(julianDay),
                hour: getHourGanzhi(julianDay, hour),
                yearNum: year,
                monthNum: month,
                dayNum: day,
                hourNum: hour
            };
        }

        // è‡ªæ ¡éªŒåŠŸèƒ½
        function runSelfValidation() {
            console.log('=== å…­çˆ»æ’ç›˜ç³»ç»Ÿè‡ªæ ¡éªŒ ===');

            // é¦–å…ˆæµ‹è¯•å¹²æ”¯å†è½¬æ¢ï¼ˆ2025å¹´9æœˆ26æ—¥13æ—¶ï¼‰
            const testDate = '2025-09-26';
            const testTime = '13:00';
            const ganzhi = getCurrentGanzhi(testDate, testTime);
            const expected = {
                year: 'ä¹™å·³',
                month: 'ä¹™é…‰',
                day: 'æˆŠæˆŒ',
                hour: 'å·±æœª'
            };

            console.log('æµ‹è¯•2025å¹´9æœˆ26æ—¥13æ—¶çš„å¹²æ”¯:');
            console.log('è®¡ç®—ç»“æœ:', ganzhi);
            console.log('é¢„æœŸç»“æœ:', expected);
            console.log('å¹´æŸ±:', ganzhi.year === expected.year ? 'âœ“' : 'âœ—', `${ganzhi.year} vs ${expected.year}`);
            console.log('æœˆæŸ±:', ganzhi.month === expected.month ? 'âœ“' : 'âœ—', `${ganzhi.month} vs ${expected.month}`);
            console.log('æ—¥æŸ±:', ganzhi.day === expected.day ? 'âœ“' : 'âœ—', `${ganzhi.day} vs ${expected.day}`);
            console.log('æ—¶æŸ±:', ganzhi.hour === expected.hour ? 'âœ“' : 'âœ—', `${ganzhi.hour} vs ${expected.hour}`);

            // è¯¦ç»†è°ƒè¯•ä¿¡æ¯
            const jd = gregorianToJulianDay(2025, 9, 26);
            console.log('\\nè¯¦ç»†è°ƒè¯•ä¿¡æ¯:');
            console.log('å„’ç•¥æ—¥æ•°:', jd);
            console.log('åŸºå‡†å„’ç•¥æ—¥æ•° (1900-01-01):', 2415021);
            console.log('å¤©æ•°åç§»é‡:', jd - 2415021);

            // æ‰‹å·¥éªŒè¯å¹´æŸ±ï¼š2025å¹´åº”è¯¥æ˜¯ä¹™å·³å¹´
            console.log('\\nå¹´æŸ±éªŒè¯:');
            console.log('2025 - 1984 =', 2025 - 1984);
            console.log('41 % 10 =', 41 % 10, 'å¯¹åº”å¤©å¹²:', TIANGAN[1]); // ä¹™
            console.log('41 % 12 =', 41 % 12, 'å¯¹åº”åœ°æ”¯:', DIZHI[5]); // å·³

            // æ‰‹å·¥éªŒè¯æœˆæŸ±ï¼šä¹™å¹´é…‰æœˆåº”è¯¥æ˜¯ä¹™é…‰
            console.log('\\næœˆæŸ±éªŒè¯:');
            console.log('ä¹™å¹´(ç´¢å¼•1)èµ·æˆŠå¯…ï¼Œå…¬å†9æœˆå¯¹åº”å†œå†å…«æœˆ(é…‰æœˆ)');
            console.log('æˆŠå¯…èµ·ï¼Œé…‰æœˆè·å¯…æœˆ7ä¸ªæœˆï¼ŒæˆŠ+7=ä¹™é…‰');
            console.log('é¢„æœŸæœˆæŸ±: ä¹™é…‰');

            // æ‰‹å·¥éªŒè¯æ—¥æŸ±è®¡ç®—
            const dayOffset = Math.floor(jd - 2415021);
            console.log('\\næ—¥æŸ±éªŒè¯:');
            console.log('å¤©æ•°åç§»:', dayOffset);
            console.log('å¤©å¹²åç§»:', dayOffset % 10, 'åœ°æ”¯åç§»:', dayOffset % 12);
            const expectedGanIndex = (6 + dayOffset % 10) % 10; // åºš + åç§»
            const expectedZhiIndex = (0 + dayOffset % 12) % 12; // å­ + åç§»
            console.log('é¢„æœŸæ—¥å¹²ç´¢å¼•:', expectedGanIndex, 'é¢„æœŸæ—¥æ”¯ç´¢å¼•:', expectedZhiIndex);
            console.log('é¢„æœŸæ—¥æŸ±:', TIANGAN[expectedGanIndex] + DIZHI[expectedZhiIndex]);

            // éªŒè¯æ—¶æŸ±è®¡ç®—
            console.log('\\næ—¶æŸ±éªŒè¯:');
            console.log('13æ—¶å¯¹åº”æ—¶è¾°: æœªæ—¶');
            console.log('æˆŠæ—¥èµ·å£¬å­æ—¶ï¼Œæœªæ—¶(ç´¢å¼•7)åº”è¯¥æ˜¯: å£¬+7=å·±æœª');
            console.log('é¢„æœŸæ—¶æŸ±: å·±æœª');

            // æµ‹è¯•æ¡ˆä¾‹1ï¼šæ•°å­—èµ·å¦13,34
            const testCase1 = traditionalNumberDivination(13, 34);
            const expected1 = {
                upperGuaName: 'å·½',
                lowerGuaName: 'å…‘',
                changingLineNum: 5,
                originalHex: '110011', // é£æ³½ä¸­å­š
                changedHex: '110001'   // å±±æ³½æŸï¼ˆç¬¬5çˆ»å˜ï¼‰
            };

            console.log('\næµ‹è¯•æ¡ˆä¾‹1: æ•°å­—èµ·å¦13,34');
            console.log('è®¡ç®—ç»“æœ:', testCase1);
            console.log('é¢„æœŸç»“æœ:', expected1);

            const test1Pass = (
                testCase1.upperGuaName === expected1.upperGuaName &&
                testCase1.lowerGuaName === expected1.lowerGuaName &&
                testCase1.changingLineNum === expected1.changingLineNum &&
                testCase1.originalHex === expected1.originalHex &&
                testCase1.changedHex === expected1.changedHex
            );

            console.log('æµ‹è¯•1ç»“æœ:', test1Pass ? 'âœ“ é€šè¿‡' : 'âœ— å¤±è´¥');

            if (test1Pass) {
                const originalInfo = HEXAGRAMS[testCase1.originalHex];
                const changedInfo = HEXAGRAMS[testCase1.changedHex];
                console.log('æœ¬å¦:', originalInfo.name);
                console.log('å˜å¦:', changedInfo.name);
                console.log('é¢„æœŸ: é£æ³½ä¸­å­šä¹‹å±±æ³½æŸ');
                console.log('éªŒè¯:', originalInfo.name === 'é£æ³½ä¸­å­š' && changedInfo.name === 'å±±æ³½æŸ' ? 'âœ“ å¦åæ­£ç¡®' : 'âœ— å¦åé”™è¯¯');
            }

            // æµ‹è¯•ç»“æœæ±‡æ€»
            const ganzhiTest = (
                ganzhi.year === expected.year &&
                ganzhi.month === expected.month &&
                ganzhi.day === expected.day &&
                ganzhi.hour === expected.hour
            );

            console.log('å¹²æ”¯æµ‹è¯•æ•´ä½“ç»“æœ:', ganzhiTest ? 'âœ“ é€šè¿‡' : 'âœ— å¤±è´¥');
        }

        // å…¨é¢çš„å›å½’æµ‹è¯•å‡½æ•°
        function runRegressionTests() {
            console.log('ğŸ” === å…­çˆ»æ’ç›˜ç³»ç»Ÿ - å…¨é¢å›å½’æµ‹è¯• ===');

            const results = {
                total: 0,
                passed: 0,
                failed: 0,
                testDetails: []
            };

            // è¾…åŠ©å‡½æ•°ï¼šè¿è¡Œå•ä¸ªæµ‹è¯•
            function runTest(name, testFn, expectedValue = null) {
                results.total++;
                try {
                    const result = testFn();
                    const passed = expectedValue ? result === expectedValue : result;

                    if (passed) {
                        results.passed++;
                        console.log(`âœ… ${name}: é€šè¿‡`);
                        results.testDetails.push({ name, status: 'PASS', details: result });
                    } else {
                        results.failed++;
                        console.log(`âŒ ${name}: å¤±è´¥ - å®é™…: ${result}, æœŸæœ›: ${expectedValue}`);
                        results.testDetails.push({ name, status: 'FAIL', details: result, expected: expectedValue });
                    }
                } catch (error) {
                    results.failed++;
                    console.log(`âŒ ${name}: é”™è¯¯ - ${error.message}`);
                    results.testDetails.push({ name, status: 'ERROR', error: error.message });
                }
            }

            // æµ‹è¯•1ï¼šæ—¶é—´èµ·å¦åŠ¨çˆ»è®¡ç®—ä¿®å¤éªŒè¯
            runTest('æ—¶é—´èµ·å¦åŠ¨çˆ»èŒƒå›´ä¿®å¤', () => {
                const result1 = timeToHexagram('2025-09-26', '13:00');
                const result2 = timeToHexagram('2024-01-01', '00:00');
                const result3 = timeToHexagram('2023-12-31', '23:00');

                return (result1.changingLine >= 1 && result1.changingLine <= 6) &&
                       (result2.changingLine >= 1 && result2.changingLine <= 6) &&
                       (result3.changingLine >= 1 && result3.changingLine <= 6);
            }, true);

            // æµ‹è¯•2ï¼šæ•°å­—èµ·å¦ç»å…¸æ¡ˆä¾‹ï¼ˆ13,34ï¼‰
            runTest('æ•°å­—èµ·å¦ç»å…¸æ¡ˆä¾‹éªŒè¯', () => {
                const result = traditionalNumberDivination(13, 34);
                return result.originalHex === '110011' &&
                       result.changedHex === '110001' &&
                       result.changingLineNum >= 1 && result.changingLineNum <= 6;
            }, true);

            // æµ‹è¯•3ï¼šè¾“å…¥éªŒè¯æµ‹è¯•
            runTest('æ—¥æœŸè¾“å…¥éªŒè¯æµ‹è¯•', () => {
                try {
                    validateInputs(); // æ— è¾“å…¥åº”æŠ›å‡ºé”™è¯¯
                    return false; // ä¸åº”è¯¥åˆ°è¾¾è¿™é‡Œ
                } catch (e) {
                    return e.message.includes('è¯·é€‰æ‹©'); // åº”è¯¥æŠ›å‡ºé€‰æ‹©æç¤º
                }
            }, true);

            runTest('æ•°å­—è¾“å…¥éªŒè¯æµ‹è¯•', () => {
                try {
                    document.getElementById('number1').value = '';
                    document.getElementById('number2').value = '';
                    validateNumberInputs(); // æ— è¾“å…¥åº”æŠ›å‡ºé”™è¯¯
                    return false;
                } catch (e) {
                    return e.message.includes('è¯·è¾“å…¥æœ‰æ•ˆ'); // åº”è¯¥æŠ›å‡ºæœ‰æ•ˆè¾“å…¥æç¤º
                }
            }, true);

            // æµ‹è¯•4ï¼šç©ºäº¡è®¡ç®—å‡†ç¡®æ€§
            runTest('ç©ºäº¡è®¡ç®—å‡†ç¡®æ€§æµ‹è¯•', () => {
                return testKongWangCalculation();
            }, true);

            // æµ‹è¯•5ï¼šå…«çº¯å¦ä¸–åº”ä½ç½®éªŒè¯
            runTest('å…«çº¯å¦ä¸–åº”ä½ç½®éªŒè¯', () => {
                const testCases = [
                    { hex: '111111', expectedWorld: 4, expectedPeer: 1 }, // ä¹¾ä¸ºå¤©
                    { hex: '000000', expectedWorld: 1, expectedPeer: 4 }, // å¤ä¸ºåœ°
                    { hex: '100100', expectedWorld: 6, expectedPeer: 3 }, // éœ‡ä¸ºé›·
                    { hex: '011011', expectedWorld: 3, expectedPeer: 6 }  // å…‘ä¸ºæ³½
                ];

                return testCases.every(testCase => {
                    const fullData = calculateLiuQinFromFullData(testCase.hex);
                    return fullData &&
                           fullData.worldLine === testCase.expectedWorld &&
                           fullData.peerLine === testCase.expectedPeer;
                });
            }, true);

            // æµ‹è¯•6ï¼šå…­ç¥æ’åˆ—æµ‹è¯•
            runTest('å…­ç¥æ’åˆ—å‡†ç¡®æ€§æµ‹è¯•', () => {
                const testCases = [
                    { dayGan: 'ç”²', expected: ['é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦'] },
                    { dayGan: 'æˆŠ', expected: ['å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€'] },
                    { dayGan: 'åºš', expected: ['ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡'] }
                ];

                return testCases.every(testCase => {
                    const result = calculateLiuShen(testCase.dayGan);
                    return JSON.stringify(result) === JSON.stringify(testCase.expected);
                });
            }, true);

            // æµ‹è¯•7ï¼šé”™è¯¯å¤„ç†æœºåˆ¶æµ‹è¯•
            runTest('é”™è¯¯å¤„ç†æœºåˆ¶æµ‹è¯•', () => {
                // æµ‹è¯•ç©ºçš„æ—¶é—´è¾“å…¥
                try {
                    const result = timeToHexagram('', '');
                    return false; // åº”è¯¥æŠ›å‡ºé”™è¯¯
                } catch (e) {
                    // æ£€æŸ¥æ˜¯å¦æœ‰åˆé€‚çš„é”™è¯¯å¤„ç†
                    return true;
                }
            }, true);

            // æµ‹è¯•8ï¼šå…­äº²è®¡ç®—ä¸€è‡´æ€§æµ‹è¯•
            runTest('å…­äº²è®¡ç®—ä¸€è‡´æ€§æµ‹è¯•', () => {
                const testHex = '111111'; // ä¹¾ä¸ºå¤©
                const najia = ['æˆŠå­', 'æˆŠå¯…', 'æˆŠè¾°', 'å£¬åˆ', 'å£¬ç”³', 'å£¬æˆŒ']; // ä¹¾å¦çº³ç”²
                const result1 = calculateLiuQin(testHex, 'ç”²', najia);
                const result2 = calculateLiuQinFromFullData(testHex);

                // å¦‚æœå®Œæ•´æ•°æ®å¯ç”¨ï¼Œä¸¤ç§è®¡ç®—æ–¹æ³•åº”è¯¥ä¸€è‡´
                if (result2 && result2.relations) {
                    return JSON.stringify(result1) === JSON.stringify(result2.relations);
                }

                // å¦‚æœå®Œæ•´æ•°æ®ä¸å¯ç”¨ï¼Œè‡³å°‘åŸºç¡€è®¡ç®—åº”è¯¥æˆåŠŸ
                return Array.isArray(result1) && result1.length === 6;
            }, true);

            // æµ‹è¯•ç»“æœæ±‡æ€»
            console.log('\nğŸ“Š === æµ‹è¯•ç»“æœæ±‡æ€» ===');
            console.log(`æ€»æµ‹è¯•æ•°: ${results.total}`);
            console.log(`é€šè¿‡: ${results.passed} âœ…`);
            console.log(`å¤±è´¥: ${results.failed} âŒ`);
            console.log(`é€šè¿‡ç‡: ${((results.passed / results.total) * 100).toFixed(1)}%`);

            // å¦‚æœæœ‰å¤±è´¥çš„æµ‹è¯•ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            if (results.failed > 0) {
                console.log('\nâš ï¸ å¤±è´¥çš„æµ‹è¯•è¯¦æƒ…:');
                results.testDetails
                    .filter(test => test.status !== 'PASS')
                    .forEach(test => {
                        console.log(`- ${test.name}: ${test.status}`);
                        if (test.error) console.log(`  é”™è¯¯: ${test.error}`);
                        if (test.expected) console.log(`  æœŸæœ›: ${test.expected}, å®é™…: ${test.details}`);
                    });
            }

            // è´¨é‡ç­‰çº§è¯„ä¼°
            const passRate = (results.passed / results.total) * 100;
            let quality = 'æœªçŸ¥';
            if (passRate >= 95) quality = 'ä¼˜ç§€ ğŸŒŸ';
            else if (passRate >= 85) quality = 'è‰¯å¥½ âœ¨';
            else if (passRate >= 70) quality = 'ä¸€èˆ¬ âš ï¸';
            else quality = 'éœ€è¦æ”¹è¿› âŒ';

            console.log(`\nğŸ¯ ç³»ç»Ÿè´¨é‡è¯„çº§: ${quality} (${passRate.toFixed(1)}%)`);
            console.log('=== å›å½’æµ‹è¯•å®Œæˆ ===\n');

            return {
                passed: results.passed === results.total,
                passRate: passRate,
                summary: results
            };
        }

        // å¿«é€Ÿæµ‹è¯•å‡½æ•°
        function quickTest() {
            console.log('=== æœ€ç»ˆéªŒè¯ 2025å¹´9æœˆ26æ—¥13æ—¶ ===');

            const date = '2025-09-26';
            const time = '13:00';
            const ganzhi = getCurrentGanzhi(date, time);

            console.log('è®¡ç®—ç»“æœ:');
            console.log('å¹´æŸ±:', ganzhi.year, 'æœŸæœ›: ä¹™å·³', ganzhi.year === 'ä¹™å·³' ? 'âœ“' : 'âœ—');
            console.log('æœˆæŸ±:', ganzhi.month, 'æœŸæœ›: ä¹™é…‰', ganzhi.month === 'ä¹™é…‰' ? 'âœ“' : 'âœ—');
            console.log('æ—¥æŸ±:', ganzhi.day, 'æœŸæœ›: æˆŠæˆŒ', ganzhi.day === 'æˆŠæˆŒ' ? 'âœ“' : 'âœ—');
            console.log('æ—¶æŸ±:', ganzhi.hour, 'æœŸæœ›: å·±æœª', ganzhi.hour === 'å·±æœª' ? 'âœ“' : 'âœ—');

            const allCorrect = (
                ganzhi.year === 'ä¹™å·³' &&
                ganzhi.month === 'ä¹™é…‰' &&
                ganzhi.day === 'æˆŠæˆŒ' &&
                ganzhi.hour === 'å·±æœª'
            );

            console.log('\\nå®Œæ•´å››æŸ±:', ganzhi.year, ganzhi.month, ganzhi.day, ganzhi.hour);
            console.log('æœŸæœ›å››æŸ±: ä¹™å·³ ä¹™é…‰ æˆŠæˆŒ å·±æœª');
            console.log('æ•´ä½“éªŒè¯:', allCorrect ? 'âœ“ å…¨éƒ¨æ­£ç¡®' : 'âœ— ä»æœ‰é”™è¯¯');

            // éªŒè¯æˆŠæˆŒæ—¥å…­ç¥æ’åˆ—
            const liuShen = calculateLiuShen('æˆŠ');
            console.log('\\næˆŠæˆŒæ—¥å…­ç¥æ’åˆ—ï¼ˆåˆçˆ»â†’ä¸Šçˆ»ï¼‰:', liuShen);
            console.log('æœŸæœ›: [å‹¾é™ˆ, è£è›‡, ç™½è™, ç„æ­¦, é’é¾™, æœ±é›€]');
            const expectedLiuShen = ['å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦', 'é’é¾™', 'æœ±é›€'];
            const liuShenCorrect = JSON.stringify(liuShen) === JSON.stringify(expectedLiuShen);
            console.log('å…­ç¥éªŒè¯:', liuShenCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯');

            // éªŒè¯æ­£ç¡®çš„å…­äº²ç®—æ³•
            console.log('\\n=== å…­äº²ç®—æ³•éªŒè¯ ===');
            console.log('ä½¿ç”¨æ­£ç¡®çš„"åœ°æ”¯è·Ÿå¦èµ°ï¼Œå¦å®«å®šå…­äº²"ç®—æ³•');

            // æµ‹è¯•ä¹¾ä¸ºå¤©å¦
            validateLiuQinCalculation('111111');

            // æµ‹è¯•å¤ä¸ºåœ°å¦
            validateLiuQinCalculation('000000');

            console.log('\\nå…­äº²ç®—æ³•æ ¸å¿ƒåŸç†:');
            console.log('1. åœ°æ”¯è·Ÿå¦èµ°ï¼šæ¯ä¸ªå¦çš„çº³æ”¯å›ºå®šï¼Œç”±å¦è±¡å†³å®š');
            console.log('2. å¦å®«å®šå…­äº²ï¼šå…­äº²ç”±çº³æ”¯äº”è¡Œä¸å¦å®«äº”è¡Œçš„ç”Ÿå…‹å…³ç³»å†³å®š');
            console.log('3. ä¸ä¾èµ–æ—¥å¹²ï¼šå…­äº²ä¸èµ·å¦æ—¥æœŸæ— å…³ï¼Œåªçœ‹å¦è±¡æœ¬èº«');

            console.log('=== éªŒè¯å®Œæˆ ===');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setCurrentDateTime();
            populateHexagramSelects();
            setupTabs();

            // è¿è¡Œå¿«é€Ÿæµ‹è¯•å’Œè‡ªæ ¡éªŒ
            setTimeout(() => {
                quickTest();
                runSelfValidation();
            }, 1000);
        });

        function setCurrentDateTime() {
            const now = new Date();
            document.getElementById('date').value = now.toISOString().split('T')[0];
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
        }

        function populateHexagramSelects() {
            const originalSelect = document.getElementById('original-hex');
            const changedSelect = document.getElementById('changed-hex');

            // æŒ‰å¦åºå·æ’åº
            const sortedHexagrams = Object.entries(HEXAGRAMS)
                .sort(([,a], [,b]) => a.number - b.number);

            sortedHexagrams.forEach(([binary, hex]) => {
                const option1 = new Option(`${hex.number}. ${hex.name}`, binary);
                const option2 = new Option(`${hex.number}. ${hex.name}`, binary);
                originalSelect.appendChild(option1);
                changedSelect.appendChild(option2);
            });
        }

        function setupTabs() {
            document.querySelectorAll('.method-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.method-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                    // æ¿€æ´»å½“å‰æ ‡ç­¾
                    this.classList.add('active');
                    const method = this.dataset.method;
                    document.getElementById(`${method}-tab`).classList.add('active');

                    currentMethod = method;
                });
            });

            // è®¾ç½®æ‰‹åŠ¨æŒ‡å®šçš„å­æ ‡ç­¾é¡µ
            document.querySelectorAll('.manual-method-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.manual-method-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.manual-method').forEach(m => m.classList.remove('active'));

                    this.classList.add('active');
                    const manualMethod = this.dataset.manual;
                    document.getElementById(`${manualMethod}-method`).classList.add('active');

                    currentManualMethod = manualMethod;
                });
            });
        }

        function setCoinResult(line, result) {
            coinResults[line] = result;
            document.getElementById(`coin-result-${line}`).textContent = result;

            // æ›´æ–°æŒ‰é’®æ ·å¼
            const buttons = document.querySelectorAll(`[data-line="${line}"] .coin-btn`);
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // æ ‡è®°è¯¥è¡Œä¸ºå·²å®Œæˆ
            const coinThrow = document.querySelector(`[data-line="${line}"]`);
            coinThrow.classList.add('completed');
        }

        /**
         * ä¼ ç»Ÿæ—¶é—´èµ·å¦æ³•
         * æ ¹æ®ã€Šæ¢…èŠ±æ˜“æ•°ã€‹çš„æ–¹æ³•ï¼Œä½¿ç”¨èµ·å¦æ—¶é—´è®¡ç®—å¦è±¡
         *
         * @param {string} date - èµ·å¦æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD
         * @param {string} time - èµ·å¦æ—¶é—´ï¼Œæ ¼å¼ï¼šHH:MM
         * @returns {Object} åŒ…å«ä¸Šå¦ã€ä¸‹å¦ã€åŠ¨çˆ»çš„å¯¹è±¡
         *
         * è®¡ç®—åŸç†ï¼š
         * 1. ä¸Šå¦ = (å¹´æ•° + æœˆæ•° + æ—¥æ•°) % 8ï¼Œä½™æ•°å¯¹åº”å…«å¦
         * 2. ä¸‹å¦ = (å¹´æ•° + æœˆæ•° + æ—¥æ•° + æ—¶æ•°) % 8ï¼Œä½™æ•°å¯¹åº”å…«å¦
         * 3. åŠ¨çˆ» = (å¹´æ•° + æœˆæ•° + æ—¥æ•° + æ—¶æ•° - 1) % 6 + 1ï¼Œå¾—1-6çˆ»ä½
         *
         * æ³¨æ„ï¼šå…«å¦å¯¹åº”å…³ç³»æŒ‰ç…§å…ˆå¤©å…«å¦åºæ•°ï¼ŒåŠ¨çˆ»ä½ç½®ä»1å¼€å§‹è®¡æ•°
         */
        function timeToHexagram(date, time) {
            const dateObj = new Date(`${date}T${time}`);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            const hour = dateObj.getHours();

            // æ—¶é—´èµ·å¦æ³•ï¼šå¹´æœˆæ—¥æ—¶ç›¸åŠ é™¤ä»¥8å–ä½™æ•°
            const upperGua = (year + month + day) % 8;
            const lowerGua = (year + month + day + hour) % 8;
            // åŠ¨çˆ»è®¡ç®—ä¿®å¤ï¼šç¡®ä¿ç»“æœåœ¨1-6èŒƒå›´å†…
            const changingLine = ((year + month + day + hour - 1) % 6) + 1;

            return { upperGua, lowerGua, changingLine };
        }

        function guaNumberToBinary(guaNum) {
            const guaMap = {
                0: '000', 1: '111', 2: '000', 3: '100',
                4: '011', 5: '010', 6: '101', 7: '110'
            };
            return guaMap[guaNum] || '000';
        }

        // è¾“å…¥éªŒè¯å‡½æ•°
        function validateInputs() {
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;

            if (!date) {
                throw new Error('è¯·é€‰æ‹©èµ·å¦æ—¥æœŸ');
            }

            if (!time) {
                throw new Error('è¯·é€‰æ‹©èµ·å¦æ—¶é—´');
            }

            // éªŒè¯æ—¥æœŸæ ¼å¼å’ŒèŒƒå›´
            const dateObj = new Date(`${date}T${time}`);
            const currentYear = new Date().getFullYear();

            if (isNaN(dateObj.getTime())) {
                throw new Error('æ—¥æœŸæˆ–æ—¶é—´æ ¼å¼æ— æ•ˆ');
            }

            if (dateObj.getFullYear() < 1900 || dateObj.getFullYear() > currentYear + 10) {
                throw new Error('æ—¥æœŸå¹´ä»½åº”åœ¨1900å¹´è‡³æœªæ¥10å¹´ä¹‹é—´');
            }

            return { date, time, dateObj };
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message, type = 'error') {
            // ç§»é™¤ç°æœ‰çš„é”™è¯¯æç¤º
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }

            // åˆ›å»ºæ–°çš„é”™è¯¯æç¤º
            const errorDiv = document.createElement('div');
            errorDiv.className = `error-message ${type}`;
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? 'var(--error-color)' : 'var(--warning-color)'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 300px;
                font-size: 0.9rem;
                line-height: 1.4;
                animation: slideInRight 0.3s ease;
            `;
            errorDiv.textContent = message;

            document.body.appendChild(errorDiv);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => errorDiv.remove(), 300);
                }
            }, 3000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        if (!document.getElementById('error-animations')) {
            const style = document.createElement('style');
            style.id = 'error-animations';
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        function calculateHexagram() {
            let originalHex, changedHex, changingLines = [];

            try {
                if (currentMethod === 'time') {
                    // éªŒè¯æ—¶é—´èµ·å¦è¾“å…¥
                    const { date, time } = validateInputs();

                    const { upperGua, lowerGua, changingLine } = timeToHexagram(date, time);
                    originalHex = guaNumberToBinary(lowerGua) + guaNumberToBinary(upperGua);

                    // ç”Ÿæˆå˜å¦
                    let changedBinary = originalHex.split('');
                    if (changingLine >= 1 && changingLine <= 6) {
                        const arrayIndex = changingLine - 1;
                        changedBinary[arrayIndex] = changedBinary[arrayIndex] === '1' ? '0' : '1';
                        changingLines = [changingLine];
                    }
                    changedHex = changedBinary.join('');

                } else if (currentMethod === 'coins') {
                    // æ£€æŸ¥é“œé’±èµ·å¦å®Œæ•´æ€§
                    if (Object.keys(coinResults).length !== 6) {
                        const missingLines = [];
                        for (let i = 1; i <= 6; i++) {
                            if (!coinResults[i]) {
                                missingLines.push(['åˆçˆ»', 'äºŒçˆ»', 'ä¸‰çˆ»', 'å››çˆ»', 'äº”çˆ»', 'ä¸Šçˆ»'][i-1]);
                            }
                        }
                        throw new Error(`è¯·å®Œæˆä»¥ä¸‹çˆ»ä½çš„æ‘‡å¦ï¼š${missingLines.join('ã€')}`);
                    }

                    let originalBinary = '';
                    let changedBinary = '';

                    for (let i = 1; i <= 6; i++) {
                        const result = coinResults[i];
                        if (result === 'è€é˜³') {
                            originalBinary = '1' + originalBinary;
                            changedBinary = '0' + changedBinary;
                            changingLines.push(i);
                        } else if (result === 'å°‘é˜³') {
                            originalBinary = '1' + originalBinary;
                            changedBinary = '1' + changedBinary;
                        } else if (result === 'å°‘é˜´') {
                            originalBinary = '0' + originalBinary;
                            changedBinary = '0' + changedBinary;
                        } else if (result === 'è€é˜´') {
                            originalBinary = '0' + originalBinary;
                            changedBinary = '1' + changedBinary;
                            changingLines.push(i);
                        }
                    }

                    originalHex = originalBinary;
                    changedHex = changedBinary;

                } else if (currentMethod === 'manual') {
                    if (currentManualMethod === 'hexname') {
                        originalHex = document.getElementById('original-hex').value;
                        changedHex = document.getElementById('changed-hex').value;

                        if (!originalHex) {
                            throw new Error('è¯·é€‰æ‹©æœ¬å¦');
                        }

                        if (!changedHex) {
                            changedHex = originalHex;
                        }
                    } else if (currentManualMethod === 'numbers') {
                        const upperNumStr = document.getElementById('upper-number').value.trim();
                        const lowerNumStr = document.getElementById('lower-number').value.trim();

                        if (!upperNumStr || !lowerNumStr) {
                            throw new Error('è¯·åˆ†åˆ«è¾“å…¥ä¸Šå¦æ•°å’Œä¸‹å¦æ•°');
                        }

                        const upperNum = parseInt(upperNumStr);
                        const lowerNum = parseInt(lowerNumStr);

                        if (isNaN(upperNum) || isNaN(lowerNum)) {
                            throw new Error('ä¸Šå¦æ•°å’Œä¸‹å¦æ•°å¿…é¡»æ˜¯æ•°å­—');
                        }

                        if (upperNum < 1 || lowerNum < 1) {
                            throw new Error('ä¸Šå¦æ•°å’Œä¸‹å¦æ•°å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼ˆå¤§äº0ï¼‰');
                        }

                        if (upperNum > 999999 || lowerNum > 999999) {
                            throw new Error('æ•°å­—è¿‡å¤§ï¼Œè¯·è¾“å…¥å°äº1000000çš„æ•°å­—');
                        }

                        const result = traditionalNumberDivination(upperNum, lowerNum);
                        originalHex = result.originalHex;
                        changedHex = result.changedHex;
                        changingLines = result.changingLines;
                    } else if (currentManualMethod === 'binary') {
                        const binaryInput = document.getElementById('binary-input').value.trim();
                        const changingLinesInput = document.getElementById('changing-lines-input').value.trim();

                        if (!binaryInput) {
                            throw new Error('è¯·è¾“å…¥6ä½äºŒè¿›åˆ¶å¦è±¡');
                        }

                        if (binaryInput.length !== 6) {
                            throw new Error(`äºŒè¿›åˆ¶å¦è±¡å¿…é¡»æ˜¯6ä½ï¼Œå½“å‰è¾“å…¥äº†${binaryInput.length}ä½`);
                        }

                        if (!/^[01]+$/.test(binaryInput)) {
                            throw new Error('äºŒè¿›åˆ¶å¦è±¡åªèƒ½åŒ…å«æ•°å­—0å’Œ1');
                        }

                        originalHex = binaryInput;
                        changedHex = binaryInput;

                        if (changingLinesInput) {
                            const lineNumbers = changingLinesInput.split(',').map(n => n.trim()).filter(n => n);

                            // éªŒè¯åŠ¨çˆ»è¾“å…¥æ ¼å¼
                            for (const lineNumStr of lineNumbers) {
                                const lineNum = parseInt(lineNumStr);
                                if (isNaN(lineNum)) {
                                    throw new Error(`åŠ¨çˆ»ä½ç½®"${lineNumStr}"ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—`);
                                }
                                if (lineNum < 1 || lineNum > 6) {
                                    throw new Error(`åŠ¨çˆ»ä½ç½®"${lineNum}"è¶…å‡ºèŒƒå›´ï¼Œå¿…é¡»åœ¨1-6ä¹‹é—´ï¼ˆ1=åˆçˆ»ï¼Œ6=ä¸Šçˆ»ï¼‰`);
                                }
                            }

                            // å»é‡å¹¶æ’åº
                            changingLines = [...new Set(lineNumbers.map(n => parseInt(n)))].sort((a, b) => a - b);

                            let changedBinary = binaryInput.split('');
                            changingLines.forEach(lineNum => {
                                const index = 6 - lineNum;
                                changedBinary[index] = changedBinary[index] === '1' ? '0' : '1';
                            });
                            changedHex = changedBinary.join('');
                        }
                    } else if (currentManualMethod === 'lines') {
                        const result = linesToHexagram();
                        originalHex = result.originalHex;
                        changedHex = result.changedHex;
                        changingLines = result.changingLines;
                    }
                }

                displayResult(originalHex, changedHex, changingLines);

            } catch (error) {
                console.error('æ’ç›˜è®¡ç®—é”™è¯¯:', error);
                showError(error.message);
                return;
            }
        }

        function displayResult(originalHex, changedHex, changingLines) {
            const originalHexInfo = HEXAGRAMS[originalHex];
            const changedHexInfo = HEXAGRAMS[changedHex];

            if (!originalHexInfo) {
                alert('å¦è±¡æ•°æ®é”™è¯¯');
                return;
            }

            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const question = document.getElementById('question').value || 'æœªå¡«å†™';

            // è·å–å¹²æ”¯ä¿¡æ¯
            const ganzhiInfo = getCurrentGanzhi(date, time);

            // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
            let infoHtml = `
                <div class="detail-card">
                    <div class="detail-title">å åœä¿¡æ¯</div>
                    <div class="detail-content">
                        <p><strong>æ‰€é—®ä¹‹äº‹ï¼š</strong>${question}</p>
                        <p><strong>èµ·å¦æ—¶é—´ï¼š</strong>${date} ${time}</p>
                        <p><strong>èµ·å¦æ–¹å¼ï¼š</strong>${getMethodName()}</p>
                    </div>
                </div>
                <div class="detail-card">
                    <div class="detail-title">å¹²æ”¯çºªæ—¶</div>
                    <div class="detail-content" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center;">
                        <div>
                            <strong style="color: var(--primary-color);">å¹´æŸ±</strong><br>
                            <span style="font-size: 1.2rem; font-weight: bold;">${ganzhiInfo.year}</span><br>
                            <small style="color: var(--text-secondary);">${ganzhiInfo.yearNum}å¹´</small>
                        </div>
                        <div>
                            <strong style="color: var(--primary-color);">æœˆæŸ±</strong><br>
                            <span style="font-size: 1.2rem; font-weight: bold;">${ganzhiInfo.month}</span><br>
                            <small style="color: var(--text-secondary);">${ganzhiInfo.monthNum}æœˆ</small>
                        </div>
                        <div>
                            <strong style="color: var(--primary-color);">æ—¥æŸ±</strong><br>
                            <span style="font-size: 1.2rem; font-weight: bold;">${ganzhiInfo.day}</span><br>
                            <small style="color: var(--text-secondary);">${ganzhiInfo.dayNum}æ—¥</small>
                        </div>
                        <div>
                            <strong style="color: var(--primary-color);">æ—¶æŸ±</strong><br>
                            <span style="font-size: 1.2rem; font-weight: bold;">${ganzhiInfo.hour}</span><br>
                            <small style="color: var(--text-secondary);">${ganzhiInfo.hourNum}æ—¶</small>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('hexagram-info').innerHTML = infoHtml;

            // è®¡ç®—ä¼ç¥å’Œç¥ç…
            const hiddenGodsInfo = calculateHiddenGods(originalHex);
            const shenShaInfo = calculateShenSha(ganzhiInfo.day.charAt(0), ganzhiInfo.day.charAt(1), ganzhiInfo.year.charAt(1));

            // æ˜¾ç¤ºå¦è±¡
            let hexagramHtml = `
                <div class="hexagram-card main-gua">
                    <div class="hexagram-name">æœ¬å¦ï¼š${originalHexInfo.name}</div>
                    <div class="hexagram-content">
                        <div class="hexagram-lines">
                            ${renderPureHexagramLines(originalHex, changingLines)}
                        </div>
                        <div>
                            ${renderZhuangGuaTable(originalHex, changingLines, date, time)}
                            ${renderHiddenGodsAndShenSha(hiddenGodsInfo, shenShaInfo)}
                        </div>
                    </div>
                </div>
            `;

            if (changedHex !== originalHex) {
                hexagramHtml += `
                    <div class="hexagram-card changed-gua">
                        <div class="hexagram-name">å˜å¦ï¼š${changedHexInfo.name}</div>
                        <div class="hexagram-content">
                            <div class="hexagram-lines">
                                ${renderPureHexagramLines(changedHex, [])}
                            </div>
                            <div>
                                ${renderZhuangGuaTable(changedHex, [], date, time)}
                            </div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('hexagram-display').innerHTML = hexagramHtml;

            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('result-container').classList.add('show');

            // å¯åŠ¨AIåˆ†æ
            const hexagramData = {
                originalHex,
                changedHex,
                changingLines,
                question,
                date,
                time
            };
            performAIReasoning(hexagramData);

            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            document.getElementById('result-container').scrollIntoView({
                behavior: 'smooth'
            });
        }

        function renderPureHexagramLines(hexBinary, changingLines) {
            let html = '';
            for (let i = 5; i >= 0; i--) {
                const isYang = hexBinary[i] === '1';
                const isChanging = changingLines.includes(i + 1);
                const lineClass = isYang ? 'yang' : 'yin';
                const changingClass = isChanging ? 'changing' : '';

                html += `
                    <div class="pure-line ${lineClass} ${changingClass}">
                        ${isYang ? 'â”â”â”â”â”' : 'â”â” â”â”'}
                        ${isChanging ? '<span class="dong-yao">â—‹</span>' : ''}
                    </div>
                `;
            }
            return html;
        }

        function renderZhuangGuaTable(hexBinary, changingLines, date, time) {
            const hexInfo = HEXAGRAMS[hexBinary];
            if (!hexInfo) return '';

            const zhuangGuaData = generateZhuangGuaData(hexBinary, changingLines, date, time);

            let html = '<div class="table-container"><table class="zhuanggua-table">';
            html += `
                <thead>
                    <tr>
                        <th style="width: 15%">çˆ»ä½</th>
                        <th style="width: 18%">å…­ç¥</th>
                        <th style="width: 18%">å…­äº²</th>
                        <th style="width: 20%">çº³ç”²</th>
                        <th style="width: 15%">ä¸–åº”</th>
                        <th style="width: 16%">åŠ¨é™</th>
                    </tr>
                </thead>
                <tbody>
            `;

            for (let i = 5; i >= 0; i--) {
                const lineName = getLineName(i + 1);
                const liuShen = zhuangGuaData.liuShen[i];
                const liuQin = zhuangGuaData.liuQin[i];
                const naZhi = zhuangGuaData.naZhi[i];
                const isKongWang = zhuangGuaData.kongWang.includes(naZhi);
                const shiYingText = zhuangGuaData.shiYing[0] === i + 1 ? 'ä¸–' :
                                  (zhuangGuaData.shiYing[1] === i + 1 ? 'åº”' : '');
                const isChanging = changingLines.includes(i + 1);
                const dongJingText = isChanging ? 'åŠ¨' : 'é™';

                html += `
                    <tr>
                        <td class="yaopai-cell">${lineName}çˆ»</td>
                        <td class="liushen-cell">${liuShen}</td>
                        <td class="liuqin-cell">${liuQin}</td>
                        <td class="nazhi-cell ${isKongWang ? 'kong' : ''}" title="${isKongWang ? 'ç©ºäº¡' : ''}">${zhuangGuaData.najiaGanZhi[i]}${isKongWang ? '(ç©º)' : ''}</td>
                        <td class="shying-cell">${shiYingText}</td>
                        <td class="dongjing-cell ${isChanging ? 'dong' : 'jing'}">${dongJingText}</td>
                    </tr>
                `;
            }

            html += '</tbody></table></div>';
            return html;
        }

        function generateZhuangGuaData(hexBinary, changingLines, date, time) {
            const hexInfo = HEXAGRAMS[hexBinary];
            const ganzhi = getCurrentGanzhi(date, time);

            // è·å–å®Œæ•´çš„çº³ç”²å¹²æ”¯ä¿¡æ¯
            const najiaGanZhi = NAJIA_CONFIG[hexBinary] || hexInfo.najia;

            // æå–çº³æ”¯ï¼ˆåœ°æ”¯éƒ¨åˆ†ï¼Œç”¨äºç©ºäº¡åˆ¤æ–­ï¼‰
            const naZhi = najiaGanZhi.map(gz => gz.charAt(1));

            // è®¡ç®—å…­ç¥ï¼ˆä»¥èµ·å¦æ—¥çš„æ—¥å¹²ä¸ºå‡†ï¼‰
            const dayGan = ganzhi.day.charAt(0);
            const liuShen = calculateLiuShen(dayGan);

            // è®¡ç®—å…­äº²ï¼ˆä»¥å®Œæ•´çº³ç”²å¹²æ”¯ä¸ºå‡†ï¼‰
            const liuQin = calculateLiuQin(hexBinary, dayGan, najiaGanZhi);

            // è®¡ç®—ç©ºäº¡
            const kongWang = calculateKongWang(ganzhi.day);

            return {
                liuShen,
                naZhi,
                najiaGanZhi,
                liuQin,
                kongWang,
                shiYing: hexInfo.shiYing,
                palace: hexInfo.palace,
                ganzhi
            };
        }

        /**
         * å…­ç¥è®¡ç®—ï¼ˆåŸºäºæ—¥å¹²ï¼‰
         * æ ¹æ®èµ·å¦æ—¥çš„å¤©å¹²ï¼Œç¡®å®šå…­çˆ»çš„å…­ç¥é…ç½®
         *
         * @param {string} dayGan - æ—¥å¹²ï¼Œå¦‚"ç”²"ã€"ä¹™"ã€"ä¸™"ç­‰
         * @returns {Array<string>} ä»åˆçˆ»åˆ°ä¸Šçˆ»çš„å…­ç¥æ•°ç»„
         *
         * å…­ç¥èµ·ä¾‹å£è¯€ï¼š
         * - ç”²ä¹™èµ·é’é¾™ï¼šç”²ä¹™æ—¥åˆçˆ»èµ·é’é¾™
         * - ä¸™ä¸èµ·æœ±é›€ï¼šä¸™ä¸æ—¥åˆçˆ»èµ·æœ±é›€
         * - æˆŠå·±èµ·å‹¾é™ˆï¼šæˆŠå·±æ—¥åˆçˆ»èµ·å‹¾é™ˆ
         * - åºšè¾›èµ·è£è›‡ï¼šåºšè¾›æ—¥åˆçˆ»èµ·è£è›‡
         * - å£¬ç™¸èµ·ç™½è™ï¼šå£¬ç™¸æ—¥åˆçˆ»èµ·ç™½è™
         *
         * å…­ç¥é¡ºåºï¼šé’é¾™â†’æœ±é›€â†’å‹¾é™ˆâ†’è£è›‡â†’ç™½è™â†’ç„æ­¦ï¼ˆå¾ªç¯ï¼‰
         */
        function calculateLiuShen(dayGan) {
            const liuShenSequence = ['é’é¾™', 'æœ±é›€', 'å‹¾é™ˆ', 'è£è›‡', 'ç™½è™', 'ç„æ­¦'];
            const dayGanIndex = TIANGAN.indexOf(dayGan);

            // å…­ç¥èµ·ä¾‹å£è¯€ï¼šç”²ä¹™èµ·é’é¾™ï¼Œä¸™ä¸èµ·æœ±é›€ï¼ŒæˆŠå·±èµ·å‹¾é™ˆï¼Œåºšè¾›èµ·è£è›‡ï¼Œå£¬ç™¸èµ·ç™½è™
            const startIndexMap = {
                0: 0, // ç”²èµ·é’é¾™
                1: 0, // ä¹™èµ·é’é¾™
                2: 1, // ä¸™èµ·æœ±é›€
                3: 1, // ä¸èµ·æœ±é›€
                4: 2, // æˆŠèµ·å‹¾é™ˆï¼ˆæˆŠæˆŒæ—¥åˆçˆ»å‹¾é™ˆï¼‰
                5: 2, // å·±èµ·å‹¾é™ˆ
                6: 3, // åºšèµ·è£è›‡
                7: 3, // è¾›èµ·è£è›‡
                8: 4, // å£¬èµ·ç™½è™
                9: 4  // ç™¸èµ·ç™½è™
            };

            const startIndex = startIndexMap[dayGanIndex];
            const result = [];

            // ä»åˆçˆ»åˆ°ä¸Šçˆ»ä¾æ¬¡æ’åˆ—å…­ç¥
            for (let i = 0; i < 6; i++) {
                result.push(liuShenSequence[(startIndex + i) % 6]);
            }

            return result;
        }

        // æ­£ç¡®çš„å…­äº²è®¡ç®—ç®—æ³•ï¼ˆåŸºäº"åœ°æ”¯è·Ÿå¦èµ°ï¼Œå¦å®«å®šå…­äº²"çš„ä¼ ç»Ÿç†è®ºï¼‰
        function calculateLiuQin(hexBinary, dayGan, najiaGanZhi) {
            // ä¼˜å…ˆä½¿ç”¨å®Œæ•´æ•°æ®è¡¨
            const fullDataResult = calculateLiuQinFromFullData(hexBinary);
            if (fullDataResult && fullDataResult.relations && fullDataResult.relations.length === 6) {
                return fullDataResult.relations;
            }

            // å¦‚æœå®Œæ•´æ•°æ®ä¸å¯ç”¨ï¼Œä½¿ç”¨ä¼ ç»Ÿç®—æ³•
            // 1. è·å–å¦å®«ï¼ˆæ ¹æ®å¦è±¡æŸ¥æ‰¾æ‰€å±å¦å®«ï¼‰
            const hexInfo = HEXAGRAMS[hexBinary];
            if (!hexInfo) {
                console.warn(`æœªæ‰¾åˆ°å¦è±¡ ${hexBinary} çš„ä¿¡æ¯`);
                return ['å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ'];
            }

            const guaGong = hexInfo.palace;  // å¦å®«åç§°ï¼Œå¦‚"ä¹¾"ã€"å¤"ç­‰

            // 2. è·å–å¦å®«äº”è¡Œ
            const guaGongWuxing = BAGUA_WUXING[guaGong];
            if (!guaGongWuxing) {
                console.warn(`æœªæ‰¾åˆ°å¦å®« ${guaGong} çš„äº”è¡Œå±æ€§`);
                return ['å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ', 'å…„å¼Ÿ'];
            }

            // 3. æå–çº³æ”¯ï¼ˆåœ°æ”¯éƒ¨åˆ†ï¼‰
            const nazhiList = najiaGanZhi.map(gz => gz.charAt(1));

            // 4. è®¡ç®—æ¯ä¸€çˆ»çš„å…­äº²
            const liuqinList = [];
            for (let i = 0; i < 6; i++) {
                const nazhi = nazhiList[i];           // è¯¥çˆ»çš„çº³æ”¯ï¼ˆåœ°æ”¯ï¼‰
                const nazhiWuxing = DIZHI_WUXING[nazhi];  // çº³æ”¯çš„äº”è¡Œ

                if (!nazhiWuxing) {
                    console.warn(`æœªæ‰¾åˆ°åœ°æ”¯ ${nazhi} çš„äº”è¡Œå±æ€§`);
                    liuqinList.push('å…„å¼Ÿ');
                    continue;
                }

                // æ ¹æ®çº³æ”¯äº”è¡Œä¸å¦å®«äº”è¡Œçš„å…³ç³»ç¡®å®šå…­äº²
                const relationMap = LIUQIN_RELATIONS[guaGongWuxing];
                const liuqin = relationMap ? relationMap[nazhiWuxing] : 'å…„å¼Ÿ';

                liuqinList.push(liuqin || 'å…„å¼Ÿ'); // å¦‚æœæ‰¾ä¸åˆ°å…³ç³»ï¼Œé»˜è®¤ä¸ºå…„å¼Ÿ
            }

            return liuqinList;
        }

        // è¯¦ç»†çš„å…­äº²è®¡ç®—ï¼ˆè€ƒè™‘é˜´é˜³åŒå¼‚ï¼‰
        function calculateLiuQinDetailed(hexBinary, dayGan, najiaGanZhi) {
            const basicResult = calculateLiuQin(hexBinary, dayGan, najiaGanZhi);

            // å¦‚æœæä¾›äº†æ—¥å¹²ï¼Œå¯ä»¥è¿›è¡Œé˜´é˜³åŒå¼‚çš„ç»†åŒ–åˆ¤æ–­
            if (!dayGan) {
                return basicResult;
            }

            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const dayGanYinYang = dayGanIndex % 2; // 0ä¸ºé˜³ï¼Œ1ä¸ºé˜´

            const detailedResult = [];
            for (let i = 0; i < 6; i++) {
                const najiaGan = najiaGanZhi[i].charAt(0);
                const najiaGanIndex = TIANGAN.indexOf(najiaGan);
                const najiaGanYinYang = najiaGanIndex % 2;

                let liuqin = basicResult[i];

                // å¯¹å…„å¼Ÿè¿›è¡Œé˜´é˜³åŒå¼‚ç»†åŒ–
                if (liuqin === 'å…„å¼Ÿ') {
                    if (dayGanYinYang === najiaGanYinYang) {
                        liuqin = 'å…„å¼Ÿ'; // åŒé˜´é˜³ä¸ºå…„å¼Ÿ
                    } else {
                        liuqin = 'å§å¦¹'; // å¼‚é˜´é˜³ä¸ºå§å¦¹
                    }
                }

                detailedResult.push(liuqin);
            }

            return detailedResult;
        }

        // éªŒè¯æ­£ç¡®çš„å…­äº²è®¡ç®—ï¼ˆç”¨äºè°ƒè¯•å’ŒéªŒè¯ï¼‰
        function validateLiuQinCalculation(hexBinary) {
            const hexInfo = HEXAGRAMS[hexBinary];
            const najiaGanZhi = NAJIA_CONFIG[hexBinary] || hexInfo.najia;
            const guaGong = hexInfo.palace;
            const guaGongWuxing = BAGUA_WUXING[guaGong];

            console.log(`\n=== ${hexInfo.name}å…­äº²éªŒè¯ ===`);
            console.log(`å¦å®«ï¼š${guaGong}å®«ï¼ˆ${guaGongWuxing}ï¼‰`);

            const nazhiList = najiaGanZhi.map(gz => gz.charAt(1));
            const liuqinList = calculateLiuQin(hexBinary, '', najiaGanZhi);

            for (let i = 0; i < 6; i++) {
                const lineName = ['åˆ', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'ä¸Š'][i];
                const nazhi = nazhiList[i];
                const nazhiWuxing = DIZHI_WUXING[nazhi];
                const liuqin = liuqinList[i];

                console.log(`${lineName}çˆ»ï¼šçº³æ”¯${nazhi}(${nazhiWuxing}) â†’ ä¸å¦å®«${guaGong}(${guaGongWuxing})çš„å…³ç³» â†’ ${liuqin}`);
            }
        }

        /**
         * è®¡ç®—ç©ºäº¡ï¼ˆæ—¬ç©ºï¼‰
         * æ ¹æ®æ—¥å¹²æ”¯ç¡®å®šæ‰€åœ¨æ—¬ï¼ŒæŸ¥æ‰¾è¯¥æ—¬ä¸­ç©ºäº¡çš„ä¸¤ä¸ªåœ°æ”¯
         *
         * @param {string} dayGanzhi - æ—¥å¹²æ”¯ï¼Œå¦‚"ç”²å­"ã€"ä¹™ä¸‘"ç­‰
         * @returns {Array<string>} è¿”å›ç©ºäº¡çš„ä¸¤ä¸ªåœ°æ”¯æ•°ç»„
         *
         * ç©ºäº¡ç†è®ºï¼š
         * - æ¯æ—¬10å¤©ï¼Œä»¥ç”²ä¸ºé¦–ï¼Œä½†åœ°æ”¯æœ‰12ä¸ªï¼Œæ•…å¿…æœ‰2ä¸ªåœ°æ”¯ç©ºäº¡
         * - ç”²å­æ—¬(ç”²å­-ç™¸é…‰)ï¼šæˆŒäº¥ç©º
         * - ç”²æˆŒæ—¬(ç”²æˆŒ-ç™¸æœª)ï¼šç”³é…‰ç©º
         * - ç”²ç”³æ—¬(ç”²ç”³-ç™¸å·³)ï¼šåˆæœªç©º
         * - ç”²åˆæ—¬(ç”²åˆ-ç™¸å¯)ï¼šè¾°å·³ç©º
         * - ç”²è¾°æ—¬(ç”²è¾°-ç™¸ä¸‘)ï¼šå¯…å¯ç©º
         * - ç”²å¯…æ—¬(ç”²å¯…-ç™¸äº¥)ï¼šå­ä¸‘ç©º
         */
        function calculateKongWang(dayGanzhi) {
            const dayGan = dayGanzhi.charAt(0);
            const dayZhi = dayGanzhi.charAt(1);
            const dayGanIndex = TIANGAN.indexOf(dayGan);
            const dayZhiIndex = DIZHI.indexOf(dayZhi);

            if (dayGanIndex === -1 || dayZhiIndex === -1) {
                return ['æœªçŸ¥', 'æœªçŸ¥'];
            }

            // è®¡ç®—æ—¬é¦–ï¼šæ ¹æ®æ—¥å¹²æ”¯è®¡ç®—å½“å‰æ—¬çš„èµ·å§‹å¹²æ”¯
            // æ¯æ—¬ä»¥ç”²ä¸ºé¦–ï¼Œåå¤©ä¸€ä¸ªå‘¨æœŸ
            // ç”²å­ã€ç”²æˆŒã€ç”²ç”³ã€ç”²åˆã€ç”²è¾°ã€ç”²å¯…ä¸ºå…­ç”²æ—¬é¦–

            // æ—¬çš„åœ°æ”¯åºåˆ—
            const xunTable = [
                { xunShou: 'ç”²å­', kongWang: ['æˆŒ', 'äº¥'] },  // ç”²å­è‡³ç™¸é…‰ï¼ŒæˆŒäº¥ç©º
                { xunShou: 'ç”²æˆŒ', kongWang: ['ç”³', 'é…‰'] },  // ç”²æˆŒè‡³ç™¸æœªï¼Œç”³é…‰ç©º
                { xunShou: 'ç”²ç”³', kongWang: ['åˆ', 'æœª'] },  // ç”²ç”³è‡³ç™¸å·³ï¼Œåˆæœªç©º
                { xunShou: 'ç”²åˆ', kongWang: ['è¾°', 'å·³'] },  // ç”²åˆè‡³ç™¸å¯ï¼Œè¾°å·³ç©º
                { xunShou: 'ç”²è¾°', kongWang: ['å¯…', 'å¯'] },  // ç”²è¾°è‡³ç™¸ä¸‘ï¼Œå¯…å¯ç©º
                { xunShou: 'ç”²å¯…', kongWang: ['å­', 'ä¸‘'] }   // ç”²å¯…è‡³ç™¸äº¥ï¼Œå­ä¸‘ç©º
            ];

            // è®¡ç®—æ‰€å±æ—¬ï¼šæ ¹æ®åœ°æ”¯ç¡®å®šæ—¬é¦–
            // ç®—æ³•ï¼š(åœ°æ”¯ç´¢å¼• - å¤©å¹²ç´¢å¼• + 12) % 12 / 2 å¾—åˆ°æ—¬çš„ç´¢å¼•
            let xunIndex = Math.floor(((dayZhiIndex - dayGanIndex + 12) % 12) / 2);

            // è¾¹ç•Œå¤„ç†
            if (xunIndex < 0) xunIndex = 0;
            if (xunIndex >= 6) xunIndex = 5;

            return xunTable[xunIndex].kongWang;
        }

        // æµ‹è¯•ç©ºäº¡è®¡ç®—å‡†ç¡®æ€§
        function testKongWangCalculation() {
            const testCases = [
                { dayGanzhi: 'ç”²å­', expectedKongWang: ['æˆŒ', 'äº¥'] },
                { dayGanzhi: 'ä¹™ä¸‘', expectedKongWang: ['æˆŒ', 'äº¥'] },
                { dayGanzhi: 'ä¸™å¯…', expectedKongWang: ['æˆŒ', 'äº¥'] },
                { dayGanzhi: 'ç™¸é…‰', expectedKongWang: ['æˆŒ', 'äº¥'] },
                { dayGanzhi: 'ç”²æˆŒ', expectedKongWang: ['ç”³', 'é…‰'] },
                { dayGanzhi: 'ä¹™äº¥', expectedKongWang: ['ç”³', 'é…‰'] },
                { dayGanzhi: 'ç”²ç”³', expectedKongWang: ['åˆ', 'æœª'] },
                { dayGanzhi: 'ç”²åˆ', expectedKongWang: ['è¾°', 'å·³'] },
                { dayGanzhi: 'ç”²è¾°', expectedKongWang: ['å¯…', 'å¯'] },
                { dayGanzhi: 'ç”²å¯…', expectedKongWang: ['å­', 'ä¸‘'] }
            ];

            console.log('=== ç©ºäº¡è®¡ç®—æµ‹è¯•å¼€å§‹ ===');
            let passCount = 0;

            testCases.forEach((testCase, index) => {
                const calculated = calculateKongWang(testCase.dayGanzhi);
                const isPass = calculated[0] === testCase.expectedKongWang[0] &&
                               calculated[1] === testCase.expectedKongWang[1];

                if (isPass) {
                    passCount++;
                    console.log(`âœ… æµ‹è¯•${index + 1}: ${testCase.dayGanzhi} â†’ ç©ºäº¡ ${calculated.join(',')} (æ­£ç¡®)`);
                } else {
                    console.log(`âŒ æµ‹è¯•${index + 1}: ${testCase.dayGanzhi} â†’ ç©ºäº¡ ${calculated.join(',')} (æœŸæœ›: ${testCase.expectedKongWang.join(',')})`);
                }
            });

            console.log(`=== ç©ºäº¡è®¡ç®—æµ‹è¯•å®Œæˆ: ${passCount}/${testCases.length} é€šè¿‡ ===`);
            return passCount === testCases.length;
        }

        // ä¼ç¥è®¡ç®—å‡½æ•°
        function calculateHiddenGods(hexBinary) {
            // ä»HEXAGRAMS_FULL_DATAä¸­æŸ¥æ‰¾å¦è±¡æ•°æ®
            const hexData = HEXAGRAMS_FULL_DATA.find(h => h.binary === hexBinary);
            if (!hexData) {
                return { hiddenGods: [], description: 'æœªæ‰¾åˆ°å¦è±¡æ•°æ®' };
            }

            const hiddenGodRule = hexData.hidden_god_rule;
            const hiddenGods = [];

            if (hiddenGodRule.includes('æ— ä¼')) {
                return { hiddenGods: [], description: hiddenGodRule };
            }

            // è§£æä¼ç¥è§„åˆ™ï¼Œæå–ä¼ç¥ä¿¡æ¯
            const hiddenMatches = hiddenGodRule.match(/ä¼([^ã€ï¼Œ]+)/g);
            if (hiddenMatches) {
                hiddenMatches.forEach(match => {
                    const hiddenGod = match.replace('ä¼', '');
                    if (hiddenGod) {
                        hiddenGods.push(hiddenGod);
                    }
                });
            }

            return {
                hiddenGods: hiddenGods,
                description: hiddenGodRule,
                palace: hexData.palace
            };
        }

        // ç¥ç…è®¡ç®—å‡½æ•°
        function calculateShenSha(dayGan, dayZhi, yearZhi) {
            const shenShaResults = [];

            SHENSHA_DATA.forEach(shensha => {
                let found = false;
                let matchedBranches = [];

                if (shensha.method === 'ä»¥æ—¥å¹²æŸ¥åœ°æ”¯') {
                    // ä»¥æ—¥å¹²æŸ¥åœ°æ”¯çš„ç¥ç…
                    const rule = shensha.rules.find(r => r.day_gan === dayGan);
                    if (rule) {
                        const hexBranches = []; // è¿™é‡Œéœ€è¦ä¼ å…¥å¦ä¸­çš„åœ°æ”¯
                        // ç®€åŒ–å¤„ç†ï¼šæ£€æŸ¥æ—¥æ”¯å’Œå¹´æ”¯
                        const checkBranches = [dayZhi, yearZhi];
                        checkBranches.forEach(branch => {
                            if (rule.branches.includes(branch)) {
                                found = true;
                                matchedBranches.push(branch);
                            }
                        });
                    }
                } else if (shensha.method === 'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯æŸ¥åœ°æ”¯') {
                    // ä»¥å¹´æ”¯æˆ–æ—¥æ”¯æŸ¥åœ°æ”¯çš„ç¥ç…
                    shensha.rules.forEach(rule => {
                        const trunkBranches = rule.trunk.match(/.{1}/g); // æ‹†åˆ†ä¸‰åˆå±€
                        const checkBranches = [yearZhi, dayZhi];

                        checkBranches.forEach(branch => {
                            if (trunkBranches.includes(branch)) {
                                rule.branches.forEach(targetBranch => {
                                    // è¿™é‡Œåº”è¯¥æ£€æŸ¥å¦ä¸­æ˜¯å¦æœ‰ç›®æ ‡åœ°æ”¯
                                    if (targetBranch === dayZhi || targetBranch === yearZhi) {
                                        found = true;
                                        matchedBranches.push(targetBranch);
                                    }
                                });
                            }
                        });
                    });
                }

                if (found) {
                    shenShaResults.push({
                        name: shensha.name,
                        type: shensha.type,
                        description: shensha.description,
                        matchedBranches: matchedBranches,
                        note: shensha.note || ''
                    });
                }
            });

            return shenShaResults;
        }

        // ä½¿ç”¨å®Œæ•´å¯¹ç…§è¡¨æ•°æ®è®¡ç®—å…­äº²ï¼ˆæ›¿æ¢åŸæœ‰ç®€åŒ–ç®—æ³•ï¼‰
        function calculateLiuQinFromFullData(hexBinary) {
            const hexData = HEXAGRAMS_FULL_DATA.find(h => h.binary === hexBinary);
            if (hexData) {
                return {
                    relations: hexData.six_relations,
                    worldLine: hexData.world_line,
                    peerLine: hexData.peer_line,
                    palace: hexData.palace,
                    element: hexData.element
                };
            }
            return null;
        }

        // è·å–é»˜è®¤çº³æ”¯ï¼ˆç®€åŒ–å¤„ç†ï¼‰
        function getDefaultNaZhi(hexBinary, lineIndex) {
            const defaultNaZhi = ['å­', 'å¯…', 'è¾°', 'åˆ', 'ç”³', 'æˆŒ'];
            return defaultNaZhi[lineIndex];
        }

        function getProperNaZhi(hexBinary, tianganIndex) {
            // ç®€åŒ–å¤„ç†ï¼Œè¿”å›å¯¹åº”çš„åœ°æ”¯
            const zhiMap = [0, 2, 4, 6, 8, 10]; // å¯¹åº”å­å¯…è¾°åˆç”³æˆŒ
            return DIZHI[zhiMap[tianganIndex % 6]];
        }

        function getLineName(position) {
            const names = ['åˆ', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'ä¸Š'];
            return names[position - 1];
        }

        // æ¸²æŸ“ä¼ç¥å’Œç¥ç…ä¿¡æ¯
        function renderHiddenGodsAndShenSha(hiddenGodsInfo, shenShaInfo) {
            let html = '';

            // æ˜¾ç¤ºä¼ç¥ä¿¡æ¯
            if (hiddenGodsInfo.hiddenGods.length > 0 || hiddenGodsInfo.description) {
                html += `
                    <div class="detail-card" style="margin-top: 20px;">
                        <div class="detail-title">ä¼ç¥</div>
                        <div class="detail-content">
                            <p><strong>ä¼ç¥è§„åˆ™ï¼š</strong>${hiddenGodsInfo.description}</p>
                            ${hiddenGodsInfo.hiddenGods.length > 0 ?
                                `<p><strong>ä¼ç¥ï¼š</strong>${hiddenGodsInfo.hiddenGods.join('ã€')}</p>` :
                                '<p>æ­¤å¦æ— ä¼ç¥</p>'}
                        </div>
                    </div>
                `;
            }

            // æ˜¾ç¤ºç¥ç…ä¿¡æ¯
            if (shenShaInfo.length > 0) {
                html += `
                    <div class="detail-card" style="margin-top: 20px;">
                        <div class="detail-title">ç¥ç…</div>
                        <div class="detail-content">
                `;

                shenShaInfo.forEach(shensha => {
                    const typeClass = shensha.type === 'è´µäºº' ? 'success-color' :
                                     shensha.type === 'å‡¶ç…' ? 'error-color' : 'text-color';
                    html += `
                        <div style="margin-bottom: 12px; padding: 10px; background: var(--bg-color); border-radius: 6px; border-left: 3px solid var(--${typeClass});">
                            <div style="font-weight: bold; color: var(--${typeClass});">
                                ${shensha.name} (${shensha.type})
                            </div>
                            <div style="font-size: 0.9rem; margin-top: 5px;">
                                ${shensha.description}
                            </div>
                            ${shensha.matchedBranches.length > 0 ?
                                `<div style="font-size: 0.8rem; margin-top: 3px; color: var(--text-secondary);">
                                    è§ï¼š${shensha.matchedBranches.join('ã€')}
                                </div>` : ''}
                            ${shensha.note ?
                                `<div style="font-size: 0.8rem; margin-top: 3px; color: var(--text-secondary); font-style: italic;">
                                    ${shensha.note}
                                </div>` : ''}
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="detail-card" style="margin-top: 20px;">
                        <div class="detail-title">ç¥ç…</div>
                        <div class="detail-content">
                            <p>æš‚æœªå‘ç°ç‰¹æ®Šç¥ç…</p>
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function getMethodName() {
            switch (currentMethod) {
                case 'time': return 'æ—¶é—´èµ·å¦';
                case 'coins': return 'é“œé’±èµ·å¦';
                case 'manual': return 'æ‰‹åŠ¨æŒ‡å®š - ' + getManualMethodName();
                default: return 'æœªçŸ¥æ–¹å¼';
            }
        }

        function getManualMethodName() {
            switch (currentManualMethod) {
                case 'hexname': return 'å¦åé€‰æ‹©';
                case 'numbers': return 'æ•°å­—èµ·å¦';
                case 'binary': return 'äºŒè¿›åˆ¶è¾“å…¥';
                case 'lines': return 'é€çˆ»æŒ‡å®š';
                default: return 'æœªçŸ¥æ–¹å¼';
            }
        }

        // ä¼ ç»Ÿæ•°å­—èµ·å¦ç®—æ³•
        function traditionalNumberDivination(num1, num2) {
            // ä¸Šå¦æ•° = num1 é™¤ä»¥ 8 çš„ä½™æ•°ï¼Œå¦‚æœä½™æ•°ä¸º0åˆ™å–8
            const upperGuaNum = (num1 % 8) || 8;
            // ä¸‹å¦æ•° = num2 é™¤ä»¥ 8 çš„ä½™æ•°ï¼Œå¦‚æœä½™æ•°ä¸º0åˆ™å–8
            const lowerGuaNum = (num2 % 8) || 8;
            // åŠ¨çˆ»ä½ = (num1 + num2) é™¤ä»¥ 6 çš„ä½™æ•°ï¼Œå¦‚æœä½™æ•°ä¸º0åˆ™å–6
            const changingLineNum = ((num1 + num2 - 1) % 6) + 1;

            // æ ¹æ®æ•°æ®åº“ä¸­çš„å¦è±¡å¯¹ç…§ä¿®æ­£å…«å¦äºŒè¿›åˆ¶
            const guaMap = {
                1: '111', // ä¹¾ â˜°
                2: '011', // å…‘ â˜± (ä¿®æ­£)
                3: '101', // ç¦» â˜²
                4: '100', // éœ‡ â˜³
                5: '110', // å·½ â˜´ (ä¿®æ­£)
                6: '010', // å â˜µ
                7: '001', // è‰® â˜¶
                8: '000'  // å¤ â˜·
            };

            const guaNames = {
                1: 'ä¹¾', 2: 'å…‘', 3: 'ç¦»', 4: 'éœ‡',
                5: 'å·½', 6: 'å', 7: 'è‰®', 8: 'å¤'
            };

            const upperGua = guaMap[upperGuaNum]; // ä¸Šå¦åœ¨ä¸Š
            const lowerGua = guaMap[lowerGuaNum]; // ä¸‹å¦åœ¨ä¸‹
            // æ³¨æ„ï¼šå…­çˆ»å¦è±¡çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ä»ä¸Šå¾€ä¸‹ï¼Œæ‰€ä»¥ä¸Šå¦åœ¨å‰ï¼Œä¸‹å¦åœ¨å
            const originalHex = upperGua + lowerGua;

            let changedHex = originalHex;
            let changingLines = [changingLineNum];

            // ç”Ÿæˆå˜å¦ï¼šåŠ¨çˆ»å˜åŒ–
            let changedBinary = originalHex.split('');
            // ä»ä¸Šå¾€ä¸‹è®¡æ•°ï¼šç¬¬1çˆ»åœ¨æœ€ä¸‹é¢ï¼ˆç´¢å¼•5ï¼‰ï¼Œç¬¬6çˆ»åœ¨æœ€ä¸Šé¢ï¼ˆç´¢å¼•0ï¼‰
            const index = 6 - changingLineNum;
            changedBinary[index] = changedBinary[index] === '1' ? '0' : '1';
            changedHex = changedBinary.join('');

            return {
                originalHex,
                changedHex,
                changingLines,
                upperGuaNum,
                lowerGuaNum,
                changingLineNum,
                upperGuaName: guaNames[upperGuaNum],
                lowerGuaName: guaNames[lowerGuaNum]
            };
        }

        // æ•°å­—è½¬å¦è±¡ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
        function numberToHexagram(upperNum, lowerNum, changingLineNum) {
            return traditionalNumberDivination(upperNum, lowerNum);
        }

        // é€çˆ»æŒ‡å®šè½¬å¦è±¡
        function linesToHexagram() {
            let originalBinary = '';
            let changedBinary = '';
            let changingLines = [];

            for (let i = 6; i >= 1; i--) {
                const select = document.querySelector(`.line-input[data-line="${i}"] .line-select`);
                const value = select.value;

                if (!value) {
                    const lineNames = ['', 'åˆ', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'ä¸Š'];
                    throw new Error(`è¯·é€‰æ‹©${lineNames[i]}çˆ»çš„é˜´é˜³å±æ€§ï¼ˆè€é˜³ã€å°‘é˜³ã€å°‘é˜´æˆ–è€é˜´ï¼‰`);
                }

                if (value === 'è€é˜³') {
                    originalBinary += '1';
                    changedBinary += '0';
                    changingLines.push(i);
                } else if (value === 'å°‘é˜³') {
                    originalBinary += '1';
                    changedBinary += '1';
                } else if (value === 'å°‘é˜´') {
                    originalBinary += '0';
                    changedBinary += '0';
                } else if (value === 'è€é˜´') {
                    originalBinary += '0';
                    changedBinary += '1';
                    changingLines.push(i);
                }
            }

            return {
                originalHex: originalBinary,
                changedHex: changedBinary,
                changingLines: changingLines
            };
        }

        // å®æ—¶æ›´æ–°æ•°å­—èµ·å¦çš„è®¡ç®—ç»“æœ
        function updateNumberCalculation() {
            const upperNumber = parseInt(document.getElementById('upper-number').value);
            const lowerNumber = parseInt(document.getElementById('lower-number').value);

            const guaNames = {
                1: 'ä¹¾', 2: 'å…‘', 3: 'ç¦»', 4: 'éœ‡',
                5: 'å·½', 6: 'å', 7: 'è‰®', 8: 'å¤'
            };

            if (upperNumber && lowerNumber && upperNumber > 0 && lowerNumber > 0) {
                const upperGuaNum = (upperNumber % 8) || 8;
                const lowerGuaNum = (lowerNumber % 8) || 8;
                const changingLineNum = ((upperNumber + lowerNumber - 1) % 6) + 1;

                document.getElementById('calc-upper').textContent = `${upperGuaNum} ${guaNames[upperGuaNum]}`;
                document.getElementById('calc-lower').textContent = `${lowerGuaNum} ${guaNames[lowerGuaNum]}`;
                document.getElementById('calc-line').textContent = `ç¬¬${changingLineNum}çˆ»`;

                // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºé¢„æœŸå¦å
                if (upperNumber === 13 && lowerNumber === 34) {
                    console.log('éªŒè¯13,34æ¡ˆä¾‹ï¼š');
                    console.log('ä¸Šå¦ï¼š', upperGuaNum, guaNames[upperGuaNum], '(å·½)');
                    console.log('ä¸‹å¦ï¼š', lowerGuaNum, guaNames[lowerGuaNum], '(å…‘)');
                    console.log('åŠ¨çˆ»ï¼š', changingLineNum, 'çˆ»');
                    console.log('é¢„æœŸï¼šé£æ³½ä¸­å­šä¹‹å±±æ³½æŸ');
                }
            } else {
                document.getElementById('calc-upper').textContent = '-';
                document.getElementById('calc-lower').textContent = '-';
                document.getElementById('calc-line').textContent = '-';
            }
        }

        // AIå¦è±¡æ¨ç†åŠŸèƒ½
        async function performAIReasoning(hexagramData) {
            const aiDefaultContent = document.getElementById('ai-default-content');
            const aiResultContent = document.getElementById('ai-result-content');
            const aiAnalysisResult = document.getElementById('ai-analysis-result');

            // éšè—é»˜è®¤å†…å®¹ï¼Œæ˜¾ç¤ºç»“æœåŒºåŸŸ
            aiDefaultContent.style.display = 'none';
            aiResultContent.style.display = 'block';

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            aiAnalysisResult.innerHTML = `
                <div class="ai-loading">
                    <p>ğŸ¤– AIæ­£åœ¨åˆ†æå¦è±¡ï¼Œè¯·ç¨å€™...</p>
                </div>
            `;

            try {
                // æ„å»ºAIæç¤ºè¯
                const prompt = buildAIPrompt(hexagramData);

                // æ¨¡æ‹ŸAIåˆ†æï¼ˆå®é™…é¡¹ç›®ä¸­åº”è°ƒç”¨çœŸå®çš„å¼€æºLLM APIï¼‰
                const analysis = await simulateAIAnalysis(prompt, hexagramData);

                // æ˜¾ç¤ºåˆ†æç»“æœ
                aiAnalysisResult.innerHTML = `
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">ğŸ“Š å¦è±¡åˆ†æç»“æœ</h4>
                    <div style="white-space: pre-wrap; line-height: 1.8;">${analysis}</div>
                    <div style="margin-top: 20px; padding: 15px; background: var(--bg-color); border-radius: 6px; font-size: 0.9rem; color: var(--secondary-color);">
                        <p><strong>æ³¨æ„ï¼š</strong>ä»¥ä¸Šåˆ†æåŸºäºä¼ ç»Ÿå…­çˆ»ç†è®ºï¼Œä»…ä¾›å‚è€ƒã€‚å®é™…åº”ç”¨éœ€ç»“åˆå…·ä½“æƒ…å†µå’Œä¸ªäººç»éªŒåˆ¤æ–­ã€‚</p>
                    </div>
                `;

            } catch (error) {
                aiAnalysisResult.innerHTML = `
                    <div style="color: var(--error-color); padding: 20px; text-align: center;">
                        <p>âŒ AIåˆ†ææš‚æ—¶ä¸å¯ç”¨</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">è¯·ç¨åå†è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ</p>
                    </div>
                `;
            }
        }

        // æ„å»ºAIåˆ†ææç¤ºè¯
        function buildAIPrompt(hexagramData) {
            const { originalHex, changedHex, changingLines, question, date, time } = hexagramData;
            const originalHexInfo = HEXAGRAMS[originalHex];
            const changedHexInfo = HEXAGRAMS[changedHex];

            return `è¯·ä½œä¸ºä¸“ä¸šçš„å…­çˆ»åˆ†æå¸ˆï¼ŒåŸºäºã€Šå¢åˆ è¡¥æ˜“ã€‹ç†è®ºï¼Œåˆ†æä»¥ä¸‹å¦è±¡ï¼š

å åœä¿¡æ¯ï¼š
- æ‰€é—®ä¹‹äº‹ï¼š${question || 'æœªå¡«å†™'}
- èµ·å¦æ—¶é—´ï¼š${date} ${time}
- æœ¬å¦ï¼š${originalHexInfo.name}
- å˜å¦ï¼š${changedHex !== originalHex ? changedHexInfo.name : 'æ— å˜å¦ï¼ˆé™å¦ï¼‰'}
- åŠ¨çˆ»ï¼š${changingLines.length > 0 ? changingLines.map(l => `ç¬¬${l}çˆ»`).join('ã€') : 'æ— åŠ¨çˆ»'}

è¯·ä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œä¸“ä¸šåˆ†æï¼š
1. å¦è±¡åŸºæœ¬å«ä¹‰å’Œè±¡å¾
2. ä¸–åº”å…³ç³»åˆ†æ
3. ç”¨ç¥å–è±¡å’Œæ—ºè¡°
4. åŠ¨çˆ»å¯¹å¦è±¡çš„å½±å“
5. ç»¼åˆåˆ¤æ–­å’Œå»ºè®®

è¯·ç”¨ä¸“ä¸šè€Œæ˜“æ‡‚çš„è¯­è¨€ï¼Œç»™å‡ºè¯¦ç»†çš„åˆ†æç»“æœã€‚`;
        }

        // æ¨¡æ‹ŸAIåˆ†æï¼ˆå®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºçœŸå®APIè°ƒç”¨ï¼‰
        async function simulateAIAnalysis(prompt, hexagramData) {
            // æ¨¡æ‹ŸAPIå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 2000));

            const { originalHex, changedHex, changingLines } = hexagramData;
            const originalHexInfo = HEXAGRAMS[originalHex];
            const changedHexInfo = HEXAGRAMS[changedHex];

            // åŸºäºå¦è±¡ç‰¹å¾ç”Ÿæˆåˆ†æå†…å®¹
            let analysis = `ğŸ“ˆ **å¦è±¡åŸºæœ¬åˆ†æ**\n`;
            analysis += `æœ¬å¦"${originalHexInfo.name}"å±äº${originalHexInfo.palace}å®«ï¼Œä»£è¡¨${getGuaBasicMeaning(originalHex)}ã€‚\n\n`;

            if (changedHex !== originalHex) {
                analysis += `ğŸ”„ **å˜å¦åˆ†æ**\n`;
                analysis += `å˜å¦"${changedHexInfo.name}"æ˜¾ç¤ºäº‹æ€çš„å‘å±•è¶‹åŠ¿ï¼Œæš—ç¤º${getGuaBasicMeaning(changedHex)}ã€‚\n\n`;
            }

            if (changingLines.length > 0) {
                analysis += `âš¡ **åŠ¨çˆ»åˆ†æ**\n`;
                analysis += `åŠ¨çˆ»ä½äº${changingLines.map(l => getLineName(l)).join('ã€')}ï¼Œè¡¨æ˜${analyzeDongYao(changingLines)}ã€‚\n\n`;
            }

            analysis += `ğŸ¯ **ä¸–åº”å…³ç³»**\n`;
            analysis += `ä¸–çˆ»ä½äºç¬¬${originalHexInfo.shiYing[0]}çˆ»ï¼Œåº”çˆ»ä½äºç¬¬${originalHexInfo.shiYing[1]}çˆ»ï¼Œ${analyzeShiYing(originalHexInfo.shiYing)}ã€‚\n\n`;

            analysis += `ğŸ’¡ **ç»¼åˆå»ºè®®**\n`;
            analysis += generateAdvice(originalHex, changedHex, changingLines);

            return analysis;
        }

        // è·å–å¦è±¡åŸºæœ¬å«ä¹‰
        function getGuaBasicMeaning(hexBinary) {
            const hexInfo = HEXAGRAMS[hexBinary];
            const meanings = {
                'ä¹¾ä¸ºå¤©': 'åˆšå¥æœ‰åŠ›ï¼Œä¸»åŠ¨è¿›å–ï¼Œå®œç§¯æè¡ŒåŠ¨',
                'å¤ä¸ºåœ°': 'æŸ”é¡ºæ‰¿è½½ï¼Œç¨³é‡è¸å®ï¼Œå®œé¡ºåŠ¿è€Œä¸º',
                'æ°´é›·å±¯': 'åˆç”Ÿå›°éš¾ï¼Œç§¯è“„åŠ›é‡ï¼Œå®œå®ˆä¸å®œåŠ¨',
                'å±±æ°´è’™': 'å¯è’™å­¦ä¹ ï¼Œéœ€è¦æŒ‡å¯¼ï¼Œå®œè™šå¿ƒæ±‚æ•™'
                // å¯æ‰©å±•æ›´å¤šå¦è±¡å«ä¹‰
            };
            return meanings[hexInfo.name] || 'éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µåˆ†æ';
        }

        // åˆ†æåŠ¨çˆ»
        function analyzeDongYao(changingLines) {
            if (changingLines.length === 1) {
                return 'å•çˆ»å‘åŠ¨ï¼Œå˜åŒ–æ˜ç¡®ï¼Œä¸»è¦çœ‹åŠ¨çˆ»çš„æ—ºè¡°å’Œæ‰€ä»£è¡¨çš„äººäº‹ç‰©';
            } else if (changingLines.length === 2) {
                return 'ä¸¤çˆ»å‘åŠ¨ï¼Œå˜åŒ–å¤æ‚ï¼Œéœ€è¦ç»¼åˆåˆ†æä¸¤çˆ»çš„å…³ç³»';
            } else if (changingLines.length >= 3) {
                return 'å¤šçˆ»å‘åŠ¨ï¼Œå˜åŒ–æ¿€çƒˆï¼Œäº‹æ€å¤æ‚å¤šå˜';
            }
            return 'é™å¦æ— åŠ¨çˆ»ï¼Œçœ‹ä¸–åº”æ—ºè¡°å³å¯';
        }

        // åˆ†æä¸–åº”å…³ç³»
        function analyzeShiYing(shiYing) {
            const worldLine = shiYing[0];
            const responseLine = shiYing[1];
            const distance = Math.abs(worldLine - responseLine);

            if (distance === 3) {
                return 'ä¸–åº”ç›¸å†²ï¼Œå…³ç³»ç´§å¼ ï¼Œéœ€è¦è°ƒå’Œ';
            } else if (distance === 1) {
                return 'ä¸–åº”ç›¸é‚»ï¼Œå…³ç³»å¯†åˆ‡ï¼Œå®¹æ˜“æ²Ÿé€š';
            } else {
                return 'ä¸–åº”å…³ç³»é€‚ä¸­ï¼Œéœ€çœ‹å…·ä½“æ—ºè¡°';
            }
        }

        // ç”Ÿæˆç»¼åˆå»ºè®®
        function generateAdvice(originalHex, changedHex, changingLines) {
            let advice = '';
            const originalInfo = HEXAGRAMS[originalHex];

            if (changingLines.length === 0) {
                advice = 'é™å¦æ— å˜ï¼Œå½“å‰çŠ¶æ€ç›¸å¯¹ç¨³å®šï¼Œå®œä¿æŒç°çŠ¶ï¼Œè€å¿ƒç­‰å¾…æ—¶æœºã€‚';
            } else if (changingLines.length === 1) {
                advice = 'å•çˆ»å‘åŠ¨ï¼Œå˜åŒ–æœ‰åºï¼Œå¯ä»¥é€‚å½“è°ƒæ•´ç­–ç•¥ï¼ŒæŠŠæ¡å˜åŒ–å¥‘æœºã€‚';
            } else {
                advice = 'å¤šçˆ»å‘åŠ¨ï¼Œå˜åŒ–æ¿€çƒˆï¼Œå®œè°¨æ…è¡Œäº‹ï¼Œé¿å…å†²åŠ¨å†³ç­–ã€‚';
            }

            // æ ¹æ®å¦å®«ç»™å‡ºé’ˆå¯¹æ€§å»ºè®®
            switch(originalInfo.palace) {
                case 'ä¹¾':
                    advice += 'ä¹¾å®«ä¹‹å¦ï¼Œå®œç§¯æä¸»åŠ¨ï¼Œå‘æŒ¥é¢†å¯¼æ‰èƒ½ã€‚';
                    break;
                case 'å¤':
                    advice += 'å¤å®«ä¹‹å¦ï¼Œå®œæŸ”é¡ºé…åˆï¼Œåšå¾·è½½ç‰©ã€‚';
                    break;
                case 'éœ‡':
                    advice += 'éœ‡å®«ä¹‹å¦ï¼Œå®œåŠ¨ä¸­æ±‚é™ï¼ŒæŠŠæ¡æ—¶æœºã€‚';
                    break;
                case 'å·½':
                    advice += 'å·½å®«ä¹‹å¦ï¼Œå®œçµæ´»å˜é€šï¼Œé¡ºåŠ¿è€Œä¸ºã€‚';
                    break;
                default:
                    advice += 'éœ€è¦ç»“åˆå…·ä½“æƒ…å†µï¼Œç»¼åˆåˆ¤æ–­å‰å‡¶ã€‚';
            }

            return advice;
        }
    </script>
</body>
</html>