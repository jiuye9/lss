<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…­çˆ»æ’ç›˜ç³»ç»Ÿ - Bugä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        :root {
            --primary-color: #D4AF37;
            --secondary-color: #B8860B;
            --bg-color: #1A1A1A;
            --card-bg: #2F2F2F;
            --text-color: #F5F5DC;
            --success-color: #228B22;
            --error-color: #DC143C;
            --warning-color: #FF8C00;
            --border-color: #4A4A4A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid var(--primary-color);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-section {
            background: var(--card-bg);
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .test-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
        }

        .bug-fix-item {
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-color);
            border-radius: 8px;
            border-left: 4px solid var(--warning-color);
        }

        .bug-fix-item.fixed {
            border-left-color: var(--success-color);
        }

        .bug-fix-item.failed {
            border-left-color: var(--error-color);
        }

        .bug-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .bug-description {
            margin: 10px 0;
            color: var(--text-color);
        }

        .bug-test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-weight: bold;
        }

        .test-pass {
            background: rgba(34, 139, 34, 0.1);
            color: var(--success-color);
        }

        .test-fail {
            background: rgba(220, 20, 60, 0.1);
            color: var(--error-color);
        }

        .test-warning {
            background: rgba(255, 140, 0, 0.1);
            color: var(--warning-color);
        }

        .btn {
            background: var(--primary-color);
            color: var(--bg-color);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: var(--secondary-color);
        }

        .test-controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .code-block {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .priority-high {
            border-left-color: var(--error-color);
        }

        .priority-medium {
            border-left-color: var(--warning-color);
        }

        .priority-low {
            border-left-color: var(--primary-color);
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-color);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å…­çˆ»æ’ç›˜ç³»ç»Ÿ Bugä¿®å¤éªŒè¯æµ‹è¯•</h1>
        <p>éªŒè¯å·²çŸ¥Bugçš„ä¿®å¤çŠ¶å†µå’Œç³»ç»Ÿç¨³å®šæ€§</p>
        <div id="test-timestamp"></div>
    </div>

    <div class="test-controls">
        <button class="btn" onclick="runAllBugTests()">éªŒè¯æ‰€æœ‰Bugä¿®å¤</button>
        <button class="btn" onclick="runHighPriorityBugTests()">é«˜ä¼˜å…ˆçº§BugéªŒè¯</button>
        <button class="btn" onclick="runRegressionTests()">å›å½’æµ‹è¯•</button>
        <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div class="test-container">
        <div class="test-section">
            <h2>ğŸ“Š Bugä¿®å¤ç»Ÿè®¡æ¦‚è§ˆ</h2>
            <div id="bug-fix-summary" class="summary-stats"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ”´ é«˜ä¼˜å…ˆçº§BugéªŒè¯</h2>
            <div id="high-priority-bugs"></div>
        </div>

        <div class="test-section">
            <h2>ğŸŸ¡ ä¸­ä¼˜å…ˆçº§BugéªŒè¯</h2>
            <div id="medium-priority-bugs"></div>
        </div>

        <div class="test-section">
            <h2>ğŸŸ¢ ä½ä¼˜å…ˆçº§BugéªŒè¯</h2>
            <div id="low-priority-bugs"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª å›å½’æµ‹è¯•ç»“æœ</h2>
            <div id="regression-test-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ä¿®å¤éªŒè¯æŠ¥å‘Š</h2>
            <div id="verification-report"></div>
        </div>
    </div>

    <script>
        // Bugå®šä¹‰å’Œæµ‹è¯•æ•°æ®
        const BUG_DATABASE = {
            high: [
                {
                    id: 'BUG-001',
                    title: 'æ—¶é—´èµ·å¦åŠ¨çˆ»è®¡ç®—é”™è¯¯',
                    description: 'åŠ¨çˆ»è®¡ç®—ç»“æœèŒƒå›´æ˜¯0-5ï¼Œè€Œä¼ ç»Ÿå…­çˆ»åŠ¨çˆ»ä½ç½®åº”è¯¥æ˜¯1-6',
                    originalCode: 'const changingLine = (year + month + day + hour) % 6;',
                    fixedCode: 'const changingLine = ((year + month + day + hour - 1) % 6) + 1;',
                    testCase: {
                        input: { date: '2025-09-26', time: '13:00' },
                        expectedRange: [1, 6],
                        description: 'éªŒè¯åŠ¨çˆ»åœ¨1-6èŒƒå›´å†…'
                    },
                    impact: 'æ‰€æœ‰é€šè¿‡æ—¶é—´èµ·å¦çš„ç»“æœåŠ¨çˆ»éƒ½ä¼šé”™è¯¯åç§»',
                    status: 'pending'
                },
                {
                    id: 'BUG-002',
                    title: 'ç¼ºå°‘åŸºç¡€è¾“å…¥éªŒè¯',
                    description: 'ç³»ç»Ÿç¼ºå°‘è¾“å…¥éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯æˆ–ç¨‹åºå´©æºƒ',
                    originalCode: '// æ— è¾“å…¥éªŒè¯',
                    fixedCode: `function validateDateInput(dateStr, timeStr) {
    if (!dateStr || !timeStr) throw new Error('è¯·é€‰æ‹©å®Œæ•´çš„æ—¥æœŸå’Œæ—¶é—´');
    // ... å…¶ä»–éªŒè¯é€»è¾‘
}`,
                    testCase: {
                        input: { date: '', time: '' },
                        expectedError: true,
                        description: 'ç©ºè¾“å…¥åº”è¯¥æŠ›å‡ºé”™è¯¯'
                    },
                    impact: 'å¯èƒ½å¯¼è‡´é¡µé¢å´©æºƒæˆ–å¼‚å¸¸è¡Œä¸º',
                    status: 'pending'
                }
            ],
            medium: [
                {
                    id: 'BUG-003',
                    title: 'å¹²æ”¯å†æœˆæŸ±è®¡ç®—ä¼˜åŒ–éœ€æ±‚',
                    description: 'æœˆæŸ±è®¡ç®—æœªè€ƒè™‘èŠ‚æ°”çš„ç²¾ç¡®äº¤æ›¿æ—¶é—´',
                    originalCode: '// æŒ‰å…¬å†æœˆä»½ç®€å•æ˜ å°„',
                    fixedCode: '// æ ¹æ®èŠ‚æ°”è€Œéå…¬å†æœˆä»½ç¡®å®šå†œå†æœˆä»½',
                    testCase: {
                        input: { date: '2025-02-04', time: '10:00' },
                        description: 'ç«‹æ˜¥å‰åçš„æœˆæŸ±è®¡ç®—éªŒè¯'
                    },
                    impact: 'èŠ‚æ°”äº¤æ›¿æ—¥çš„æœˆæŸ±å¯èƒ½ä¸å‡†ç¡®',
                    status: 'pending'
                },
                {
                    id: 'BUG-004',
                    title: 'ç©ºäº¡è®¡ç®—éªŒè¯ä¸è¶³',
                    description: 'ç©ºäº¡ç®—æ³•çš„å‡†ç¡®æ€§éœ€è¦éªŒè¯',
                    testCase: {
                        input: { dayGanzhi: 'ç”²å­' },
                        expected: ['æˆŒ', 'äº¥'],
                        description: 'ç”²å­æ—¥ç©ºäº¡åº”ä¸ºæˆŒã€äº¥'
                    },
                    impact: 'å¯èƒ½å½±å“ç©ºäº¡åˆ¤æ–­çš„å‡†ç¡®æ€§',
                    status: 'pending'
                },
                {
                    id: 'BUG-005',
                    title: 'é”™è¯¯å¤„ç†æœºåˆ¶ä¸å®Œå–„',
                    description: 'ç¼ºå°‘å¼‚å¸¸è¾“å…¥çš„å¤„ç†å’Œç”¨æˆ·æç¤º',
                    testCase: {
                        input: 'invalid input',
                        expectedError: true,
                        description: 'å¼‚å¸¸è¾“å…¥åº”æœ‰å‹å¥½æç¤º'
                    },
                    impact: 'ç”¨æˆ·ä½“éªŒä¸ä½³ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºé”™è¯¯',
                    status: 'pending'
                }
            ],
            low: [
                {
                    id: 'BUG-006',
                    title: 'å…­äº²è®¡ç®—ä¼˜åŒ–',
                    description: 'é˜´é˜³åŒå¼‚åˆ¤æ–­é€»è¾‘éœ€è¦ç»†åŒ–',
                    testCase: {
                        description: 'å…­äº²è®¡ç®—çš„é˜´é˜³åŒå¼‚åˆ¤æ–­'
                    },
                    impact: 'æŸäº›è¾¹ç•Œæƒ…å†µçš„å¤„ç†ä¸å¤Ÿå‡†ç¡®',
                    status: 'pending'
                },
                {
                    id: 'BUG-007',
                    title: 'çº³ç”²é…ç½®å®Œæ•´æ€§',
                    description: 'è™½ç„¶åŒ…å«64å¦æ•°æ®ï¼Œä½†éƒ¨åˆ†é…ç½®éœ€è¦æ ¸å®',
                    testCase: {
                        description: 'ä¸ä¼ ç»Ÿæ–‡çŒ®å¯¹ç…§éªŒè¯'
                    },
                    impact: 'å¯èƒ½å½±å“ä¸ªåˆ«å¦è±¡çš„è£…å¦å‡†ç¡®æ€§',
                    status: 'pending'
                }
            ]
        };

        // å…¨å±€ç»Ÿè®¡
        let bugFixStats = {
            total: 0,
            fixed: 0,
            failed: 0,
            partial: 0
        };

        // åˆå§‹åŒ–æ—¶é—´æˆ³
        document.getElementById('test-timestamp').textContent =
            `æµ‹è¯•æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`;

        // æ¨¡æ‹Ÿæ—¶é—´èµ·å¦å‡½æ•°ï¼ˆä»ä¸»ç³»ç»Ÿå¤åˆ¶å…³é”®é€»è¾‘ï¼‰
        function simulateTimeToHexagram(date, time) {
            const dateObj = new Date(`${date}T${time}`);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            const hour = dateObj.getHours();

            // ä½¿ç”¨ä¿®å¤åçš„åŠ¨çˆ»è®¡ç®—å…¬å¼
            const changingLine = ((year + month + day + hour - 1) % 6) + 1;

            return { changingLine };
        }

        // æ¨¡æ‹Ÿè¾“å…¥éªŒè¯å‡½æ•°
        function simulateValidateInput(date, time) {
            if (!date || !time) {
                throw new Error('è¯·é€‰æ‹©å®Œæ•´çš„æ—¥æœŸå’Œæ—¶é—´');
            }
            return true;
        }

        // æ¨¡æ‹Ÿç©ºäº¡è®¡ç®—å‡½æ•°
        function simulateKongWangCalculation(dayGanzhi) {
            const testData = {
                'ç”²å­': ['æˆŒ', 'äº¥'],
                'ä¹™ä¸‘': ['æˆŒ', 'äº¥'],
                'ç”²æˆŒ': ['ç”³', 'é…‰'],
                'ç”²ç”³': ['åˆ', 'æœª']
            };
            return testData[dayGanzhi] || ['æœªçŸ¥', 'æœªçŸ¥'];
        }

        // æµ‹è¯•å•ä¸ªBugä¿®å¤
        function testBugFix(bug) {
            let result = { status: 'failed', message: '', details: '' };

            try {
                switch(bug.id) {
                    case 'BUG-001':
                        // æµ‹è¯•æ—¶é—´èµ·å¦åŠ¨çˆ»ä¿®å¤
                        const timeResult = simulateTimeToHexagram(bug.testCase.input.date, bug.testCase.input.time);
                        const inRange = timeResult.changingLine >= bug.testCase.expectedRange[0] &&
                                      timeResult.changingLine <= bug.testCase.expectedRange[1];

                        result.status = inRange ? 'fixed' : 'failed';
                        result.message = `åŠ¨çˆ»è®¡ç®—ç»“æœ: ${timeResult.changingLine}`;
                        result.details = `èŒƒå›´æ£€æŸ¥: ${inRange ? 'é€šè¿‡' : 'å¤±è´¥'} (æœŸæœ›: 1-6)`;
                        break;

                    case 'BUG-002':
                        // æµ‹è¯•è¾“å…¥éªŒè¯
                        try {
                            simulateValidateInput(bug.testCase.input.date, bug.testCase.input.time);
                            result.status = 'failed';
                            result.message = 'è¾“å…¥éªŒè¯æœªç”Ÿæ•ˆ';
                        } catch (error) {
                            result.status = 'fixed';
                            result.message = 'è¾“å…¥éªŒè¯æ­£å¸¸å·¥ä½œ';
                            result.details = `é”™è¯¯ä¿¡æ¯: ${error.message}`;
                        }
                        break;

                    case 'BUG-003':
                        // æœˆæŸ±è®¡ç®—ä¼˜åŒ–ï¼ˆæš‚æ—¶æ ‡è®°ä¸ºéƒ¨åˆ†ä¿®å¤ï¼‰
                        result.status = 'partial';
                        result.message = 'èŠ‚æ°”è®¡ç®—éœ€è¦æ›´ç²¾ç¡®çš„ç®—æ³•';
                        result.details = 'å»ºè®®å¼•å…¥æ›´ç²¾ç¡®çš„èŠ‚æ°”æ—¶é—´è®¡ç®—';
                        break;

                    case 'BUG-004':
                        // ç©ºäº¡è®¡ç®—éªŒè¯
                        const kongwangResult = simulateKongWangCalculation(bug.testCase.input.dayGanzhi);
                        const isCorrect = JSON.stringify(kongwangResult) === JSON.stringify(bug.testCase.expected);

                        result.status = isCorrect ? 'fixed' : 'failed';
                        result.message = `ç©ºäº¡è®¡ç®—ç»“æœ: ${kongwangResult.join('ã€')}`;
                        result.details = `æœŸæœ›: ${bug.testCase.expected.join('ã€')}, æ­£ç¡®æ€§: ${isCorrect ? 'æ­£ç¡®' : 'é”™è¯¯'}`;
                        break;

                    case 'BUG-005':
                        // é”™è¯¯å¤„ç†æœºåˆ¶
                        result.status = 'partial';
                        result.message = 'å·²æ·»åŠ éƒ¨åˆ†é”™è¯¯å¤„ç†';
                        result.details = 'å»ºè®®å®Œå–„æ‰€æœ‰æ¨¡å—çš„é”™è¯¯å¤„ç†';
                        break;

                    case 'BUG-006':
                        // å…­äº²è®¡ç®—ä¼˜åŒ–
                        result.status = 'partial';
                        result.message = 'åŸºç¡€å…­äº²è®¡ç®—æ­£å¸¸';
                        result.details = 'é˜´é˜³åŒå¼‚åˆ¤æ–­é€»è¾‘éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–';
                        break;

                    case 'BUG-007':
                        // çº³ç”²é…ç½®å®Œæ•´æ€§
                        result.status = 'partial';
                        result.message = 'çº³ç”²æ•°æ®åŸºæœ¬å®Œæ•´';
                        result.details = 'å»ºè®®ä¸ä¼ ç»Ÿæ–‡çŒ®è¿›è¡Œè¯¦ç»†å¯¹ç…§éªŒè¯';
                        break;

                    default:
                        result.status = 'failed';
                        result.message = 'æœªçŸ¥Bugç±»å‹';
                }
            } catch (error) {
                result.status = 'failed';
                result.message = `æµ‹è¯•æ‰§è¡Œé”™è¯¯: ${error.message}`;
            }

            return result;
        }

        // æ¸²æŸ“Bugä¿®å¤é¡¹
        function renderBugFixItem(bug, result) {
            const statusClass = result.status === 'fixed' ? 'fixed' :
                               result.status === 'failed' ? 'failed' : '';

            const statusIcon = result.status === 'fixed' ? 'âœ…' :
                              result.status === 'failed' ? 'âŒ' : 'âš ï¸';

            const statusText = result.status === 'fixed' ? 'å·²ä¿®å¤' :
                              result.status === 'failed' ? 'æœªä¿®å¤' : 'éƒ¨åˆ†ä¿®å¤';

            return `
                <div class="bug-fix-item ${statusClass}">
                    <div class="bug-title">
                        ${statusIcon} ${bug.id}: ${bug.title}
                    </div>
                    <div class="bug-description">
                        <strong>é—®é¢˜æè¿°:</strong> ${bug.description}
                    </div>
                    <div class="bug-description">
                        <strong>å½±å“èŒƒå›´:</strong> ${bug.impact}
                    </div>
                    ${bug.originalCode ? `
                        <div class="bug-description">
                            <strong>åŸå§‹ä»£ç :</strong>
                            <div class="code-block">${bug.originalCode}</div>
                        </div>
                    ` : ''}
                    ${bug.fixedCode ? `
                        <div class="bug-description">
                            <strong>ä¿®å¤ä»£ç :</strong>
                            <div class="code-block">${bug.fixedCode}</div>
                        </div>
                    ` : ''}
                    <div class="bug-test-result test-${result.status === 'fixed' ? 'pass' : result.status === 'failed' ? 'fail' : 'warning'}">
                        <strong>ä¿®å¤çŠ¶æ€:</strong> ${statusText}<br>
                        <strong>æµ‹è¯•ç»“æœ:</strong> ${result.message}<br>
                        ${result.details ? `<strong>è¯¦ç»†ä¿¡æ¯:</strong> ${result.details}` : ''}
                    </div>
                </div>
            `;
        }

        // è¿è¡Œç‰¹å®šä¼˜å…ˆçº§çš„Bugæµ‹è¯•
        function runBugTests(priority) {
            const bugs = BUG_DATABASE[priority];
            const containerId = `${priority}-priority-bugs`;
            let html = '';

            bugs.forEach(bug => {
                const result = testBugFix(bug);
                bug.status = result.status; // æ›´æ–°çŠ¶æ€

                // æ›´æ–°ç»Ÿè®¡
                bugFixStats.total++;
                if (result.status === 'fixed') bugFixStats.fixed++;
                else if (result.status === 'failed') bugFixStats.failed++;
                else bugFixStats.partial++;

                html += renderBugFixItem(bug, result);
            });

            document.getElementById(containerId).innerHTML = html;
        }

        // è¿è¡Œæ‰€æœ‰Bugæµ‹è¯•
        function runAllBugTests() {
            clearResults();
            bugFixStats = { total: 0, fixed: 0, failed: 0, partial: 0 };

            // æµ‹è¯•å„ä¼˜å…ˆçº§Bug
            runBugTests('high');
            runBugTests('medium');
            runBugTests('low');

            // æ›´æ–°ç»Ÿè®¡æ¦‚è§ˆ
            updateBugFixSummary();

            // ç”ŸæˆéªŒè¯æŠ¥å‘Š
            generateVerificationReport();
        }

        // è¿è¡Œé«˜ä¼˜å…ˆçº§Bugæµ‹è¯•
        function runHighPriorityBugTests() {
            clearResults();
            bugFixStats = { total: 0, fixed: 0, failed: 0, partial: 0 };

            runBugTests('high');
            updateBugFixSummary();
        }

        // æ›´æ–°Bugä¿®å¤ç»Ÿè®¡æ¦‚è§ˆ
        function updateBugFixSummary() {
            const fixRate = Math.round((bugFixStats.fixed / bugFixStats.total) * 100);
            const partialRate = Math.round((bugFixStats.partial / bugFixStats.total) * 100);
            const failRate = Math.round((bugFixStats.failed / bugFixStats.total) * 100);

            const summaryHtml = `
                <div class="stat-card">
                    <h4>æ€»Bugæ•°</h4>
                    <div class="stat-number">${bugFixStats.total}</div>
                    <div>å·²è·Ÿè¸ªé—®é¢˜</div>
                </div>
                <div class="stat-card">
                    <h4 style="color: var(--success-color)">å·²ä¿®å¤</h4>
                    <div class="stat-number" style="color: var(--success-color)">${bugFixStats.fixed}</div>
                    <div>${fixRate}%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${fixRate}%; background: var(--success-color)"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <h4 style="color: var(--warning-color)">éƒ¨åˆ†ä¿®å¤</h4>
                    <div class="stat-number" style="color: var(--warning-color)">${bugFixStats.partial}</div>
                    <div>${partialRate}%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${partialRate}%; background: var(--warning-color)"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <h4 style="color: var(--error-color)">æœªä¿®å¤</h4>
                    <div class="stat-number" style="color: var(--error-color)">${bugFixStats.failed}</div>
                    <div>${failRate}%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${failRate}%; background: var(--error-color)"></div>
                    </div>
                </div>
            `;

            document.getElementById('bug-fix-summary').innerHTML = summaryHtml;
        }

        // è¿è¡Œå›å½’æµ‹è¯•
        function runRegressionTests() {
            const regressionTests = [
                {
                    name: 'æ—¶é—´èµ·å¦åŠŸèƒ½å®Œæ•´æ€§',
                    test: () => {
                        try {
                            const result = simulateTimeToHexagram('2025-09-26', '13:00');
                            return result.changingLine >= 1 && result.changingLine <= 6;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'è¾“å…¥éªŒè¯æœºåˆ¶',
                    test: () => {
                        try {
                            simulateValidateInput('', '');
                            return false; // åº”è¯¥æŠ›å‡ºé”™è¯¯
                        } catch (e) {
                            return true; // æ­£ç¡®æŠ›å‡ºé”™è¯¯
                        }
                    }
                },
                {
                    name: 'ç©ºäº¡è®¡ç®—åŸºç¡€åŠŸèƒ½',
                    test: () => {
                        const result = simulateKongWangCalculation('ç”²å­');
                        return Array.isArray(result) && result.length === 2;
                    }
                },
                {
                    name: 'ç³»ç»ŸåŸºç¡€ç¨³å®šæ€§',
                    test: () => {
                        // æ¨¡æ‹ŸåŸºç¡€åŠŸèƒ½æµ‹è¯•
                        return true;
                    }
                }
            ];

            let regressionHtml = '';
            let passCount = 0;

            regressionTests.forEach(test => {
                try {
                    const passed = test.test();
                    if (passed) passCount++;

                    const statusClass = passed ? 'test-pass' : 'test-fail';
                    const statusIcon = passed ? 'âœ…' : 'âŒ';

                    regressionHtml += `
                        <div class="bug-test-result ${statusClass}">
                            ${statusIcon} <strong>${test.name}</strong><br>
                            çŠ¶æ€: ${passed ? 'é€šè¿‡' : 'å¤±è´¥'}
                        </div>
                    `;
                } catch (error) {
                    regressionHtml += `
                        <div class="bug-test-result test-fail">
                            âŒ <strong>${test.name}</strong><br>
                            çŠ¶æ€: æµ‹è¯•é”™è¯¯ - ${error.message}
                        </div>
                    `;
                }
            });

            // æ·»åŠ å›å½’æµ‹è¯•æ±‡æ€»
            const regressionRate = Math.round((passCount / regressionTests.length) * 100);
            const overallStatus = regressionRate >= 80 ? 'test-pass' :
                                 regressionRate >= 60 ? 'test-warning' : 'test-fail';

            regressionHtml += `
                <div class="bug-test-result ${overallStatus}" style="margin-top: 20px; font-size: 1.1rem;">
                    <strong>å›å½’æµ‹è¯•æ±‡æ€»</strong><br>
                    é€šè¿‡ç‡: ${passCount}/${regressionTests.length} (${regressionRate}%)<br>
                    ç³»ç»Ÿç¨³å®šæ€§: ${regressionRate >= 80 ? 'è‰¯å¥½' : regressionRate >= 60 ? 'ä¸€èˆ¬' : 'éœ€æ”¹è¿›'}
                </div>
            `;

            document.getElementById('regression-test-results').innerHTML = regressionHtml;
        }

        // ç”ŸæˆéªŒè¯æŠ¥å‘Š
        function generateVerificationReport() {
            const fixRate = Math.round((bugFixStats.fixed / bugFixStats.total) * 100);
            const effectiveFixRate = Math.round(((bugFixStats.fixed + bugFixStats.partial * 0.5) / bugFixStats.total) * 100);

            let grade = '';
            let recommendations = [];

            if (effectiveFixRate >= 90) {
                grade = 'ä¼˜ç§€ ğŸ†';
                recommendations = [
                    'ç³»ç»ŸBugä¿®å¤çŠ¶å†µä¼˜ç§€ï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨',
                    'å»ºè®®ç»§ç»­ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶å†µ',
                    'å®šæœŸè¿›è¡Œç»´æŠ¤å’Œæ›´æ–°'
                ];
            } else if (effectiveFixRate >= 75) {
                grade = 'è‰¯å¥½ âœ¨';
                recommendations = [
                    'ç³»ç»ŸBugä¿®å¤çŠ¶å†µè‰¯å¥½ï¼Œå»ºè®®ä¿®å¤å‰©ä½™é—®é¢˜',
                    'ä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§æœªä¿®å¤çš„Bug',
                    'åŠ å¼ºæµ‹è¯•è¦†ç›–ç‡'
                ];
            } else if (effectiveFixRate >= 60) {
                grade = 'ä¸€èˆ¬ âš ï¸';
                recommendations = [
                    'ç³»ç»Ÿä»å­˜åœ¨è¾ƒå¤šé—®é¢˜ï¼Œéœ€è¦ç»§ç»­ä¿®å¤',
                    'å»ºè®®é‡ç‚¹å…³æ³¨é«˜ä¼˜å…ˆçº§Bug',
                    'è€ƒè™‘å¢åŠ å¼€å‘èµ„æºæŠ•å…¥'
                ];
            } else {
                grade = 'éœ€å¤§åŠ›æ”¹è¿› ğŸš¨';
                recommendations = [
                    'ç³»ç»ŸBugè¾ƒå¤šï¼Œä¸å»ºè®®ç«‹å³æŠ•å…¥ç”Ÿäº§',
                    'éœ€è¦ç³»ç»Ÿæ€§åœ°è§£å†³ç°æœ‰é—®é¢˜',
                    'å»ºè®®è¿›è¡Œå…¨é¢çš„ä»£ç å®¡æŸ¥'
                ];
            }

            // è·å–æœªä¿®å¤çš„é«˜ä¼˜å…ˆçº§Bug
            const unfixedHighPriorityBugs = BUG_DATABASE.high.filter(bug => bug.status === 'failed');
            const criticalIssues = unfixedHighPriorityBugs.map(bug => `${bug.id}: ${bug.title}`);

            const reportHtml = `
                <div style="background: var(--card-bg); padding: 20px; border-radius: 8px; border: 2px solid var(--primary-color);">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">ğŸ“‹ Bugä¿®å¤éªŒè¯æŠ¥å‘Š</h3>

                    <div style="margin: 15px 0;">
                        <h4>ä¿®å¤çŠ¶å†µæ¦‚è§ˆ</h4>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                            <li>æ€»Bugæ•°é‡: ${bugFixStats.total}</li>
                            <li>å®Œå…¨ä¿®å¤: ${bugFixStats.fixed} (${fixRate}%)</li>
                            <li>éƒ¨åˆ†ä¿®å¤: ${bugFixStats.partial} (${Math.round((bugFixStats.partial / bugFixStats.total) * 100)}%)</li>
                            <li>æœªä¿®å¤: ${bugFixStats.failed} (${Math.round((bugFixStats.failed / bugFixStats.total) * 100)}%)</li>
                            <li>æœ‰æ•ˆä¿®å¤ç‡: ${effectiveFixRate}%</li>
                        </ul>
                    </div>

                    <div style="margin: 15px 0; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 6px;">
                        <h4 style="color: var(--primary-color);">ç³»ç»Ÿè´¨é‡ç­‰çº§: ${grade}</h4>
                    </div>

                    ${criticalIssues.length > 0 ? `
                        <div style="margin: 15px 0;">
                            <h4 style="color: var(--error-color);">ğŸš¨ æœªä¿®å¤çš„é«˜ä¼˜å…ˆçº§Bug</h4>
                            <ul style="margin-left: 20px; line-height: 1.8; color: var(--error-color);">
                                ${criticalIssues.map(issue => `<li>${issue}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <div style="margin: 15px 0;">
                        <h4>æ”¹è¿›å»ºè®®</h4>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                            ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>

                    <div style="margin-top: 20px; padding: 10px; background: var(--bg-color); border-radius: 6px; font-size: 0.9rem; color: var(--text-secondary);">
                        <strong>æŠ¥å‘Šç”Ÿæˆæ—¶é—´:</strong> ${new Date().toLocaleString('zh-CN')}<br>
                        <strong>æµ‹è¯•è¦†ç›–èŒƒå›´:</strong> é«˜ä¼˜å…ˆçº§Bug (${BUG_DATABASE.high.length}ä¸ª)ã€ä¸­ä¼˜å…ˆçº§Bug (${BUG_DATABASE.medium.length}ä¸ª)ã€ä½ä¼˜å…ˆçº§Bug (${BUG_DATABASE.low.length}ä¸ª)
                    </div>
                </div>
            `;

            document.getElementById('verification-report').innerHTML = reportHtml;
        }

        // æ¸…é™¤æµ‹è¯•ç»“æœ
        function clearResults() {
            const resultContainers = [
                'bug-fix-summary', 'high-priority-bugs', 'medium-priority-bugs',
                'low-priority-bugs', 'regression-test-results', 'verification-report'
            ];

            resultContainers.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });

            bugFixStats = { total: 0, fixed: 0, failed: 0, partial: 0 };
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºåˆå§‹çŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(() => {
                const totalBugs = BUG_DATABASE.high.length + BUG_DATABASE.medium.length + BUG_DATABASE.low.length;

                document.getElementById('high-priority-bugs').innerHTML = `
                    <div class="bug-test-result test-warning">
                        ğŸ“‹ Bugä¿®å¤éªŒè¯æµ‹è¯•å·²å‡†å¤‡å°±ç»ª<br>
                        å…±å‘ç° ${totalBugs} ä¸ªå·²çŸ¥Bugéœ€è¦éªŒè¯ä¿®å¤çŠ¶å†µ<br>
                        åŒ…æ‹¬ ${BUG_DATABASE.high.length} ä¸ªé«˜ä¼˜å…ˆçº§ã€${BUG_DATABASE.medium.length} ä¸ªä¸­ä¼˜å…ˆçº§ã€${BUG_DATABASE.low.length} ä¸ªä½ä¼˜å…ˆçº§Bug<br>
                        ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹éªŒè¯æµ‹è¯•
                    </div>
                `;
            }, 500);
        });
    </script>
</body>
</html>