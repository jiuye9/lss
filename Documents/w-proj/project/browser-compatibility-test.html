<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…­çˆ»æ’ç›˜ç³»ç»Ÿ - æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        :root {
            --primary-color: #D4AF37;
            --secondary-color: #B8860B;
            --bg-color: #1A1A1A;
            --card-bg: #2F2F2F;
            --text-color: #F5F5DC;
            --success-color: #228B22;
            --error-color: #DC143C;
            --warning-color: #FF8C00;
            --border-color: #4A4A4A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid var(--primary-color);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .test-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .test-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
        }

        .test-result {
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .test-pass {
            background: rgba(34, 139, 34, 0.1);
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .test-fail {
            background: rgba(220, 20, 60, 0.1);
            border-left-color: var(--error-color);
            color: var(--error-color);
        }

        .test-warning {
            background: rgba(255, 140, 0, 0.1);
            border-left-color: var(--warning-color);
            color: var(--warning-color);
        }

        .test-partial {
            background: rgba(212, 175, 55, 0.1);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn {
            background: var(--primary-color);
            color: var(--bg-color);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: var(--secondary-color);
        }

        .test-controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-detail {
            font-size: 0.9rem;
            margin-top: 8px;
            opacity: 0.9;
        }

        .browser-info {
            grid-column: span 2;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            margin-bottom: 20px;
        }

        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .compatibility-item {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .compatibility-score {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .score-excellent { color: var(--success-color); }
        .score-good { color: var(--primary-color); }
        .score-fair { color: var(--warning-color); }
        .score-poor { color: var(--error-color); }

        .feature-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .feature-table th,
        .feature-table td {
            padding: 8px 12px;
            text-align: left;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .feature-table th {
            background: var(--primary-color);
            color: var(--bg-color);
            font-weight: bold;
        }

        .feature-table tr:nth-child(even) {
            background: rgba(212, 175, 55, 0.05);
        }

        .support-yes { color: var(--success-color); font-weight: bold; }
        .support-no { color: var(--error-color); font-weight: bold; }
        .support-partial { color: var(--warning-color); font-weight: bold; }

        @media (max-width: 768px) {
            .test-container {
                grid-template-columns: 1fr;
            }
            .browser-info {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å…­çˆ»æ’ç›˜ç³»ç»Ÿæµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h1>
        <p>æ£€æµ‹ç³»ç»Ÿåœ¨ä¸åŒæµè§ˆå™¨å’Œç¯å¢ƒä¸‹çš„å…¼å®¹æ€§</p>
        <div id="test-timestamp"></div>
    </div>

    <div class="test-controls">
        <button class="btn" onclick="runAllCompatibilityTests()">æ‰§è¡Œå…¨éƒ¨å…¼å®¹æ€§æµ‹è¯•</button>
        <button class="btn" onclick="runJSFeatureTests()">JavaScriptç‰¹æ€§æµ‹è¯•</button>
        <button class="btn" onclick="runCSSFeatureTests()">CSSç‰¹æ€§æµ‹è¯•</button>
        <button class="btn" onclick="runHTMLFeatureTests()">HTMLç‰¹æ€§æµ‹è¯•</button>
        <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div class="browser-info">
        <h2>ğŸŒ å½“å‰æµè§ˆå™¨ç¯å¢ƒä¿¡æ¯</h2>
        <div id="browser-details"></div>
    </div>

    <div class="test-container">
        <div class="test-section">
            <h2>ğŸ”§ JavaScriptç‰¹æ€§æ”¯æŒ</h2>
            <div id="js-feature-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ¨ CSSç‰¹æ€§æ”¯æŒ</h2>
            <div id="css-feature-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ HTMLç‰¹æ€§æ”¯æŒ</h2>
            <div id="html-feature-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸš€ æ€§èƒ½APIæ”¯æŒ</h2>
            <div id="performance-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“± è®¾å¤‡APIæ”¯æŒ</h2>
            <div id="device-api-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” å®‰å…¨ç‰¹æ€§æ”¯æŒ</h2>
            <div id="security-results"></div>
        </div>
    </div>

    <div class="test-section" style="margin-top: 20px;">
        <h2>ğŸ“Š å…¼å®¹æ€§è¯„åˆ†æ±‡æ€»</h2>
        <div id="compatibility-summary"></div>
    </div>

    <script>
        // å…¨å±€æµ‹è¯•ç»Ÿè®¡
        let compatibilityStats = {
            total: 0,
            passed: 0,
            failed: 0,
            partial: 0
        };

        // åˆå§‹åŒ–æ—¶é—´æˆ³
        document.getElementById('test-timestamp').textContent =
            `æµ‹è¯•æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`;

        // è®°å½•æµ‹è¯•ç»“æœ
        function recordCompatibilityResult(elementId, testName, status, details = '') {
            compatibilityStats.total++;

            let statusClass, statusIcon;
            switch (status) {
                case 'pass':
                    compatibilityStats.passed++;
                    statusClass = 'test-pass';
                    statusIcon = 'âœ…';
                    break;
                case 'fail':
                    compatibilityStats.failed++;
                    statusClass = 'test-fail';
                    statusIcon = 'âŒ';
                    break;
                case 'partial':
                    compatibilityStats.partial++;
                    statusClass = 'test-partial';
                    statusIcon = 'âš ï¸';
                    break;
                default:
                    statusClass = 'test-warning';
                    statusIcon = 'â“';
            }

            const resultHtml = `
                <div class="test-result ${statusClass}">
                    <strong>${statusIcon} ${testName}</strong>
                    <div class="test-detail">${details}</div>
                </div>
            `;

            document.getElementById(elementId).innerHTML += resultHtml;
        }

        // æµè§ˆå™¨æ£€æµ‹å’Œä¿¡æ¯æ˜¾ç¤º
        function detectBrowserInfo() {
            const ua = navigator.userAgent;
            const browserInfo = {
                name: 'Unknown',
                version: 'Unknown',
                engine: 'Unknown',
                os: 'Unknown'
            };

            // æµè§ˆå™¨æ£€æµ‹
            if (ua.includes('Chrome')) browserInfo.name = 'Chrome';
            else if (ua.includes('Firefox')) browserInfo.name = 'Firefox';
            else if (ua.includes('Safari')) browserInfo.name = 'Safari';
            else if (ua.includes('Edge')) browserInfo.name = 'Edge';
            else if (ua.includes('Opera')) browserInfo.name = 'Opera';
            else if (ua.includes('MSIE') || ua.includes('Trident')) browserInfo.name = 'Internet Explorer';

            // æ“ä½œç³»ç»Ÿæ£€æµ‹
            if (ua.includes('Windows')) browserInfo.os = 'Windows';
            else if (ua.includes('Mac')) browserInfo.os = 'macOS';
            else if (ua.includes('Linux')) browserInfo.os = 'Linux';
            else if (ua.includes('Android')) browserInfo.os = 'Android';
            else if (ua.includes('iOS')) browserInfo.os = 'iOS';

            // å¼•æ“æ£€æµ‹
            if (ua.includes('WebKit')) browserInfo.engine = 'WebKit';
            else if (ua.includes('Gecko')) browserInfo.engine = 'Gecko';
            else if (ua.includes('Trident')) browserInfo.engine = 'Trident';
            else if (ua.includes('Presto')) browserInfo.engine = 'Presto';

            return browserInfo;
        }

        // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        function displayBrowserInfo() {
            const info = detectBrowserInfo();
            const infoHtml = `
                <div class="compatibility-grid">
                    <div class="compatibility-item">
                        <h4>æµè§ˆå™¨</h4>
                        <div class="compatibility-score score-good">${info.name}</div>
                    </div>
                    <div class="compatibility-item">
                        <h4>æ“ä½œç³»ç»Ÿ</h4>
                        <div class="compatibility-score score-good">${info.os}</div>
                    </div>
                    <div class="compatibility-item">
                        <h4>æ¸²æŸ“å¼•æ“</h4>
                        <div class="compatibility-score score-good">${info.engine}</div>
                    </div>
                    <div class="compatibility-item">
                        <h4>ç”¨æˆ·ä»£ç†</h4>
                        <div style="font-size: 0.8rem; word-break: break-all;">${navigator.userAgent}</div>
                    </div>
                </div>
            `;
            document.getElementById('browser-details').innerHTML = infoHtml;
        }

        // JavaScriptç‰¹æ€§æµ‹è¯•
        function runJSFeatureTests() {
            const jsFeatures = [
                {
                    name: 'ES6 ç®­å¤´å‡½æ•°',
                    test: () => {
                        try {
                            eval('(() => true)()');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6 const/let',
                    test: () => {
                        try {
                            eval('const test = 1; let test2 = 2;');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6 æ¨¡æ¿å­—ç¬¦ä¸²',
                    test: () => {
                        try {
                            eval('`template string`');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'ES6 è§£æ„èµ‹å€¼',
                    test: () => {
                        try {
                            eval('const {a} = {a: 1};');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'Promiseæ”¯æŒ',
                    test: () => typeof Promise !== 'undefined'
                },
                {
                    name: 'async/awaitæ”¯æŒ',
                    test: () => {
                        try {
                            eval('async function test() { await 1; }');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'Array.fromæ”¯æŒ',
                    test: () => typeof Array.from === 'function'
                },
                {
                    name: 'Object.assignæ”¯æŒ',
                    test: () => typeof Object.assign === 'function'
                },
                {
                    name: 'Mapå’ŒSetæ”¯æŒ',
                    test: () => typeof Map !== 'undefined' && typeof Set !== 'undefined'
                },
                {
                    name: 'Proxyæ”¯æŒ',
                    test: () => typeof Proxy !== 'undefined'
                },
                {
                    name: 'Symbolæ”¯æŒ',
                    test: () => typeof Symbol !== 'undefined'
                },
                {
                    name: 'WeakMap/WeakSetæ”¯æŒ',
                    test: () => typeof WeakMap !== 'undefined' && typeof WeakSet !== 'undefined'
                }
            ];

            let passCount = 0;
            jsFeatures.forEach(feature => {
                try {
                    const supported = feature.test();
                    if (supported) passCount++;

                    recordCompatibilityResult('js-feature-results',
                        feature.name,
                        supported ? 'pass' : 'fail',
                        `æ”¯æŒçŠ¶æ€: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    recordCompatibilityResult('js-feature-results',
                        feature.name,
                        'fail',
                        `æµ‹è¯•é”™è¯¯: ${error.message}`);
                }
            });

            recordCompatibilityResult('js-feature-results',
                'JavaScriptæ€»ä½“å…¼å®¹æ€§',
                passCount >= jsFeatures.length * 0.8 ? 'pass' : (passCount >= jsFeatures.length * 0.5 ? 'partial' : 'fail'),
                `æ”¯æŒç‰¹æ€§: ${passCount}/${jsFeatures.length} (${Math.round(passCount/jsFeatures.length*100)}%)`);
        }

        // CSSç‰¹æ€§æµ‹è¯•
        function runCSSFeatureTests() {
            const cssFeatures = [
                {
                    name: 'CSS Gridå¸ƒå±€',
                    test: () => CSS.supports('display', 'grid')
                },
                {
                    name: 'CSS Flexbox',
                    test: () => CSS.supports('display', 'flex')
                },
                {
                    name: 'CSS Variables',
                    test: () => CSS.supports('color', 'var(--test)')
                },
                {
                    name: 'CSS Transform',
                    test: () => CSS.supports('transform', 'translateX(10px)')
                },
                {
                    name: 'CSS Transition',
                    test: () => CSS.supports('transition', 'all 0.3s')
                },
                {
                    name: 'CSS Animation',
                    test: () => CSS.supports('animation', 'fadeIn 1s')
                },
                {
                    name: 'CSS Calc',
                    test: () => CSS.supports('width', 'calc(100% - 10px)')
                },
                {
                    name: 'CSS Media Queries',
                    test: () => window.matchMedia !== undefined
                },
                {
                    name: 'CSS Gradients',
                    test: () => CSS.supports('background', 'linear-gradient(to right, red, blue)')
                },
                {
                    name: 'CSS Box Shadow',
                    test: () => CSS.supports('box-shadow', '0 0 10px rgba(0,0,0,0.5)')
                },
                {
                    name: 'CSS Border Radius',
                    test: () => CSS.supports('border-radius', '10px')
                },
                {
                    name: 'CSS Opacity',
                    test: () => CSS.supports('opacity', '0.5')
                }
            ];

            let passCount = 0;
            cssFeatures.forEach(feature => {
                try {
                    const supported = feature.test();
                    if (supported) passCount++;

                    recordCompatibilityResult('css-feature-results',
                        feature.name,
                        supported ? 'pass' : 'fail',
                        `æ”¯æŒçŠ¶æ€: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    recordCompatibilityResult('css-feature-results',
                        feature.name,
                        'fail',
                        `æµ‹è¯•é”™è¯¯: ${error.message}`);
                }
            });

            recordCompatibilityResult('css-feature-results',
                'CSSæ€»ä½“å…¼å®¹æ€§',
                passCount >= cssFeatures.length * 0.9 ? 'pass' : (passCount >= cssFeatures.length * 0.7 ? 'partial' : 'fail'),
                `æ”¯æŒç‰¹æ€§: ${passCount}/${cssFeatures.length} (${Math.round(passCount/cssFeatures.length*100)}%)`);
        }

        // HTMLç‰¹æ€§æµ‹è¯•
        function runHTMLFeatureTests() {
            const htmlFeatures = [
                {
                    name: 'HTML5 Semantic Elements',
                    test: () => {
                        const testDiv = document.createElement('section');
                        return testDiv.toString() === '[object HTMLElement]';
                    }
                },
                {
                    name: 'HTML5 Input Types',
                    test: () => {
                        const input = document.createElement('input');
                        input.type = 'date';
                        return input.type === 'date';
                    }
                },
                {
                    name: 'HTML5 Form Validation',
                    test: () => {
                        const input = document.createElement('input');
                        return typeof input.checkValidity === 'function';
                    }
                },
                {
                    name: 'HTML5 Dataset API',
                    test: () => {
                        const div = document.createElement('div');
                        return typeof div.dataset === 'object';
                    }
                },
                {
                    name: 'HTML5 classList API',
                    test: () => {
                        const div = document.createElement('div');
                        return typeof div.classList === 'object';
                    }
                },
                {
                    name: 'HTML5 querySelector',
                    test: () => typeof document.querySelector === 'function'
                },
                {
                    name: 'HTML5 querySelectorAll',
                    test: () => typeof document.querySelectorAll === 'function'
                },
                {
                    name: 'HTML5 Storage API',
                    test: () => typeof localStorage !== 'undefined' && typeof sessionStorage !== 'undefined'
                }
            ];

            let passCount = 0;
            htmlFeatures.forEach(feature => {
                try {
                    const supported = feature.test();
                    if (supported) passCount++;

                    recordCompatibilityResult('html-feature-results',
                        feature.name,
                        supported ? 'pass' : 'fail',
                        `æ”¯æŒçŠ¶æ€: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    recordCompatibilityResult('html-feature-results',
                        feature.name,
                        'fail',
                        `æµ‹è¯•é”™è¯¯: ${error.message}`);
                }
            });

            recordCompatibilityResult('html-feature-results',
                'HTMLæ€»ä½“å…¼å®¹æ€§',
                passCount >= htmlFeatures.length * 0.9 ? 'pass' : (passCount >= htmlFeatures.length * 0.7 ? 'partial' : 'fail'),
                `æ”¯æŒç‰¹æ€§: ${passCount}/${htmlFeatures.length} (${Math.round(passCount/htmlFeatures.length*100)}%)`);
        }

        // æ€§èƒ½APIæµ‹è¯•
        function runPerformanceTests() {
            const performanceFeatures = [
                {
                    name: 'Performance API',
                    test: () => typeof performance !== 'undefined'
                },
                {
                    name: 'Performance.now()',
                    test: () => typeof performance.now === 'function'
                },
                {
                    name: 'Performance.mark()',
                    test: () => typeof performance.mark === 'function'
                },
                {
                    name: 'Performance.measure()',
                    test: () => typeof performance.measure === 'function'
                },
                {
                    name: 'Performance Observer',
                    test: () => typeof PerformanceObserver !== 'undefined'
                },
                {
                    name: 'Navigation Timing API',
                    test: () => typeof performance.timing !== 'undefined'
                },
                {
                    name: 'Memory API',
                    test: () => typeof performance.memory !== 'undefined'
                }
            ];

            let passCount = 0;
            performanceFeatures.forEach(feature => {
                try {
                    const supported = feature.test();
                    if (supported) passCount++;

                    recordCompatibilityResult('performance-results',
                        feature.name,
                        supported ? 'pass' : 'fail',
                        `æ”¯æŒçŠ¶æ€: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    recordCompatibilityResult('performance-results',
                        feature.name,
                        'fail',
                        `æµ‹è¯•é”™è¯¯: ${error.message}`);
                }
            });

            recordCompatibilityResult('performance-results',
                'æ€§èƒ½APIæ€»ä½“æ”¯æŒ',
                passCount >= performanceFeatures.length * 0.6 ? 'pass' : (passCount >= performanceFeatures.length * 0.3 ? 'partial' : 'fail'),
                `æ”¯æŒAPI: ${passCount}/${performanceFeatures.length} (${Math.round(passCount/performanceFeatures.length*100)}%)`);
        }

        // è®¾å¤‡APIæµ‹è¯•
        function runDeviceAPITests() {
            const deviceFeatures = [
                {
                    name: 'Touch Events',
                    test: () => 'ontouchstart' in window
                },
                {
                    name: 'Device Orientation',
                    test: () => 'DeviceOrientationEvent' in window
                },
                {
                    name: 'Geolocation API',
                    test: () => 'geolocation' in navigator
                },
                {
                    name: 'Vibration API',
                    test: () => 'vibrate' in navigator
                },
                {
                    name: 'Battery API',
                    test: () => 'getBattery' in navigator
                },
                {
                    name: 'Network Information',
                    test: () => 'connection' in navigator
                },
                {
                    name: 'Screen Orientation',
                    test: () => 'orientation' in screen
                }
            ];

            let passCount = 0;
            deviceFeatures.forEach(feature => {
                try {
                    const supported = feature.test();
                    if (supported) passCount++;

                    recordCompatibilityResult('device-api-results',
                        feature.name,
                        supported ? 'pass' : 'fail',
                        `æ”¯æŒçŠ¶æ€: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    recordCompatibilityResult('device-api-results',
                        feature.name,
                        'fail',
                        `æµ‹è¯•é”™è¯¯: ${error.message}`);
                }
            });

            recordCompatibilityResult('device-api-results',
                'è®¾å¤‡APIæ€»ä½“æ”¯æŒ',
                passCount >= deviceFeatures.length * 0.4 ? 'pass' : (passCount >= deviceFeatures.length * 0.2 ? 'partial' : 'fail'),
                `æ”¯æŒAPI: ${passCount}/${deviceFeatures.length} (${Math.round(passCount/deviceFeatures.length*100)}%)`);
        }

        // å®‰å…¨ç‰¹æ€§æµ‹è¯•
        function runSecurityTests() {
            const securityFeatures = [
                {
                    name: 'HTTPSåè®®',
                    test: () => location.protocol === 'https:'
                },
                {
                    name: 'Content Security Policy',
                    test: () => typeof CSP !== 'undefined' || document.querySelector('meta[http-equiv="Content-Security-Policy"]') !== null
                },
                {
                    name: 'Secure Context',
                    test: () => typeof isSecureContext !== 'undefined' ? isSecureContext : false
                },
                {
                    name: 'SubResource Integrity',
                    test: () => {
                        const script = document.createElement('script');
                        return 'integrity' in script;
                    }
                },
                {
                    name: 'Referrer Policy',
                    test: () => {
                        const link = document.createElement('a');
                        return 'referrerPolicy' in link;
                    }
                }
            ];

            let passCount = 0;
            securityFeatures.forEach(feature => {
                try {
                    const supported = feature.test();
                    if (supported) passCount++;

                    recordCompatibilityResult('security-results',
                        feature.name,
                        supported ? 'pass' : 'fail',
                        `æ”¯æŒçŠ¶æ€: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    recordCompatibilityResult('security-results',
                        feature.name,
                        'fail',
                        `æµ‹è¯•é”™è¯¯: ${error.message}`);
                }
            });

            recordCompatibilityResult('security-results',
                'å®‰å…¨ç‰¹æ€§æ€»ä½“æ”¯æŒ',
                passCount >= securityFeatures.length * 0.6 ? 'pass' : (passCount >= securityFeatures.length * 0.3 ? 'partial' : 'fail'),
                `æ”¯æŒç‰¹æ€§: ${passCount}/${securityFeatures.length} (${Math.round(passCount/securityFeatures.length*100)}%)`);
        }

        // æ‰§è¡Œæ‰€æœ‰å…¼å®¹æ€§æµ‹è¯•
        function runAllCompatibilityTests() {
            clearResults();
            compatibilityStats = { total: 0, passed: 0, failed: 0, partial: 0 };

            displayBrowserInfo();

            const startTime = performance.now();

            runJSFeatureTests();
            runCSSFeatureTests();
            runHTMLFeatureTests();
            runPerformanceTests();
            runDeviceAPITests();
            runSecurityTests();

            const endTime = performance.now();
            const totalTime = Math.round(endTime - startTime);

            generateCompatibilitySummary(totalTime);
        }

        // ç”Ÿæˆå…¼å®¹æ€§æ±‡æ€»
        function generateCompatibilitySummary(totalTime) {
            const totalTests = compatibilityStats.total;
            const passRate = Math.round((compatibilityStats.passed / totalTests) * 100);
            const partialRate = Math.round((compatibilityStats.partial / totalTests) * 100);
            const failRate = Math.round((compatibilityStats.failed / totalTests) * 100);

            const compatibilityGrade = getCompatibilityGrade(passRate, partialRate);

            // ç”Ÿæˆæµè§ˆå™¨å…¼å®¹æ€§è¡¨æ ¼
            const browserCompatibilityTable = generateBrowserCompatibilityTable();

            const summaryHtml = `
                <div class="compatibility-grid">
                    <div class="compatibility-item">
                        <h4>æ€»æµ‹è¯•é¡¹</h4>
                        <div class="compatibility-score score-good">${totalTests}</div>
                    </div>
                    <div class="compatibility-item">
                        <h4>å®Œå…¨æ”¯æŒ</h4>
                        <div class="compatibility-score score-excellent">${compatibilityStats.passed}</div>
                        <div style="font-size: 0.8rem;">${passRate}%</div>
                    </div>
                    <div class="compatibility-item">
                        <h4>éƒ¨åˆ†æ”¯æŒ</h4>
                        <div class="compatibility-score score-fair">${compatibilityStats.partial}</div>
                        <div style="font-size: 0.8rem;">${partialRate}%</div>
                    </div>
                    <div class="compatibility-item">
                        <h4>ä¸æ”¯æŒ</h4>
                        <div class="compatibility-score score-poor">${compatibilityStats.failed}</div>
                        <div style="font-size: 0.8rem;">${failRate}%</div>
                    </div>
                </div>

                <div style="margin: 20px 0; padding: 20px; background: var(--card-bg); border-radius: 8px; border: 2px solid ${compatibilityGrade.color};">
                    <h3 style="color: ${compatibilityGrade.color}; text-align: center;">
                        å…¼å®¹æ€§ç­‰çº§: ${compatibilityGrade.level} ${compatibilityGrade.icon}
                    </h3>
                    <p style="text-align: center; margin-top: 10px; font-size: 1.1rem;">
                        ${compatibilityGrade.description}
                    </p>
                </div>

                <div style="margin: 20px 0;">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">ä¸»æµæµè§ˆå™¨å…¼å®¹æ€§é¢„ä¼°</h3>
                    ${browserCompatibilityTable}
                </div>

                <div style="margin: 20px 0; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">å…¼å®¹æ€§å»ºè®®</h4>
                    <div style="line-height: 1.6;">
                        ${compatibilityGrade.suggestions.map(suggestion => `â€¢ ${suggestion}`).join('<br>')}
                    </div>
                </div>

                <div style="margin-top: 15px; padding: 10px; background: var(--bg-color); border-radius: 6px; font-size: 0.9rem; color: var(--text-secondary);">
                    <strong>æµ‹è¯•è¯´æ˜ï¼š</strong>æœ¬å…¼å®¹æ€§æµ‹è¯•åŸºäºå½“å‰æµè§ˆå™¨ç¯å¢ƒè¿›è¡Œæ£€æµ‹ï¼Œå®é™…å…¼å®¹æ€§å¯èƒ½å› æµè§ˆå™¨ç‰ˆæœ¬ã€è®¾ç½®ç­‰å› ç´ è€Œæœ‰æ‰€å·®å¼‚ã€‚
                    æµ‹è¯•è€—æ—¶ï¼š${totalTime}ms
                </div>
            `;

            document.getElementById('compatibility-summary').innerHTML = summaryHtml;
        }

        // ç”Ÿæˆæµè§ˆå™¨å…¼å®¹æ€§è¡¨æ ¼
        function generateBrowserCompatibilityTable() {
            const browsers = [
                { name: 'Chrome', score: 95, status: 'ä¼˜ç§€', note: 'å®Œå…¨æ”¯æŒæ‰€æœ‰ç°ä»£ç‰¹æ€§' },
                { name: 'Firefox', score: 93, status: 'ä¼˜ç§€', note: 'å¯¹æ ‡å‡†æ”¯æŒè‰¯å¥½' },
                { name: 'Safari', score: 88, status: 'è‰¯å¥½', note: 'éƒ¨åˆ†æ–°ç‰¹æ€§æ”¯æŒè¾ƒæ…¢' },
                { name: 'Edge', score: 90, status: 'è‰¯å¥½', note: 'åŸºäºChromiumï¼Œå…¼å®¹æ€§å¥½' },
                { name: 'Opera', score: 92, status: 'ä¼˜ç§€', note: 'åŸºäºChromiumå†…æ ¸' },
                { name: 'IE 11', score: 45, status: 'å·®', note: 'ä¸æ¨èä½¿ç”¨' }
            ];

            let tableHtml = `
                <table class="feature-table">
                    <thead>
                        <tr>
                            <th>æµè§ˆå™¨</th>
                            <th>é¢„ä¼°å¾—åˆ†</th>
                            <th>å…¼å®¹çŠ¶æ€</th>
                            <th>å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            browsers.forEach(browser => {
                const scoreClass = browser.score >= 90 ? 'support-yes' :
                                  browser.score >= 70 ? 'support-partial' : 'support-no';

                tableHtml += `
                    <tr>
                        <td>${browser.name}</td>
                        <td class="${scoreClass}">${browser.score}%</td>
                        <td class="${scoreClass}">${browser.status}</td>
                        <td>${browser.note}</td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;

            return tableHtml;
        }

        // å…¼å®¹æ€§ç­‰çº§è¯„ä¼°
        function getCompatibilityGrade(passRate, partialRate) {
            const effectiveRate = passRate + (partialRate * 0.5);

            if (effectiveRate >= 95) {
                return {
                    level: 'ä¼˜ç§€',
                    color: 'var(--success-color)',
                    icon: 'ğŸ†',
                    description: 'ç³»ç»Ÿå…¼å®¹æ€§ä¼˜ç§€ï¼Œæ”¯æŒæ‰€æœ‰ä¸»æµæµè§ˆå™¨å’Œç°ä»£ç‰¹æ€§',
                    suggestions: [
                        'å½“å‰å…¼å®¹æ€§å·²è¾¾åˆ°ä¼˜ç§€æ°´å¹³',
                        'å¯ä»¥å®‰å…¨åœ°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨',
                        'å»ºè®®å®šæœŸæ›´æ–°ä»¥ä¿æŒå…¼å®¹æ€§'
                    ]
                };
            } else if (effectiveRate >= 85) {
                return {
                    level: 'è‰¯å¥½',
                    color: 'var(--primary-color)',
                    icon: 'âœ¨',
                    description: 'ç³»ç»Ÿå…¼å®¹æ€§è‰¯å¥½ï¼Œæ”¯æŒå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨',
                    suggestions: [
                        'å»ºè®®å¢åŠ å¯¹ä¸æ”¯æŒç‰¹æ€§çš„polyfill',
                        'è€ƒè™‘æä¾›é™çº§æ–¹æ¡ˆ',
                        'æµ‹è¯•æ›´å¤šæµè§ˆå™¨ç‰ˆæœ¬'
                    ]
                };
            } else if (effectiveRate >= 70) {
                return {
                    level: 'ä¸€èˆ¬',
                    color: 'var(--warning-color)',
                    icon: 'âš ï¸',
                    description: 'ç³»ç»Ÿå…¼å®¹æ€§ä¸€èˆ¬ï¼Œéƒ¨åˆ†æµè§ˆå™¨å¯èƒ½å­˜åœ¨é—®é¢˜',
                    suggestions: [
                        'ä¼˜å…ˆä¿®å¤å¤±è´¥çš„æ ¸å¿ƒç‰¹æ€§',
                        'å¢åŠ æ›´å¤špolyfillæ”¯æŒ',
                        'æä¾›è¯¦ç»†çš„æµè§ˆå™¨å…¼å®¹æ€§è¯´æ˜'
                    ]
                };
            } else {
                return {
                    level: 'éœ€æ”¹è¿›',
                    color: 'var(--error-color)',
                    icon: 'ğŸš¨',
                    description: 'ç³»ç»Ÿå…¼å®¹æ€§è¾ƒå·®ï¼Œéœ€è¦å¤§é‡ä¼˜åŒ–å·¥ä½œ',
                    suggestions: [
                        'é‡ç‚¹è§£å†³JavaScriptå’ŒCSSå…¼å®¹æ€§é—®é¢˜',
                        'è€ƒè™‘ä½¿ç”¨å…¼å®¹æ€§æ›´å¥½çš„æŠ€æœ¯æ ˆ',
                        'å»ºè®®è¿›è¡Œå…¨é¢çš„ä»£ç é‡æ„'
                    ]
                };
            }
        }

        // æ¸…é™¤æµ‹è¯•ç»“æœ
        function clearResults() {
            const resultContainers = [
                'js-feature-results', 'css-feature-results', 'html-feature-results',
                'performance-results', 'device-api-results', 'security-results',
                'compatibility-summary'
            ];

            resultContainers.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });

            compatibilityStats = { total: 0, passed: 0, failed: 0, partial: 0 };
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        window.addEventListener('load', () => {
            displayBrowserInfo();
            setTimeout(() => {
                recordCompatibilityResult('js-feature-results', 'å…¼å®¹æ€§æµ‹è¯•å¥—ä»¶åˆå§‹åŒ–', 'pass',
                    'æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•');
            }, 500);
        });
    </script>
</body>
</html>